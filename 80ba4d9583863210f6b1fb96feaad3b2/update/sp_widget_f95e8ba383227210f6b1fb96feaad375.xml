<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, $uibModal, spUtil, $timeout, $window, $interval, $element) {
    var c = this;

    function initSafetyNet() {
        if (!c.data) c.data = {};
        
        // 1. åˆå§‹åŒ–resourceStatus
        if (!Array.isArray(c.data.resourceStatus)) {
            c.data.resourceStatus = [];
        }
        for (var i = c.data.resourceStatus.length; i < 5; i++) {
            c.data.resourceStatus.push({ percent: 0, name: 'Resource_' + (i+1) });
        }
        
        // 2. åˆå§‹åŒ–list
        if (!Array.isArray(c.data.list)) {
            c.data.list = [];
        }
        
        // 3. åˆå§‹åŒ–myTasks
        if (!Array.isArray(c.data.myTasks)) {
            c.data.myTasks = [];
        }

        // 4. åˆå§‹åŒ– myRequests
        if (!Array.isArray(c.data.myRequests)) {
            c.data.myRequests = [];
        }
        
        // 5. åˆå§‹åŒ–volunteers
        if (!Array.isArray(c.data.volunteers)) {
            c.data.volunteers = [];
        }
        
        // 6. åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯
        if (!c.data.user_name) c.data.user_name = 'Operator';
        if (!c.data.user_id) c.data.user_id = 'VOL-000000';
        
        // 7. åˆå§‹åŒ–SLAç»Ÿè®¡
        if (!c.data.slaStats) {
            c.data.slaStats = { breached: 0, atRisk: 0, ok: 0 };
        }
        
        // 8. åˆå§‹åŒ–isVolunteer
        if (c.data.isVolunteer === undefined) {
            c.data.isVolunteer = true;
        }
        
        // 9. åˆå§‹åŒ–counts
        if (!c.data.sosCount) c.data.sosCount = 0;
        if (!c.data.openCount) c.data.openCount = 0;
        
        // 10. åˆå§‹åŒ–ç´§æ€¥å‘Šè­¦
        if (!c.data.emergencyAlert) c.data.emergencyAlert = null;
    }

    initSafetyNet();

    // ============================================================
    // [PART 1] UI CLEANER (THE SNIPER) - STRICTLY PRESERVED
    // ============================================================
    
  function runSniper() {
        var windowHeight = $window.innerHeight;
        var allElements = document.body.getElementsByTagName('*');
        
        for (var i = 0; i < allElements.length; i++) {
            var el = allElements[i];
            // ä¿æŠ¤åˆ—è¡¨ï¼šè„šæœ¬ã€æ ·å¼ã€ä¸»å®¹å™¨ã€æ¨¡æ€æ¡†ã€ä»¥åŠä¾§è¾¹æ (æ–°å¢)
            if (el.tagName === 'SCRIPT' || el.tagName === 'STYLE' || el.tagName === 'LINK') continue;
            if (el.classList.contains('kokoro-volunteer-container') || el.closest('.kokoro-volunteer-container')) continue;
            if (el.classList.contains('modal') || el.closest('.modal') || el.classList.contains('modal-backdrop')) continue;
            if (el.classList.contains('zen-sidebar') || el.closest('.zen-sidebar')) continue; // [ä¿®å¤2] ä¿æŠ¤ä¾§è¾¹æ ä¸è¢«éšè—
            
            var rect = el.getBoundingClientRect();
            // ä»…ç§»é™¤å·¦ä¸‹è§’æˆ–åº•éƒ¨çš„å°å‹å¹²æ‰°å…ƒç´ 
            if (rect.width > 0 && rect.height > 0 && rect.width < 100 && rect.height < 100) {
                var distBottom = windowHeight - rect.bottom;
                var distLeft = rect.left;
                
                if ((distBottom >= 0 && distBottom < 120) || (distLeft >= 0 && distLeft < 120)) { // æ‰©å¤§æ‰“å‡»èŒƒå›´é€»è¾‘
                    // å†æ¬¡ç¡®è®¤ä¸æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒå…ƒç´ 
                    if (getComputedStyle(el).position === 'fixed') {
                         el.style.setProperty('display', 'none', 'important');
                         el.style.setProperty('visibility', 'hidden', 'important');
                         el.style.setProperty('opacity', '0', 'important');
                         el.style.setProperty('pointer-events', 'none', 'important');
                    }
                }
            }
        }
    } 

function injectStyles() {
        // [å…³é”®ä¿®æ”¹] ä½¿ç”¨å…¨æ–°çš„IDï¼Œå¼ºåˆ¶æµè§ˆå™¨åº”ç”¨æ–°æ ·å¼ï¼Œè§£å†³"æ²¡ååº”"çš„é—®é¢˜
        var styleId = 'kokoro-force-fix-v2026'; 
        if (document.getElementById(styleId)) return;

        var css = '';
        // 1. åŸºç¡€éšè—
        css += 'nav, header, footer, .sp-page-header, .navbar { display: none !important; } ';
        css += '.sp-page-row-options, .u_p_floating_container, .sn-chat-overlay, .theme-picker, .icon-palette { display: none !important; opacity: 0 !important; pointer-events: none !important; }';
        
        // 2. [ä¿®å¤é“ºæ»¡] ä¸»å®¹å™¨ï¼šå¼ºåˆ¶å›ºå®šå®šä½å…¨å±ï¼Œå±‚çº§è®¾ä¸º 1000 (ä½äºPortalåº•å±‚ä¹‹ä¸Š)
        css += '.kokoro-volunteer-container { position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; width: 100vw !important; height: 100vh !important; z-index: 1000 !important; background: #f4f4f4 !important; overflow: hidden !important; padding: 0 !important; margin: 0 !important; display: flex !important; flex-direction: column !important; }';
        
				// [ä¿®å¤é“ºæ»¡] å¼ºåˆ¶ board-container å’Œå…¶å†…éƒ¨çš„æ‰€æœ‰è§†å›¾å®¹å™¨å…¨å®½
        css += '.board-container { width: 100% !important; height: 100% !important; flex: 1 !important; padding: 20px !important; overflow-y: auto !important; box-sizing: border-box !important; max-width: none !important; margin: 0 !important; }';
        
        // [ä¿®å¤] å¼ºåˆ¶ç‰¹å®šçš„è§†å›¾å®¹å™¨å…¨å®½
        css += '.view-dashboard, .view-tactical, .view-mine, .view-requests, .card-section { width: 100% !important; max-width: none !important; display: block !important; }';
        
        // [ä¿®å¤] å¼ºåˆ¶ Grid ç³»ç»Ÿå æ»¡
        css += '.card-grid, .task-grid { width: 100% !important; display: grid !important; justify-content: start !important; }';

        // 4. [ä¿®å¤ä¾§è¾¹æ ] å¼ºåˆ¶ç™½è‰²èƒŒæ™¯ï¼Œå±‚çº§è®¾ä¸º 2000 (ä½äºä¸»å®¹å™¨ä¹‹ä¸Š)
        css += '.zen-sidebar { position: fixed !important; top: 0 !important; left: 0 !important; width: 280px !important; height: 100vh !important; background-color: #ffffff !important; background: #ffffff !important; z-index: 2000 !important; box-shadow: 5px 0 25px rgba(0,0,0,0.5) !important; }';

        var style = document.createElement('style');
        style.id = styleId;
        style.appendChild(document.createTextNode(css));
        document.head.appendChild(style);
    }
    // ============================================================
    // [PART 2] BUSINESS LOGIC & NEW FEATURES
    // ============================================================

    // ============================================================
    // ]]>ğŸ”<![CDATA[ SIDEBAR CONTROLLER
    // ============================================================
    c.showSidebar = false;

    c.toggleSidebar = function() {
        c.showSidebar = !c.showSidebar;
    };

    c.view = 'dashboard';

    // ============================================================
    // [DAY 5] PROCESS MINING & MONITORING DISPLAY
    // æ’å…¥ä½ç½®: c.view = 'dashboard'; ä¹‹å
    // ============================================================
    
    // åˆå§‹åŒ–Day5æ•°æ®ï¼ˆé˜²æ­¢undefinedé”™è¯¯ï¼‰
    if (!c.data.processMiningStats) {
        c.data.processMiningStats = {
            totalEvents: 0,
            todayEvents: 0,
            uniqueCases: 0,
            topActivities: []
        };
    }
    
    if (!c.data.systemMetrics) {
        c.data.systemMetrics = {
            healthScore: 100,
            lastCollected: '--',
            alerts: { critical: 0, warning: 0 }
        };
    }
    
    if (!c.data.auditStats) {
        c.data.auditStats = {
            todayLogs: 0,
            recentActions: []
        };
    }
    
    if (!c.data.overallHealth) {
        c.data.overallHealth = {
            score: 100,
            status: 'nominal',
            components: []
        };
    }
    
    // è·å–å¥åº·çŠ¶æ€æ˜¾ç¤ºä¿¡æ¯
    c.getHealthStatusDisplay = function() {
        var score = c.data.overallHealth.score;
        if (score >= 90) return { text: 'NOMINAL', class: 'nominal', color: '#34c759' };
        if (score >= 70) return { text: 'WARNING', class: 'warning', color: '#ff9500' };
        return { text: 'CRITICAL', class: 'critical', color: '#ff3b30' };
    };
    
    // è·å–æ´»åŠ¨å›¾æ ‡
    c.getActivityIcon = function(activityName) {
        var iconMap = {
            'Wish_Created': 'fa-plus-circle',
            'Wish_Submitted': 'fa-paper-plane',
            'Wish_Assigned': 'fa-user-plus',
            'Work_Started': 'fa-play',
            'Wish_Completed': 'fa-check-circle',
            'Wish_Cancelled': 'fa-times-circle',
            'Work_On_Hold': 'fa-pause-circle',
            'Work_Resumed': 'fa-play-circle',
            'SLA_Attached': 'fa-clock-o',
            'SLA_Warning_Triggered': 'fa-exclamation-circle',
            'SLA_Breached': 'fa-exclamation-triangle',
            'SLA_Achieved': 'fa-trophy',
            'Comment_Added': 'fa-comment',
            'Auto_Assignment_Executed': 'fa-magic',
            'Urgency_Changed': 'fa-arrow-up',
            'Zone_Changed': 'fa-map-marker'
        };
        return iconMap[activityName] || 'fa-circle';
    };
    
    // åˆ·æ–°ç›‘æ§æ•°æ®
    c.refreshMonitoringData = function() {
        c.server.update().then(function() {
            spUtil.addInfoMessage('ç›£è¦–ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
        });
    };
    
    // è·å–å¥åº·ç»„ä»¶é¢œè‰²
    c.getComponentColor = function(score) {
        if (score >= 90) return '#34c759';
        if (score >= 70) return '#ff9500';
        return '#ff3b30';
    };
    
    // æ ¼å¼åŒ–æ´»åŠ¨åç§°ï¼ˆå»æ‰ä¸‹åˆ’çº¿ï¼Œæ›´æ˜“è¯»ï¼‰
    c.formatActivityName = function(name) {
        if (!name) return 'Unknown';
        return name.replace(/_/g, ' ');
    };
    // ============================================================
    // [END OF DAY 5 CLIENT SCRIPT]
    // ============================================================

    c.currentTime = '';
    c.filteredList = null;
    c.currentFilter = null;

    // å­—å…¸ä¸çŠ¶æ€
    c.statusNames = { '1': 'DRAFT', '10': 'SUBMITTED', '11': 'ASSIGNED', '2': 'IN_PROGRESS', '4': 'COMPLETED', '5': 'CANCELLED', '6': 'ON_HOLD' };
    c.dict = { 'Water': 'é£²æ–™æ°´', 'Food': 'é£Ÿæ–™', 'Medical': 'åŒ»ç™‚ãƒ»è–¬', 'Baby': 'ä¹³å¹¼å…ç”¨å“', 'Power': 'é›»æºãƒ»å……é›»', 'Other': 'ãã®ä»–', 'Family Area': 'ãƒ•ã‚¡ãƒŸãƒªãƒ¼ã‚¨ãƒªã‚¢', 'Single Area': 'å˜èº«ã‚¨ãƒªã‚¢', 'Medical Area': 'åŒ»ç™‚ãƒ»ã‚±ã‚¢ã‚¨ãƒªã‚¢', 'Critical': 'é™ç•Œ (SOS)', 'High': 'å›°ã£ã¦ã„ã‚‹', 'Medium': 'æ™®é€š', 'Low': 'æ€¥ãã¾ã›ã‚“' };

    // === å¿—æ„¿è€…çŠ¶æ€åˆå§‹åŒ– ===
    c.volunteerStatus = {
        isOnline: true,
        currentZone: '',
        taskCount: 0
    };

    // ==========================================
    // çŠ¶æ€è½¬æ¢å›¾é€»è¾‘
    // ==========================================
    c.stateFlow = {
        1: { name: 'New', next: ['Submitted'], color: '#888' },
        10: { name: 'Submitted', next: ['Assigned', 'Cancelled'], color: '#007aff' },
        11: { name: 'Assigned', next: ['In Progress', 'On Hold', 'Cancelled'], color: '#5856d6' },
        2: { name: 'In Progress', next: ['On Hold', 'Completed', 'Cancelled'], color: '#ff9500' },
        6: { name: 'On Hold', next: ['In Progress', 'Completed', 'Cancelled'], color: '#ffcc00' },
        4: { name: 'Completed', next: [], color: '#34c759' },
        5: { name: 'Cancelled', next: [], color: '#ff3b30' }
    };

    c.getStateInfo = function(stateValue) {
        return c.stateFlow[stateValue] || { name: 'Unknown', next: [], color: '#888' };
    };

    // --- ç”»é¢è¿ç§» ---
    c.goToUserView = function() { $window.location.href = '?id=kokoro_user'; };

    // --- ç³»ç»Ÿæ—¶é’Ÿ ---
    function updateSystemTime() {
        var now = new Date();
        c.currentTime = ('0' + now.getHours()).slice(-2) + ':' + ('0' + now.getMinutes()).slice(-2) + ':' + ('0' + now.getSeconds()).slice(-2);
    }
    updateSystemTime();
    var timeInterval = $interval(updateSystemTime, 1000);

    // --- ç›¸å¯¹æ—¶é—´æ ¼å¼åŒ– ---
    c.formatTime24h = function(createdOn) {
        if (!createdOn) return '--:--';
        try {
            var date = new Date(createdOn);
            if (isNaN(date.getTime())) return '--:--';
            
            var now = new Date();
            var diffMs = now - date;
            var diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            var diffDays = Math.floor(diffHours / 24);
            
            if (diffDays > 0) {
                var h = ('0' + date.getHours()).slice(-2);
                var m = ('0' + date.getMinutes()).slice(-2);
                return diffDays + 'æ—¥å‰ ' + h + ':' + m;
            } else if (diffHours > 0) {
                return diffHours + 'æ™‚é–“å‰';
            } else {
                var diffMinutes = Math.floor(diffMs / (1000 * 60));
                return diffMinutes + 'åˆ†å‰';
            }
        } catch (e) { return '--:--'; }
    };

    // ==========================================
    // SLAæ˜¾ç¤ºæ ¼å¼åŒ–
    // ==========================================
    c.formatSLARemaining = function(minutes) {
        if (!minutes && minutes !== 0) return '--';
        minutes = parseInt(minutes) || 0;
        
        if (minutes < 0) {
            var overdue = Math.abs(minutes);
            if (overdue < 60) return '-' + overdue + 'åˆ†è¶…é';
            return '-' + Math.floor(overdue/60) + 'æ™‚é–“è¶…é';
        }
        
        if (minutes < 60) return minutes + 'åˆ†';
        if (minutes < 1440) return Math.floor(minutes/60) + 'æ™‚é–“' + (minutes%60 > 0 ? minutes%60 + 'åˆ†' : '');
        return Math.floor(minutes/1440) + 'æ—¥';
    };

    c.getSLAClass = function(sla) {
        if (!sla) return '';
        
        if (sla.is_breached || sla.status === 'critical') {
            return 'sla-critical';
        } else if (sla.status === 'warning') {
            return 'sla-warning';
        }
        return 'sla-ok';
    };

    c.getSLABarColor = function(sla) {
        if (!sla) return '#888';
        
        if (sla.is_breached || sla.status === 'critical') {
            return '#ff3b30';
        } else if (sla.status === 'warning') {
            return '#ff9500';
        }
        return '#34c759';
    };
    
    c.formatHours = function(minutes) { return c.formatSLARemaining(minutes); };

    // ==========================================
    // è‡ªåŠ¨åˆ†é…ä¸çŠ¶æ€
    // ==========================================
    c.triggerAutoAssign = function(sysId, forceReassign) {
        if (!sysId) return;
        
        c.server.get({
            action: 'trigger_auto_assign',
            sys_id: sysId,
            force_reassign: forceReassign || false
        }).then(function(response) {
            if (response.data.success) {
                spUtil.addInfoMessage('è‡ªå‹•åˆ†é…å®Œäº†: ' + response.data.assigned_to + 
                                     ' (ã‚¹ã‚³ã‚¢: ' + response.data.score + ')');
                c.server.update().then(processListItems);
            } else {
                spUtil.addErrorMessage('è‡ªå‹•åˆ†é…å¤±æ•—: ' + (response.data.error || 'å¿—é¡˜è€…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'));
            }
        });
    };

    c.updateMyLocation = function(zone) {
        if (!zone) return;
        
        c.server.get({
            action: 'update_location',
            zone: zone
        }).then(function(response) {
            if (response.data.success) {
                c.volunteerStatus.currentZone = zone;
                spUtil.addInfoMessage(response.data.message || 'ä½ç½®ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            }
        });
    };

    c.toggleAvailability = function() {
        var newStatus = !c.volunteerStatus.isOnline;
        
        c.server.get({
            action: 'set_availability',
            available: newStatus
        }).then(function(response) {
            if (response.data.success) {
                c.volunteerStatus.isOnline = newStatus;
                spUtil.addInfoMessage(response.data.message);
            }
        });
    };

    function processListItems() {
        if (c.data.list) { angular.forEach(c.data.list, function(item) { item.time_24h = c.formatTime24h(item.created_on); }); }
        if (c.data.myTasks) { angular.forEach(c.data.myTasks, function(item) { item.time_24h = c.formatTime24h(item.created_on); }); }
        if (c.data.myRequests) { angular.forEach(c.data.myRequests, function(item) { item.time_24h = c.formatTime24h(item.created_on); }); }
    }
    processListItems();

    // --- ç­›é€‰é€»è¾‘ ---
    c.filterByUrgency = function(u) { c.currentFilter = {type:'urgency', value:u}; c.filteredList = c.data.list.filter(function(i){return i.urgency===u;}); };
    c.filterByAssignment = function(s) { c.currentFilter = {type:'assignment', value:s}; c.filteredList = c.data.list.filter(function(i){return s==='unassigned' ? !i.assigned_to_id : !!i.assigned_to_id;}); };
    c.clearFilters = function() { c.currentFilter = null; c.filteredList = null; };

    // --- å®æ—¶ç›‘å¬ ---
    spUtil.recordWatch($scope, 'x_1821654_kokoro_0_silent_wish', '', function(name, data) {
        c.server.update().then(function() {
            processListItems();
        });
    });
    
    spUtil.recordWatch($scope, 'x_1821654_kokoro_0_kokoro_inventory', '', function() {
        c.server.update();
    });

    // --- è¾…åŠ©å‡½æ•° ---
    function showSuccess(msg) { spUtil.addInfoMessage(msg); }
    function showError(msg) { spUtil.addErrorMessage(msg || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
    function handleServerResponse(response, successCallback) {
        if (!response || !response.data) { showError('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼'); return false; }
        if (response.data.error) { showError(response.data.error); return false; }
        if (successCallback) successCallback(response.data);
        return true;
    }

    // --- æ¨¡æ€æ¡†é€»è¾‘ ---
    c.openModal = function(item) {
        if (!c.data.volunteers || c.data.volunteers.length === 0) {
            c.server.get({ action: 'get_volunteers' }).then(function(r) {
                if (r && r.data && r.data.volunteers) { c.data.volunteers = r.data.volunteers; }
            });
        }

        var modalInstance = $uibModal.open({
            templateUrl: 'volunteerModalTemplate',
            scope: $scope,
            size: 'lg',
            backdrop: 'static',
            windowClass: 'kokoro-modal-window'
        });

        $scope.item = angular.copy(item);
        $scope.c = c;
        $scope.newComment = '';
        $scope.statusMenuOpen = false;

        $scope.toggleStatusMenu = function($event) { if ($event) $event.stopPropagation(); $scope.statusMenuOpen = !$scope.statusMenuOpen; };
        $window.onclick = function() { if ($scope.statusMenuOpen) $timeout(function() { $scope.statusMenuOpen = false; }); };
        $scope.cancel = function() { modalInstance.dismiss('cancel'); };

        $scope.assignToMe = function(item) {
            c.server.get({ action: 'assign_to_me', sys_id: item.sys_id }).then(function(r) {
                handleServerResponse(r, function() {
                    item.assigned_to_id = c.data.user_id; item.assigned_to_name = c.data.user_name;
                    $scope.item.assigned_to_id = c.data.user_id; $scope.item.assigned_to_name = c.data.user_name;
                    if (item.state == 1 || item.state == 10) { item.state = 11; $scope.item.state = 11; }
                    showSuccess('æ‹…å½“è€…ã«è¨­å®šã—ã¾ã—ãŸ');
                    c.server.update().then(processListItems);
                });
            });
        };

        $scope.changeStatus = function(item, newState) {
            var ns = parseInt(newState);
            if (ns === 11 && !item.assigned_to_id) { $scope.assignToMe(item); return; }
            if (ns === 2 && !item.assigned_to_id) { showError('å…ˆã«æ‹…å½“è€…ã‚’è¨­å®šã—ã¦ãã ã•ã„'); return; }
            
            c.server.get({ action: 'change_status', sys_id: item.sys_id, new_state: newState }).then(function(r) {
                if (handleServerResponse(r, function() {
                    item.state = ns; $scope.item.state = ns; $scope.statusMenuOpen = false;
                    showSuccess('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                    c.server.update().then(processListItems);
                    if (ns === 4 || ns === 5) { $timeout(function() { modalInstance.close(); }, 1000); }
                }));
            });
        };

        $scope.postComment = function(item) {
            if (!$scope.newComment || !$scope.newComment.trim()) return;
            c.server.get({ action: 'add_comment', sys_id: item.sys_id, message: $scope.newComment }).then(function(r) {
                handleServerResponse(r, function() {
                    if (!item.history) item.history = [];
                    item.history.unshift({ user: c.data.user_name || 'Me', text: $scope.newComment, date: new Date().toLocaleString() });
                    $scope.item.history = item.history; $scope.newComment = '';
                    showSuccess('ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                });
            });
        };
        
        $scope.triggerAutoAssign = function(item) {
             c.triggerAutoAssign(item.sys_id, true);
        };

        modalInstance.result.finally(function() { c.server.update().then(processListItems); });
    };

    // --- Dashboard ç›´æ¥æ“ä½œ ---
    c.updateStatus = function(sys_id, action) {
        if (!sys_id || !action) return;
        c.server.get({ action: action, sys_id: sys_id }).then(function(r) {
            handleServerResponse(r, function() {
                showSuccess('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã—ã¾ã—ãŸ');
                c.server.update().then(processListItems);
            });
        });
    };

    // ==========================================
    // SLAæ˜¾ç¤ºå®šæ—¶å™¨ (å¢å¼ºç‰ˆ) â€” æ¯30ç§’æ›´æ–°
    // ==========================================
var slaUpdateInterval = $interval(function() {
        // æ›´æ–° data.list
        updateSLAForList(c.data.list);
        // æ›´æ–° data.myTasks
        updateSLAForList(c.data.myTasks);
        // æ›´æ–° data.myRequests
        updateSLAForList(c.data.myRequests);
    }, 30000);

    function updateSLAForList(list) {
        if (!list) return;
        angular.forEach(list, function(item) {
            // å¦‚æœæ²¡æœ‰SLAå¯¹è±¡ï¼Œæˆ–ä»»åŠ¡å·²åœæ­¢(å·²å®Œæˆ)ï¼Œåˆ™è·³è¿‡æ›´æ–°
            if (!item.sla || item.sla.is_stopped || item.state == 4 || item.state == 5) return;
            
            item.sla.elapsed = (item.sla.elapsed || 0) + 0.5;
            item.sla.remaining = Math.max(0, item.sla.target - item.sla.elapsed);
            item.sla.percentage = Math.min(100, Math.round((item.sla.elapsed / item.sla.target) * 100));
            
            if (item.sla.elapsed > item.sla.target) {
                item.sla.status = 'critical';
                item.sla.is_breached = true;
            } else if (item.sla.percentage >= 80) {
                item.sla.status = 'warning';
            }
        });
    }

    // èµ„æºæ¸…ç†
    $scope.$on('$destroy', function() {
        if (timeInterval) $interval.cancel(timeInterval);
        if (slaUpdateInterval) $interval.cancel(slaUpdateInterval);
        if (sniperInterval) $interval.cancel(sniperInterval);
    });
};]]></client_script>
        <controller_as>c</controller_as>
        <css>/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 0: SERVICENOW ELIMINATION - ç»å¯¹ä¸å¯åˆ é™¤
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
nav, header, footer, .sp-page-header, .navbar, .polaris-header, 
.sn-polaris-nav, .sn-canvas-header, #sp-nav-bar, .sp-row-background,
.cms-header, .navpage-header, .navpage-footer {
  display: none !important;
  height: 0 !important;
  visibility: hidden !important;
}

.sn-chat-overlay, .help-button-wrapper, .sp-ac-root, .sw-session-repro-button,
button.help-button, .sn-connect-floating-wrapper, #u_chat_button, .cm-help-button,
.sp-page-row-options, .theme-picker, .sp-debug-tool, div[ng-controller="spPageRowOptions"],
a[title="Toggle Layout"], .btn-floating, .sp-icon-edit,
.guided-tour-overlay, .code-editor-container, .icon-palette, .fa-cog, 
.sp-icon-color, .sp-preview-pill, .u_p_floating_container,
[class*="intercom"], [class*="chat-widget"], [id*="chat"],
div[style*="position: fixed"][style*="bottom"][style*="right"] {
  display: none !important;
  visibility: hidden !important;
  width: 0 !important; 
  height: 0 !important;
  pointer-events: none !important;
  opacity: 0 !important;
  z-index: -9999 !important;
  position: absolute !important;
  left: -9999px !important;
}

body &gt; div[style*="position: fixed"][style*="bottom"],
body &gt; div[style*="position:fixed"][style*="bottom"],
body &gt; button[style*="position: fixed"][style*="bottom"],
body &gt; div[style*="position: fixed"][style*="left"], 
body &gt; div[style*="position:fixed"][style*="left"],
body &gt; div[style*="position: fixed"][style*="right"],
body &gt; iframe[style*="position: fixed"] {
  display: none !important;
  opacity: 0 !important;
  pointer-events: none !important;
  z-index: -9999 !important;
}

html, body {
  height: 100% !important;
  width: 100% !important;
  overflow: hidden !important;
  position: fixed !important;
  background: #0a0a0a !important;
  margin: 0 !important;
  padding: 0 !important;
  font-size: 14px !important;
}

.modal { z-index: 1050000 !important; position: fixed !important; }
.modal-backdrop { z-index: 1049999 !important; background-color: rgba(0,0,0,0.95) !important; }
.modal-dialog { z-index: 1050001 !important; }

/* ============================================================
   [DAY 5] PROCESS MINING &amp; MONITORING STYLES
   æ’å…¥ä½ç½®: &lt;/style&gt; ä¹‹å‰
   ============================================================ */

/* Monitoring Panel Container */
.monitoring-panel {
    background: #fff;
    border: 1px solid #ddd;
    padding: 16px;
    margin-top: 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.03);
}

/* Health Gauge */
.health-gauge {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 15px 0;
}

.gauge-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border: 4px solid #ddd;
    background: #f8f8f8;
    transition: all 0.3s;
    flex-shrink: 0;
}

.gauge-circle.nominal {
    border-color: var(--color-success);
    background: rgba(52, 199, 89, 0.1);
}

.gauge-circle.warning {
    border-color: var(--color-warning);
    background: rgba(255, 149, 0, 0.1);
}

.gauge-circle.critical {
    border-color: var(--color-critical);
    background: rgba(255, 59, 48, 0.1);
    animation: pulse-critical 1s ease-in-out infinite;
}

@keyframes pulse-critical {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.gauge-value {
    font-family: var(--font-tech);
    font-size: 28px;
    font-weight: 900;
    color: var(--text-primary);
}

.gauge-label {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-tertiary);
    letter-spacing: 1px;
}

.gauge-info {
    flex: 1;
}

.gauge-status {
    font-family: var(--font-header);
    font-size: 16px;
    font-weight: 800;
    letter-spacing: 2px;
    margin-bottom: 8px;
}

.gauge-components {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    font-family: var(--font-mono);
    font-size: 11px;
}

.gauge-components span {
    font-weight: 600;
}

/* PM Metrics Grid */
.pm-metrics {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin: 15px 0;
}

.pm-metric-item {
    text-align: center;
    padding: 12px 8px;
    background: #f8f8f8;
    border-left: 3px solid #000;
}

.pm-metric-label {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-tertiary);
    letter-spacing: 1px;
    margin-bottom: 6px;
}

.pm-metric-value {
    font-family: var(--font-tech);
    font-size: 22px;
    font-weight: 800;
    color: var(--text-primary);
}

/* Activity Distribution */
.activity-distribution {
    margin: 15px 0;
}

.dist-title {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text-tertiary);
    letter-spacing: 1px;
    margin-bottom: 10px;
}

.dist-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
    font-size: 13px;
}

.dist-item:last-child {
    border-bottom: none;
}

.dist-item i {
    color: var(--accent-primary);
    width: 20px;
    text-align: center;
}

.dist-name {
    flex: 1;
    color: var(--text-secondary);
    font-family: var(--font-mono);
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.dist-count {
    font-family: var(--font-tech);
    font-weight: 700;
    color: var(--text-primary);
}

/* No Data Hint */
.no-data-hint {
    text-align: center;
    padding: 20px;
    color: var(--text-tertiary);
    font-size: 13px;
}

.no-data-hint i {
    margin-right: 8px;
}

/* Alert Summary (Day5 monitoring rows â€” scoped to avoid clash with main .alert-row) */
.alert-summary {
    margin: 15px 0;
}

.alert-summary .alert-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: #f8f8f8;
    margin-bottom: 8px;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s;
}

.alert-summary .alert-row:last-child {
    margin-bottom: 0;
}

.alert-summary .alert-row i {
    color: var(--text-tertiary);
    width: 18px;
    text-align: center;
}

.alert-summary .alert-row span:first-of-type {
    flex: 1;
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 1px;
}

.alert-count {
    font-family: var(--font-tech);
    font-weight: 800;
    font-size: 16px;
}

.alert-summary .alert-row.critical {
    background: rgba(255, 59, 48, 0.1);
    border-left: 3px solid var(--color-critical);
}

.alert-summary .alert-row.critical i,
.alert-summary .alert-row.critical .alert-count {
    color: var(--color-critical);
}

.alert-summary .alert-row.warning {
    background: rgba(255, 149, 0, 0.1);
    border-left: 3px solid var(--color-warning);
}

.alert-summary .alert-row.warning i,
.alert-summary .alert-row.warning .alert-count {
    color: var(--color-warning);
}

/* Recent Audit */
.recent-audit {
    margin: 15px 0;
}

.audit-item {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px dashed #eee;
    font-size: 12px;
}

.audit-item:last-child {
    border-bottom: none;
}

.audit-action {
    color: var(--text-secondary);
    font-weight: 600;
}

.audit-user {
    color: var(--text-tertiary);
    font-family: var(--font-mono);
    font-size: 11px;
}

/* Refresh Button */
.refresh-btn {
    width: 100%;
    padding: 12px;
    background: #000;
    color: #fff;
    border: none;
    font-family: var(--font-mono);
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 15px;
}

.refresh-btn:hover {
    background: #333;
}

.refresh-btn i {
    margin-right: 8px;
}

/* Day5 Responsive */
@media (max-width: 400px) {
    .pm-metrics {
        grid-template-columns: 1fr;
    }
    
    .health-gauge {
        flex-direction: column;
        text-align: center;
    }
    
    .gauge-components {
        justify-content: center;
    }
}
/* ============================================================
   [END OF DAY 5 CSS]
   ============================================================ */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 1: KOKORO OS // VISUAL CORE [REFACTORED: ENDFIELD_PROTOCOL]
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&amp;family=Rajdhani:wght@400;500;600;700&amp;family=JetBrains+Mono:wght@400;700&amp;display=swap');

.kokoro-volunteer-container {
  /* â”€â”€â”€ BASE: å·¥ä¸šç°åº¦ (Industrial Grayscale) â”€â”€â”€ */
  --bg-core: #F2F3F5;       /* ç±»ä¼¼ç»ˆæœ«åœ°çš„å·¥ä¸šæ··å‡åœŸç™½ */
  --bg-primary: #FFFFFF;    /* çº¯å‡€æ“ä½œå±‚ */
  --bg-secondary: #E5E8EB;  /* æ¬¡çº§é¢æ¿ç° */
  --bg-tertiary: #D3D7DB;   /* è£…é¥°æ€§æ·±ç° */
  --bg-panel: rgba(255, 255, 255, 0.85); /* ç£¨ç ‚ç»ç’ƒåŸºåº• */
  
  /* â”€â”€â”€ DECORATION: ç§‘æŠ€çº¹ç† â”€â”€â”€ */
  --tech-grid: radial-gradient(#BDC3C7 1px, transparent 1px); /* ç‚¹é˜µç½‘æ ¼ */
  --tech-grid-size: 20px 20px;

  /* â”€â”€â”€ BORDERS: æ„æˆä¸»ä¹‰çº¿æ¡ â”€â”€â”€ */
  --border-hairline: 1px solid rgba(0, 0, 0, 0.1);  /* éšå½¢åˆ†å‰²çº¿ */
  --border-main: 1px solid #1A1A1A;                 /* ä¸»ç»“æ„çº¿ï¼ˆç»å¯¹é»‘ï¼‰ */
  --border-bold: 2px solid #000000;                 /* å¼ºè°ƒè¾¹æ¡† */
  --border-tech: 1px solid rgba(0, 0, 0, 0.2);      /* è£…é¥°æ€§ç§‘æŠ€çº¿ */
  
  /* â”€â”€â”€ TEXT: ç»ˆç«¯æ˜¾ç¤ºé£æ ¼ â”€â”€â”€ */
  --text-primary: #0F0F0F;      /* æ¥è¿‘çº¯é»‘ */
  --text-secondary: #586069;    /* å·¥ä¸šç°å­— */
  --text-tertiary: #8C959F;     /* ç¦ç”¨/æ³¨é‡Šæ€ */
  --text-code: #24292E;         /* ä»£ç /æ•°æ® */
  --text-inverse: #FFFFFF;      /* åè‰²æ–‡æœ¬ï¼ˆç”¨äºé»‘è‰²å—ä¸Šï¼‰ */

  /* â”€â”€â”€ ACCENTS: æˆ˜æœ¯ä¿¡å·è‰² (Tactical Signals) â”€â”€â”€ */
  /* è¿™é‡Œçš„é»‘è‰²ä¸å†æ˜¯æ™®é€šçš„é»‘ï¼Œè€Œæ˜¯å¸¦æœ‰å…‰æ³½çš„â€œé»‘æ›œçŸ³â€æ„Ÿ */
  --accent-primary: #000000; 
  --accent-secondary: #2C2C2C;
  
  /* è¾…åŠ©ä¿¡å·è‰²ï¼šé«˜é¥±å’Œåº¦ï¼Œç”¨äºæ¨¡æ‹ŸHUDè­¦å‘Šç¯ */
  --signal-cyan: #005cc5;   /* ç»ˆç«¯æŒ‡ä»¤è“ */
  --signal-amber: #d29922;  /* è­¦å‘Š/æ³¨æ„ */
  --signal-crimson: #cf222e;/* è‡´å‘½é”™è¯¯ */
  --signal-teal: #2E8B57;   /* ç”Ÿå‘½ä½“å¾/æ­£å¸¸ */

  /* â”€â”€â”€ FUNCTIONAL: è¯­ä¹‰æ˜ å°„ â”€â”€â”€ */
  --color-success: var(--signal-teal);
  --color-warning: var(--signal-amber);
  --color-critical: var(--signal-crimson);
  --color-info: var(--signal-cyan);
  
  /* â”€â”€â”€ EFFECTS: è§†è§‰ç‰¹æ•ˆ â”€â”€â”€ */
  --glass-blur: blur(12px);
  --shadow-flat: 4px 4px 0px rgba(0,0,0,0.1); /* ç¡¬é˜´å½±ï¼Œéå¼¥æ•£é˜´å½± */
  --shadow-float: 0 8px 24px rgba(0,0,0,0.08);

  /* â”€â”€â”€ TYPOGRAPHY: å­—ä½“æ ˆ â”€â”€â”€ */
  --font-display: 'Orbitron', sans-serif;       /* ç”¨äºå¤§æ ‡é¢˜/æ•°å­— */
  --font-ui: 'Rajdhani', sans-serif;            /* æ ¸å¿ƒUIå­—ä½“ï¼Œæå…·ç§‘æŠ€æ„Ÿ */
  --font-mono: 'JetBrains Mono', monospace;     /* æ•°æ®/ID */
  
  /* â”€â”€â”€ ANIMATION â”€â”€â”€ */
  --ease-tech: cubic-bezier(0.22, 1, 0.36, 1);  /* æœºæ¢°å›å¼¹æ„Ÿ */
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLOBAL OVERRIDES (å¼ºåˆ¶åº”ç”¨é£æ ¼)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* å…¨å±€èƒŒæ™¯å¢åŠ ç‚¹é˜µçº¹ç† */
.kokoro-volunteer-container {
    background-color: var(--bg-core);
    background-image: var(--tech-grid);
    background-size: var(--tech-grid-size);
    font-family: var(--font-ui); /* é»˜è®¤ä½¿ç”¨ Rajdhani */
    letter-spacing: 0.02em;      /* ç¨å¾®å¢åŠ å­—é—´è·ï¼Œå¢åŠ é€šé€æ„Ÿ */
}

/* å¼ºè°ƒæ–‡å­—å˜ä¸ºç­‰å®½æˆ–è€…æ˜¯æœºèƒ½å­—ä½“ */
.kokoro-volunteer-container h1, 
.kokoro-volunteer-container h2, 
.kokoro-volunteer-container .ticket-title {
    font-family: var(--font-ui);
    font-weight: 700;
    text-transform: uppercase; /* å¼ºåˆ¶å¤§å†™ï¼Œæ›´åƒå†›ç”¨ç»ˆç«¯ */
}

/* æ•°å­—å¼ºåˆ¶ä½¿ç”¨ç­‰å®½å­—ä½“ */
.kokoro-volunteer-container .sb-role,
.kokoro-volunteer-container .nav-num,
.kokoro-volunteer-container .header-id {
    font-family: var(--font-mono);
    letter-spacing: -0.05em;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPONENT FIXES (æ ·å¼ä¿®æ­£)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kokoro-volunteer-container .wish-card, 
.kokoro-volunteer-container .sidebar-block, 
.kokoro-volunteer-container .ai-card {
    background-color: var(--bg-card);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    border: 1px solid var(--border-mid);
    color: var(--text-primary);
}

.kokoro-volunteer-container h1,
.kokoro-volunteer-container h2, 
.kokoro-volunteer-container h3, 
.kokoro-volunteer-container .logo-text,
.kokoro-volunteer-container .stat-value {
    color: var(--text-primary) !important;
}

.kokoro-volunteer-container .sb-label,
.kokoro-volunteer-container .ai-head {
    color: var(--text-secondary);
    font-weight: 700;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 2: ANIMATIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes pulse-glow {
  0%, 100% { 
    box-shadow: 0 0 5px var(--accent-glow), 0 0 10px var(--accent-glow);
    opacity: 1;
  }
  50% { 
    box-shadow: 0 0 15px var(--accent-glow), 0 0 25px var(--accent-glow);
    opacity: 0.85;
  }
}

@keyframes scanline {
  0% { transform: translateY(-100%); opacity: 0; }
  10% { opacity: 0.6; }
  90% { opacity: 0.6; }
  100% { transform: translateY(100vh); opacity: 0; }
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@keyframes data-stream {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes slide-in {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes border-pulse {
  0%, 100% { border-color: var(--border-mid); }
  50% { border-color: var(--accent-primary); }
}

@keyframes critical-flash {
  0%, 100% { background-color: var(--color-critical); }
  50% { background-color: #ff6666; }
}

@keyframes bar-fill {
  from { width: 0; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 3: MAIN CONTAINER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kokoro-volunteer-container {
  font-family: var(--font-body);
  font-size: 15px !important;
  line-height: 1.5;
  position: fixed !important;
  top: 0; left: 0; right: 0; bottom: 0;
  z-index: 100 !important;
  background: var(--bg-primary);
  color: var(--text-primary);
  overflow-y: auto;
  overflow-x: hidden;
}

.kokoro-volunteer-container::after {
  content: '';
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image: 
    linear-gradient(rgba(0,255,136,0.02) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,255,136,0.02) 1px, transparent 1px);
  background-size: 60px 60px;
  pointer-events: none;
  z-index: -1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 4: METAL DIVIDERS - é‡‘å±åˆ†å‰²çº¿
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.metal-divider {
  height: 2px;
  background: var(--metal-gradient);
  margin: 24px 0;
  position: relative;
  overflow: hidden;
}

.metal-divider::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  background-size: 200% 100%;
  animation: shimmer 3s ease-in-out infinite;
}

.metal-divider-glow {
  height: 2px;
  background: var(--metal-glow);
  margin: 24px 0;
  box-shadow: 0 0 10px var(--accent-glow), 0 0 20px var(--accent-glow);
}

.metal-divider-thick {
  height: 4px;
  background: linear-gradient(180deg, #3a3a3a, #1a1a1a, #3a3a3a);
  border-top: 1px solid #4a4a4a;
  border-bottom: 1px solid #0a0a0a;
  margin: 28px 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 5: SAFETY BANNER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.safety-banner {
  background: linear-gradient(90deg, var(--color-critical), #cc2222);
  color: #fff;
  padding: 14px 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-family: var(--font-mono);
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 1px;
  animation: critical-flash 2s ease-in-out infinite;
  border-bottom: 2px solid rgba(255,255,255,0.3);
}

.safety-banner button {
  background: rgba(0,0,0,0.5);
  border: 2px solid rgba(255,255,255,0.5);
  color: #fff;
  padding: 8px 20px;
  font-family: var(--font-mono);
  font-weight: 700;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.3s;
}

.safety-banner button:hover {
  background: #fff;
  color: var(--color-critical);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 6: COMMAND HEADER - ä¿®å¤å¸ƒå±€
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.command-header {
  background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
  border-bottom: 2px solid var(--border-mid);
  padding: 20px 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 500;
  gap: 20px;
  flex-wrap: nowrap;
}

.command-logo {
  display: flex;
  align-items: center;
  gap: 20px;
  flex-shrink: 0;
  min-width: 0;
}

.logo-icon {
  width: 56px;
  height: 56px;
  background: var(--accent-primary);
  color: var(--bg-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-weight: 900;
  font-size: 28px;
  clip-path: polygon(0 10px, 10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%);
  animation: pulse-glow 3s ease-in-out infinite;
  flex-shrink: 0;
}

.logo-text {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex-shrink: 0;
  min-width: 0;
}

.logo-title {
  font-family: var(--font-display);
  font-size: 28px;
  font-weight: 800;
  color: var(--text-primary);
  letter-spacing: 6px;
  text-shadow: 0 0 20px var(--accent-glow);
  white-space: nowrap;
}

.logo-subtitle {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-tertiary);
  letter-spacing: 3px;
  white-space: nowrap;
}

.system-status {
  display: flex;
  align-items: center;
  gap: 24px;
  font-family: var(--font-mono);
  font-size: 13px;
  flex-shrink: 0;
  margin-left: auto;
}

.status-indicator {
  display: flex;
  align-items: center;
  gap: 10px;
}

.status-dot {
  width: 10px;
  height: 10px;
  background: var(--accent-primary);
  border-radius: 2px;
  animation: pulse-glow 2s ease-in-out infinite;
  flex-shrink: 0;
}

.status-text {
  color: var(--accent-primary);
  font-weight: 700;
  white-space: nowrap;
}

.version-tag {
  color: var(--text-muted);
  padding: 4px 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-mid);
  white-space: nowrap;
}

.system-time {
  color: var(--text-secondary);
  font-weight: 600;
  font-size: 16px;
  white-space: nowrap;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 7: NAVIGATION TABS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.nav-tabs-custom {
  background: var(--bg-tertiary);
  display: flex;
  gap: 0;
  border-bottom: 2px solid var(--border-mid);
  padding: 0 40px;
}

.nav-tabs-custom .tab {
  padding: 18px 36px;
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  color: var(--text-tertiary);
  font-family: var(--font-body);
  font-weight: 700;
  font-size: 15px;
  letter-spacing: 2px;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  white-space: nowrap;
}

.nav-tabs-custom .tab:hover {
  color: var(--text-secondary);
  background: rgba(0,255,136,0.05);
}

.nav-tabs-custom .tab.active {
  color: var(--accent-primary);
  border-bottom-color: var(--accent-primary);
  text-shadow: 0 0 15px var(--accent-glow);
}

.tab-number {
  font-family: var(--font-display);
  font-weight: 800;
  margin-right: 8px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 8: SCAN LINE HEADER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scan-line-header {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 14px 40px;
  background: var(--bg-primary);
  border-bottom: 1px solid var(--border-dark);
}

.scan-line {
  flex: 1;
  height: 2px;
  background: var(--metal-gradient);
}

.scan-label {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 4px;
  animation: data-stream 2s ease-in-out infinite;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 9: BOARD CONTAINER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.board-container {
  padding: 24px 32px 120px; /* è°ƒæ•´å†…è¾¹è·ä»¥é€‚åº”å…¨å± */
  max-width: none !important; /* æ ¸å¿ƒä¿®å¤ï¼šç§»é™¤æœ€å¤§å®½åº¦é™åˆ¶ */
  width: 100% !important;     /* æ ¸å¿ƒä¿®å¤ï¼šå¼ºåˆ¶å æ»¡çˆ¶å®¹å™¨ */
  margin: 0 !important;       /* æ ¸å¿ƒä¿®å¤ï¼šç§»é™¤å±…ä¸­ Margin */
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 10: VOLUNTEER STATUS PANEL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.volunteer-status-panel {
  background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%);
  border: 2px solid var(--border-mid);
  border-left: 4px solid var(--accent-primary);
  padding: 20px 32px;
  margin-bottom: 28px;
  display: flex;
  align-items: center;
  gap: 48px;
  position: relative;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

.volunteer-status-panel::before {
  content: 'OPERATOR_STATUS';
  position: absolute;
  top: 8px;
  right: 20px;
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--accent-primary);
  letter-spacing: 2px;
  animation: data-stream 2s ease-in-out infinite;
}

.status-row {
  display: flex;
  align-items: center;
  gap: 14px;
  font-weight: 700;
  color: var(--text-secondary);
  font-size: 15px;
}

.status-row i {
  color: var(--accent-primary);
  width: 24px;
  font-size: 18px;
}

.btn-online {
  background: var(--accent-primary);
  color: var(--bg-primary);
  border: none;
  padding: 10px 24px;
  font-family: var(--font-mono);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 1px;
  cursor: pointer;
  clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
  animation: pulse-glow 2s ease-in-out infinite;
  transition: transform 0.2s;
}

.btn-online:hover {
  transform: scale(1.05);
}

.btn-offline {
  background: var(--border-light);
  color: var(--text-tertiary);
  border: none;
  padding: 10px 24px;
  font-family: var(--font-mono);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 1px;
  cursor: pointer;
  clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
}

.status-row select {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  border: 2px solid var(--border-light);
  padding: 10px 16px;
  font-family: var(--font-mono);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
}

.status-row select:focus {
  outline: none;
  border-color: var(--accent-primary);
  box-shadow: 0 0 15px var(--accent-glow);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 11: SECTION HEADERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-section, .alert-section, .card-section {
  margin-bottom: 36px;
}

.section-header {
  display: flex;
  align-items: center;
  gap: 20px;
  padding-bottom: 18px;
  margin-bottom: 24px;
  border-bottom: 2px solid var(--border-mid);
  position: relative;
}

.section-header::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--metal-gradient);
}

.section-tag {
  background: var(--accent-primary);
  color: var(--bg-primary);
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 12px;
  padding: 6px 16px;
  letter-spacing: 2px;
  clip-path: polygon(0 0, calc(100% - 6px) 0, 100% 6px, 100% 100%, 6px 100%, 0 calc(100% - 6px));
  box-shadow: 0 0 15px var(--accent-glow);
}

.section-title {
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 18px;
  color: var(--text-primary);
  letter-spacing: 4px;
}

.section-time {
  margin-left: auto;
  font-family: var(--font-mono);
  font-size: 14px;
  color: var(--text-tertiary);
  animation: data-stream 2s ease-in-out infinite;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 12: STAT CARDS - KPI METRICS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}

.stat-card {
  background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%);
  border: 2px solid var(--border-mid);
  padding: 24px;
  position: relative;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  overflow: hidden;
  animation: slide-in 0.5s ease-out;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0; right: 0;
  width: 20px; height: 20px;
  background: linear-gradient(135deg, var(--bg-primary) 50%, transparent 50%);
}

.stat-card::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0;
  width: 20px; height: 20px;
  background: linear-gradient(-45deg, var(--bg-primary) 50%, transparent 50%);
}

.stat-card:hover {
  border-color: var(--accent-primary);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px rgba(0,0,0,0.5), 0 0 30px var(--accent-glow);
}

.stat-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
}

.stat-code {
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 16px;
  color: var(--accent-primary);
  letter-spacing: 2px;
}

.stat-suffix {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-muted);
}

.stat-num {
  font-family: var(--font-display);
  font-size: 48px;
  font-weight: 900;
  color: var(--text-primary);
  line-height: 1;
  margin: 12px 0;
  text-shadow: 0 0 30px rgba(255,255,255,0.1);
}

.stat-name {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-tertiary);
  letter-spacing: 2px;
  margin-bottom: 16px;
}

.stat-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 16px;
  border-top: 2px solid var(--border-mid);
  position: relative;
}

.stat-footer::before {
  content: '';
  position: absolute;
  top: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--metal-gradient);
}

.stat-change {
  font-family: var(--font-mono);
  font-size: 13px;
  font-weight: 700;
}

.stat-change.positive {
  color: var(--accent-primary);
  text-shadow: 0 0 10px var(--accent-glow);
}

.stat-change.negative {
  color: var(--color-critical);
  text-shadow: 0 0 10px var(--color-critical-glow);
}

.stat-status {
  font-family: var(--font-mono);
  font-size: 11px;
  padding: 4px 12px;
  letter-spacing: 1px;
  font-weight: 700;
}

.stat-status.nominal {
  background: var(--border-mid);
  color: var(--text-secondary);
}

.stat-status.warning {
  background: rgba(255,170,0,0.2);
  color: var(--color-warning);
  box-shadow: 0 0 10px var(--color-warning-glow);
}

.stat-status.critical {
  background: rgba(255,68,68,0.2);
  color: var(--color-critical);
  box-shadow: 0 0 10px var(--color-critical-glow);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 13: TWO COLUMN LAYOUT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.two-column-layout {
  display: grid;
  grid-template-columns: 1fr 420px;
  gap: 28px;
  margin-top: 28px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 14: ALERT FEED
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.alert-section {
  background: var(--bg-card);
  border: 2px solid var(--border-mid);
  overflow: hidden;
  box-shadow: 0 4px 24px rgba(0,0,0,0.4);
}

.alert-section .section-header {
  padding: 18px 24px;
  margin: 0;
  background: linear-gradient(180deg, var(--bg-tertiary) 0%, var(--bg-card) 100%);
  border-bottom: 2px solid var(--border-mid);
}

.alert-list {
  max-height: 520px;
  overflow-y: auto;
}

.alert-item {
  display: grid;
  grid-template-columns: 110px 70px 80px 70px 1fr 36px;
  gap: 14px;
  padding: 16px 24px;
  border-bottom: 1px solid var(--border-dark);
  align-items: center;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

.alert-item::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 4px;
  background: var(--border-light);
  transition: all 0.3s;
}

.alert-item:hover {
  background: rgba(0,255,136,0.03);
}

.alert-item:hover::before {
  background: var(--accent-primary);
  box-shadow: 0 0 15px var(--accent-glow);
}

.alert-item.priority-Critical::before {
  background: var(--color-critical);
  box-shadow: 0 0 10px var(--color-critical-glow);
}

.alert-item.priority-High::before {
  background: var(--color-warning);
  box-shadow: 0 0 10px var(--color-warning-glow);
}

.alert-id {
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--text-secondary);
  font-weight: 700;
}

.alert-priority {
  font-family: var(--font-display);
  font-size: 11px;
  padding: 5px 10px;
  font-weight: 800;
  text-align: center;
  letter-spacing: 1px;
  clip-path: polygon(0 0, calc(100% - 5px) 0, 100% 5px, 100% 100%, 5px 100%, 0 calc(100% - 5px));
}

.alert-priority.p-critical {
  background: var(--color-critical);
  color: #fff;
  box-shadow: 0 0 10px var(--color-critical-glow);
}

.alert-priority.p-high {
  background: var(--color-warning);
  color: var(--bg-primary);
}

.alert-priority.p-medium {
  background: var(--border-highlight);
  color: var(--text-primary);
}

.alert-priority.p-low {
  background: var(--border-light);
  color: var(--text-secondary);
}

.alert-zone {
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--text-tertiary);
  font-weight: 600;
}

.alert-time {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-muted);
}

.alert-content {
  font-size: 14px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 600;
}

.alert-arrow {
  color: var(--text-muted);
  font-family: var(--font-display);
  font-size: 18px;
  transition: all 0.3s;
}

.alert-item:hover .alert-arrow {
  color: var(--accent-primary);
  transform: translateX(4px);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 15: SIDE PANEL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.side-panel-wrapper {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.side-panel-enhanced {
  background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%);
  border: 2px solid var(--border-mid);
  padding: 24px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.4);
}

.data-stream-widget {
  margin-bottom: 20px;
}

.widget-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 16px;
  margin-bottom: 20px;
  border-bottom: 2px solid var(--border-mid);
  position: relative;
}

.widget-header::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--metal-gradient);
}

.widget-title {
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 14px;
  color: var(--text-secondary);
  letter-spacing: 2px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.widget-title i {
  color: var(--accent-primary);
  font-size: 16px;
}

.live-indicator {
  width: 10px;
  height: 10px;
  background: var(--accent-primary);
  border-radius: 2px;
  animation: pulse-glow 1.5s ease-in-out infinite;
}

.live-metric-card {
  background: var(--bg-tertiary);
  border-left: 4px solid var(--accent-primary);
  padding: 18px;
  margin-bottom: 14px;
  transition: all 0.3s;
}

.live-metric-card:hover {
  background: var(--bg-elevated);
  transform: translateX(4px);
  box-shadow: 0 0 20px var(--accent-glow);
}

.metric-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.metric-label {
  font-size: 15px;
  font-weight: 700;
  color: var(--text-secondary);
}

.metric-value {
  font-family: var(--font-display);
  font-weight: 900;
  font-size: 28px;
  color: var(--accent-primary);
  text-shadow: 0 0 15px var(--accent-glow);
}

.metric-mini-bar {
  height: 6px;
  background: var(--border-mid);
  overflow: hidden;
  border-radius: 3px;
}

.metric-mini-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
  background-size: 200% 100%;
  animation: shimmer 2s ease-in-out infinite, bar-fill 1s ease-out;
  border-radius: 3px;
}

.ai-insight-card {
  background: linear-gradient(135deg, rgba(68,170,255,0.08) 0%, var(--bg-card) 100%);
  border: 2px solid var(--border-mid);
  border-left: 4px solid var(--color-info);
  padding: 20px;
}

.ai-header {
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 13px;
  color: var(--color-info);
  letter-spacing: 2px;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.ai-content {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.7;
  margin-bottom: 14px;
}

.ai-content strong {
  color: var(--accent-primary);
  font-weight: 700;
}

.ai-tags {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.ai-tag {
  background: var(--border-mid);
  color: var(--text-secondary);
  padding: 4px 12px;
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 16: RESOURCE SECTION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.resource-section-enhanced {
  background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%);
  border: 2px solid var(--border-mid);
  padding: 24px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.4);
}

.resource-section-enhanced .section-header {
  padding: 0 0 18px 0;
  margin-bottom: 24px;
}

.resource-item {
  margin-bottom: 20px;
}

.resource-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.resource-header .label {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
  font-weight: 700;
  color: var(--text-secondary);
}

.resource-header .code {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--accent-primary);
  font-weight: 700;
}

.resource-header .percent {
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 18px;
  color: var(--text-primary);
}

.resource-bar {
  height: 10px;
  background: var(--border-mid);
  border: 1px solid var(--border-light);
  overflow: hidden;
  position: relative;
}

.resource-fill {
  height: 100%;
  position: relative;
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.resource-fill::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  background-size: 200% 100%;
  animation: shimmer 2s ease-in-out infinite;
}

.resource-fill.low {
  background: linear-gradient(90deg, var(--color-critical), #ff6666);
  box-shadow: inset 0 0 10px var(--color-critical-glow);
}

.resource-fill.medium {
  background: linear-gradient(90deg, var(--color-warning), #ffcc44);
  box-shadow: inset 0 0 10px var(--color-warning-glow);
}

.resource-fill.high {
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
  box-shadow: inset 0 0 10px var(--accent-glow);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 17: TASK CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card-grid, .task-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 24px;
}

.jira-card {
  background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%);
  border: 2px solid var(--border-mid);
  padding: 24px;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  position: relative;
  overflow: hidden;
  animation: slide-in 0.5s ease-out;
}

.jira-card::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 4px;
  background: var(--border-light);
  transition: all 0.3s;
}

.jira-card:hover {
  border-color: var(--accent-primary);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px rgba(0,0,0,0.5), 0 0 30px var(--accent-glow);
}

.jira-card:hover::before {
  background: var(--accent-primary);
  box-shadow: 0 0 15px var(--accent-glow);
}

.jira-card.priority-Critical::before {
  background: var(--color-critical);
  box-shadow: 0 0 10px var(--color-critical-glow);
}

.jira-card.priority-High::before {
  background: var(--color-warning);
  box-shadow: 0 0 10px var(--color-warning-glow);
}

.card-top {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 16px;
}

.card-id {
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--text-tertiary);
  font-weight: 700;
}

.status-tag {
  font-family: var(--font-mono);
  font-size: 11px;
  padding: 5px 14px;
  font-weight: 800;
  letter-spacing: 1px;
  background: var(--border-mid);
  color: var(--text-secondary);
}

.status-tag.status-4 {
  background: rgba(0,255,136,0.15) !important;
  color: var(--accent-primary) !important;
  box-shadow: 0 0 10px var(--accent-glow);
}

.status-tag.status-2 {
  background: rgba(255,170,0,0.15);
  color: var(--color-warning);
}

.status-tag.status-11 {
  background: rgba(68,170,255,0.15);
  color: var(--color-info);
}

.card-title {
  font-size: 17px;
  font-weight: 800;
  color: var(--text-primary);
  margin-bottom: 12px;
  line-height: 1.4;
}

.qty-badge {
  background: var(--accent-primary);
  color: var(--bg-primary);
  padding: 3px 10px;
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 800;
  margin-left: 10px;
}

.card-loc {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.card-loc i {
  color: var(--color-critical);
  font-size: 14px;
}

.card-detail {
  font-size: 13px;
  color: var(--text-tertiary);
  line-height: 1.5;
}

.card-sla {
  margin: 18px 0;
  padding-top: 18px;
  border-top: 2px solid var(--border-mid);
  position: relative;
}

.card-sla::before {
  content: '';
  position: absolute;
  top: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--metal-gradient);
}

.sla-bar-container {
  height: 8px;
  background: var(--border-mid);
  overflow: hidden;
  margin-bottom: 10px;
}

.sla-bar {
  height: 100%;
  position: relative;
  transition: width 0.5s ease-out;
}

.sla-bar::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  background-size: 200% 100%;
  animation: shimmer 2s ease-in-out infinite;
}

.sla-info {
  display: flex;
  justify-content: space-between;
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--text-tertiary);
  font-weight: 700;
}

.sla-info.sla-critical {
  color: var(--color-critical) !important;
  text-shadow: 0 0 10px var(--color-critical-glow);
}

.sla-info.sla-warning {
  color: var(--color-warning) !important;
}

.sla-info.sla-ok {
  color: var(--accent-primary) !important;
}

.sla-remaining {
  display: flex;
  align-items: center;
  gap: 6px;
}

.card-footer {
  padding-top: 18px;
  border-top: 2px solid var(--border-mid);
  position: relative;
}

.card-footer::before {
  content: '';
  position: absolute;
  top: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--metal-gradient);
}

.priority-badge {
  font-family: var(--font-mono);
  font-size: 11px;
  padding: 5px 14px;
  font-weight: 800;
  background: var(--border-mid);
  color: var(--text-secondary);
}

.priority-badge.priority-Critical {
  background: rgba(255,68,68,0.2);
  color: var(--color-critical);
  box-shadow: 0 0 10px var(--color-critical-glow);
}

.priority-badge.priority-High {
  background: rgba(255,170,0,0.2);
  color: var(--color-warning);
}

.btn-jira {
  background: transparent;
  border: 2px solid var(--border-light);
  color: var(--text-secondary);
  padding: 12px 20px;
  font-family: var(--font-mono);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 1px;
  cursor: pointer;
  width: 100%;
  margin-top: 14px;
  transition: all 0.3s;
}

.btn-jira:hover {
  background: var(--bg-elevated);
  border-color: var(--border-highlight);
  transform: scale(1.02);
}

.btn-jira.progress {
  border-color: var(--color-info);
  color: var(--color-info);
}

.btn-jira.progress:hover {
  background: rgba(68,170,255,0.1);
  box-shadow: 0 0 20px rgba(68,170,255,0.3);
}

.btn-jira.success {
  border-color: var(--accent-primary);
  color: var(--accent-primary);
}

.btn-jira.success:hover {
  background: rgba(0,255,136,0.1);
  box-shadow: 0 0 20px var(--accent-glow);
}

.completed-msg {
  text-align: center;
  padding: 14px;
  background: rgba(0,255,136,0.08) !important;
  border: 2px solid var(--accent-primary) !important;
  color: var(--accent-primary) !important;
  font-family: var(--font-mono);
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 14px;
  transition: all 0.3s;
}

.completed-msg:hover {
  background: rgba(0,255,136,0.15) !important;
  box-shadow: 0 0 20px var(--accent-glow);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 18: EMPTY STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty-board {
  padding: 80px 30px;
  text-align: center;
  color: var(--text-muted);
}

.empty-board i {
  font-size: 64px;
  margin-bottom: 24px;
  color: var(--border-light);
}

.empty-board h4 {
  font-family: var(--font-display);
  font-size: 24px;
  color: var(--text-tertiary);
  letter-spacing: 4px;
  margin: 16px 0;
}

.empty-board p {
  font-size: 15px;
  color: var(--text-muted);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 19: MODAL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-content {
  background: var(--bg-secondary) !important;
  border: 2px solid var(--border-light) !important;
  border-radius: 0 !important;
  box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 80px var(--accent-glow) !important;
  color: var(--text-primary) !important;
  font-family: var(--font-body) !important;
  overflow: visible !important;
  max-width: 980px;
  margin: 30px auto;
}

.modal-header-clean {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 22px 32px;
  background: linear-gradient(180deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
  border-bottom: 2px solid var(--border-mid);
}

.header-badge {
  background: var(--accent-primary);
  color: var(--bg-primary);
  padding: 7px 18px;
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 1px;
  clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
  box-shadow: 0 0 20px var(--accent-glow);
}

.header-id {
  font-family: var(--font-mono);
  font-weight: 800;
  font-size: 18px;
  color: var(--text-primary);
  margin-left: 18px;
}

.header-close {
  background: transparent;
  border: 2px solid var(--border-light);
  color: var(--text-tertiary);
  width: 44px;
  height: 44px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.header-close:hover {
  background: var(--color-critical);
  border-color: var(--color-critical);
  color: #fff;
}

.modal-body-grid {
  display: grid;
  grid-template-columns: 1fr 360px;
  max-height: 72vh;
  overflow: hidden;
}

.body-main {
  padding: 32px;
  border-right: 2px solid var(--border-mid);
  overflow-y: auto;
  max-height: 72vh;
  position: relative;
}

.body-main::after {
  content: '';
  position: absolute;
  top: 0; right: -2px;
  width: 2px; height: 100%;
  background: var(--metal-gradient);
  transform: rotate(90deg);
}

.body-sidebar {
  background: var(--bg-tertiary);
  padding: 32px;
  overflow-y: auto;
  max-height: 72vh;
}

.ticket-title {
  font-family: var(--font-display);
  font-size: 24px;
  font-weight: 800;
  color: var(--text-primary);
  margin: 0 0 28px 0;
  padding-bottom: 20px;
  border-bottom: 2px solid var(--border-mid);
  letter-spacing: 1px;
  position: relative;
}

.ticket-title::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--metal-gradient);
}

.qty-badge-black {
  background: var(--accent-primary);
  color: var(--bg-primary);
  padding: 4px 14px;
  font-family: var(--font-mono);
  font-size: 14px;
  font-weight: 800;
  margin-left: 14px;
}

.action-bar {
  display: flex;
  gap: 14px;
  margin-bottom: 28px;
  flex-wrap: wrap;
}

.btn-purple-outline, .btn-normal {
  background: transparent;
  border: 2px solid var(--border-light);
  color: var(--text-secondary);
  padding: 12px 22px;
  font-family: var(--font-mono);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-purple-outline:hover, .btn-normal:hover {
  background: var(--bg-elevated);
  border-color: var(--border-highlight);
}

.action-btn {
  background: var(--accent-primary) !important;
  color: var(--bg-primary) !important;
  border: none !important;
  padding: 12px 22px;
  font-family: var(--font-mono);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 1px;
  cursor: pointer;
  clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
  transition: all 0.3s;
}

.action-btn:hover {
  background: var(--accent-secondary) !important;
  transform: scale(1.03);
}

.desc-box {
  background: var(--bg-tertiary);
  border: 2px solid var(--border-mid);
  border-left: 4px solid var(--accent-primary);
  padding: 24px;
  margin-bottom: 28px;
}

.desc-section-title {
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--text-tertiary);
  margin-bottom: 18px;
  letter-spacing: 2px;
}

.desc-grid {
  display: grid;
  gap: 16px;
}

.desc-item {
  display: flex;
  gap: 16px;
  align-items: flex-start;
  font-size: 15px;
  color: var(--text-secondary);
}

.desc-icon {
  width: 28px;
  text-align: center;
  color: var(--accent-primary);
  font-size: 18px;
}

.desc-label {
  font-weight: 800;
  color: var(--text-tertiary);
  margin-right: 10px;
}

.activity-area {
  margin-top: 28px;
}

.note-input {
  width: 100%;
  background: var(--bg-tertiary);
  border: 2px solid var(--border-light);
  color: var(--text-primary);
  padding: 16px;
  min-height: 100px;
  margin-bottom: 14px;
  font-family: var(--font-body);
  font-size: 15px;
  resize: vertical;
}

.note-input:focus {
  outline: none;
  border-color: var(--accent-primary);
  box-shadow: 0 0 20px var(--accent-glow);
}

.submit-btn {
  background: var(--border-light);
  color: var(--text-muted);
  border: none;
  padding: 12px 24px;
  font-family: var(--font-mono);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 1px;
  cursor: not-allowed;
  float: right;
}

.submit-btn.ready {
  background: var(--accent-primary);
  color: var(--bg-primary);
  cursor: pointer;
}

.submit-btn.ready:hover {
  background: var(--accent-secondary);
}

.sidebar-block {
  margin-bottom: 26px;
  padding-bottom: 22px;
  border-bottom: 2px solid var(--border-mid);
  position: relative;
}

.sidebar-block::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: var(--metal-gradient);
}

.sb-label {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 2px;
  margin-bottom: 12px;
}

.user-row {
  display: flex;
  align-items: center;
  gap: 14px;
}

.avatar-box {
  width: 44px;
  height: 44px;
  background: var(--accent-primary);
  color: var(--bg-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-weight: 900;
  font-size: 20px;
  flex-shrink: 0;
}

.avatar-box.orange {
  background: var(--color-warning);
}

.user-name-text {
  font-size: 15px;
  font-weight: 700;
  color: var(--text-primary);
}

.state-indicator {
  padding: 10px 20px;
  font-family: var(--font-mono);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: 1px;
  display: inline-block;
  color: #fff;
}

.priority-btn {
  background: var(--border-mid);
  color: var(--text-secondary);
  padding: 10px 18px;
  font-family: var(--font-mono);
  font-weight: 700;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.ai-card {
  background: var(--bg-tertiary);
  border: 2px solid var(--border-mid);
  border-left: 4px solid var(--color-info);
  padding: 20px;
  margin-bottom: 26px;
}

.ai-head {
  font-family: var(--font-display);
  font-size: 12px;
  color: var(--color-info);
  letter-spacing: 2px;
  margin-bottom: 10px;
}

.ai-text {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.6;
}

.sla-progress {
  height: 10px;
  background: var(--border-mid);
  overflow: hidden;
  margin-bottom: 12px;
}

.sla-fill {
  height: 100%;
  position: relative;
}

.sla-fill::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  background-size: 200% 100%;
  animation: shimmer 2s ease-in-out infinite;
}

.sla-text {
  display: flex;
  justify-content: space-between;
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-tertiary);
  margin-bottom: 12px;
}

.sla-badge {
  background: var(--border-mid);
  color: var(--text-secondary);
  padding: 8px 16px;
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 800;
  letter-spacing: 1px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.sla-badge.sla-critical {
  background: rgba(255,68,68,0.2);
  color: var(--color-critical);
  box-shadow: 0 0 10px var(--color-critical-glow);
}

.sla-badge.sla-ok {
  background: rgba(0,255,136,0.15);
  color: var(--accent-primary);
  box-shadow: 0 0 10px var(--accent-glow);
}

.dropdown-wrapper {
  position: relative;
  display: inline-block;
}

.status-menu {
  position: absolute;
  top: 100%;
  left: 0;
  background: var(--bg-secondary);
  border: 2px solid var(--border-light);
  box-shadow: 0 10px 40px rgba(0,0,0,0.6);
  z-index: 100;
  min-width: 200px;
}

.status-item {
  padding: 14px 22px;
  cursor: pointer;
  font-size: 14px;
  border-bottom: 1px solid var(--border-dark);
  color: var(--text-secondary);
  font-weight: 700;
  transition: all 0.2s;
}

.status-item:hover {
  background: var(--bg-elevated);
  color: var(--text-primary);
}

.status-item.danger {
  color: var(--color-critical);
}

.status-item.danger:hover {
  background: rgba(255,68,68,0.15);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 20: SCROLLBAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kokoro-volunteer-container::-webkit-scrollbar,
.alert-list::-webkit-scrollbar,
.body-main::-webkit-scrollbar,
.body-sidebar::-webkit-scrollbar {
  width: 8px;
}

.kokoro-volunteer-container::-webkit-scrollbar-track,
.alert-list::-webkit-scrollbar-track,
.body-main::-webkit-scrollbar-track,
.body-sidebar::-webkit-scrollbar-track {
  background: var(--bg-primary);
}

.kokoro-volunteer-container::-webkit-scrollbar-thumb,
.alert-list::-webkit-scrollbar-thumb,
.body-main::-webkit-scrollbar-thumb,
.body-sidebar::-webkit-scrollbar-thumb {
  background: var(--border-light);
  border-radius: 4px;
}

.kokoro-volunteer-container::-webkit-scrollbar-thumb:hover,
.alert-list::-webkit-scrollbar-thumb:hover,
.body-main::-webkit-scrollbar-thumb:hover,
.body-sidebar::-webkit-scrollbar-thumb:hover {
  background: var(--accent-primary);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 21: HAMBURGER MENU &amp; SIDEBAR - å®Œæ•´é›†æˆ
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* 1. Hamburger Button */
.hamburger-btn {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--border-mid);
  margin-right: 15px;
  cursor: pointer;
  background: var(--bg-primary);
  transition: all 0.2s;
  flex-shrink: 0;
}

.hamburger-btn:hover {
  background: var(--text-primary);
  border-color: var(--text-primary);
}

.hamburger-btn:hover i {
  color: var(--bg-primary);
}

.hamburger-btn i {
  font-size: 18px;
  color: var(--text-primary);
  transition: color 0.2s;
}

/* Sidebar (ä¿®å¤ç‰ˆ: ä¿®å¤é€æ˜åº¦ä¸å±‚çº§) */
.zen-sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 280px;
  height: 100vh;
  /* å¼ºåˆ¶ç™½è‰²èƒŒæ™¯ï¼Œé˜²æ­¢é€æ˜ */
  background-color: #ffffff !important; 
  background: #ffffff !important;
  border-right: 2px solid var(--border-dark);
  /* æé«˜ z-index ç¡®ä¿åœ¨é®ç½©å±‚ä¹‹ä¸Š (é®ç½©å±‚é€šå¸¸æ˜¯ 99998) */
  z-index: 100000 !important; 
  transform: translateX(-100%);
  transition: transform 0.3s ease;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  /* å¢åŠ é˜´å½±ä»¥åŒºåˆ†å±‚çº§ */
  box-shadow: 2px 0 15px rgba(0,0,0,0.2); 
}

.zen-sidebar.active {
  transform: translateX(0);
}

.zen-sidebar.active {
  transform: translateX(0);
}

/* 3. Sidebar Header */
.sidebar-head {
  height: 60px;
  border-bottom: 2px solid var(--text-primary);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  background: var(--bg-tertiary);
}

.sb-title {
  font-family: var(--font-display);
  font-weight: 900;
  font-size: 18px;
  letter-spacing: 2px;
  color: var(--text-primary);
}

.sb-close {
  background: none;
  border: none;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  color: var(--text-primary);
  transition: all 0.2s;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sb-close:hover {
  background: var(--text-primary);
  color: var(--bg-primary);
}

/* 4. Sidebar Profile */
.sb-profile {
  padding: 30px 20px;
  border-bottom: 1px solid var(--border-mid);
  display: flex;
  align-items: center;
  gap: 15px;
  background: var(--bg-secondary);
}

.sb-avatar {
  width: 48px;
  height: 48px;
  background: var(--text-primary);
  color: var(--bg-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 20px;
  font-family: var(--font-display);
  flex-shrink: 0;
}

.sb-name {
  font-weight: 800;
  font-size: 16px;
  margin-bottom: 4px;
  color: var(--text-primary);
}

.sb-role {
  font-size: 10px;
  font-family: var(--font-mono);
  color: var(--text-tertiary);
}

/* 5. Navigation List */
.sb-nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
  flex: 1;
  overflow-y: auto;
}

.sb-nav-list li {
  padding: 18px 24px;
  border-bottom: 1px solid var(--border-light);
  cursor: pointer;
  font-family: var(--font-body);
  font-weight: 700;
  font-size: 16px;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  color: var(--text-secondary);
}

.sb-nav-list li:hover {
  background: var(--text-primary);
  color: var(--bg-primary);
}

.sb-nav-list li:hover .nav-num {
  color: var(--text-tertiary);
}

.nav-num {
  font-family: var(--font-display);
  font-size: 11px;
  color: var(--text-tertiary);
  margin-right: 12px;
  width: 20px;
  font-weight: 800;
}

.sb-nav-list li.divider {
  height: 20px;
  background: var(--bg-tertiary);
  border-bottom: 1px solid var(--border-light);
  padding: 0;
  cursor: default;
}

/* 6. Sidebar Footer */
.sb-footer {
  padding: 20px;
  font-size: 11px;
  color: var(--text-tertiary);
  text-align: center;
  border-top: 2px solid var(--text-primary);
  background: var(--bg-tertiary);
  font-family: var(--font-mono);
  letter-spacing: 1px;
}

/* 7. Backdrop */
.zen-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(2px);
  z-index: 99998;
  display: none;
}

.zen-backdrop.active {
  display: block;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 22: RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 1200px) {
  .two-column-layout {
    grid-template-columns: 1fr;
  }
  
  .modal-body-grid {
    grid-template-columns: 1fr;
  }
  
  .body-sidebar {
    border-right: none;
    border-top: 2px solid var(--border-mid);
  }
  
  .board-container {
    padding: 20px;
    width: 100% !important; /* ç¡®ä¿ç§»åŠ¨ç«¯ä¹Ÿé“ºæ»¡ */
  }
}

@media (max-width: 768px) {
  .command-header {
    padding: 16px 20px;
    flex-wrap: nowrap;
    gap: 12px;
  }
  
  .logo-text {
    display: none;
  }
  
  .system-status {
    margin-left: auto;
    gap: 12px;
  }
  
  .nav-tabs-custom {
    padding: 0 20px;
    overflow-x: auto;
  }
  
  .board-container {
    padding: 20px;
  }
  
  .volunteer-status-panel {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }
  
  .stats-row {
    grid-template-columns: 1fr 1fr;
  }
  
  .alert-item {
    grid-template-columns: auto 1fr auto;
  }
  
  .alert-zone, .alert-time {
    display: none;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PART 23: INTERACTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
button, .btn-jira, .btn-online, .btn-offline, .tab, .alert-item, .jira-card, .stat-card {
  pointer-events: auto !important;
  cursor: pointer !important;
}

.clickable {
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.kokoro-volunteer-container * {
  box-sizing: border-box;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPONENT: SYSTEM ALERT STRIP (ç»ˆæœ«åœ°é£æ ¼ - æˆ˜æœ¯è­¦ç¤ºå¸¦)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.sys-alert-strip {
    /* å¸ƒå±€å®šä½ */
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    height: 48px;
    padding: 0 24px;
    gap: 16px;

    /* è§†è§‰é£æ ¼ï¼šç™½åº•çº¢çº¿ï¼Œè€Œéçº¢åº•ç™½å­— */
    background-color: var(--bg-primary); /* çº¯ç™½åº• */
    border-bottom: 2px solid var(--signal-crimson); /* åº•éƒ¨åŠ ä¸Šçº¢è‰²ä¿¡å·çº¿ */
    
    /* è£…é¥°æ€§èƒŒæ™¯ï¼šæ·¡çº¢è‰²æ–œçº¹ (Hatched Pattern) */
    background-image: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 10px,
        rgba(207, 34, 46, 0.03) 10px,
        rgba(207, 34, 46, 0.03) 20px
    );
    
    /* å­—ä½“è®¾ç½® */
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--signal-crimson); /* è­¦ç¤ºçº¢å­— */
    z-index: 1000;
}

/* å·¦ä¾§è£…é¥°å—ï¼š/// SYSTEM_OVERRIDE /// */
.alert-deco {
    font-weight: 800;
    letter-spacing: 0.1em;
    opacity: 0.5;
    white-space: nowrap;
    display: none; /* ç§»åŠ¨ç«¯éšè— */
}
/* æ¡Œé¢ç«¯æ˜¾ç¤ºè£…é¥°å— */
@media (min-width: 992px) {
    .alert-deco { display: block; }
}

/* ä¸­é—´æ¶ˆæ¯ä¸»ä½“ */
.alert-body {
    flex-grow: 1;
    display: flex;
    align-items: center;
    justify-content: center; /* å±…ä¸­å¯¹é½ */
    gap: 12px;
}

.alert-body i {
    font-size: 16px;
    animation: blink-red 2s infinite; /* å‘¼å¸ç¯åŠ¨ç”» */
}

.alert-text {
    font-family: var(--font-ui); /* ä½¿ç”¨ Rajdhani å­—ä½“ */
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* å³ä¾§æŒ‰é’®ï¼šå¹½çµæŒ‰é’®é£æ ¼ */
.sys-btn-ghost {
    background: transparent;
    border: 1px solid var(--signal-crimson);
    color: var(--signal-crimson);
    font-family: var(--font-mono);
    font-size: 12px;
    font-weight: 700;
    padding: 6px 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: uppercase;
}

.sys-btn-ghost:hover {
    background: var(--signal-crimson);
    color: #FFFFFF;
    box-shadow: 0 0 10px var(--color-critical-glow);
}

/* å‘¼å¸ç¯åŠ¨ç”»å®šä¹‰ */
@keyframes blink-red {
    0% { opacity: 1; text-shadow: 0 0 0px var(--signal-crimson); }
    50% { opacity: 0.4; text-shadow: 0 0 10px var(--signal-crimson); }
    100% { opacity: 1; text-shadow: 0 0 0px var(--signal-crimson); }
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>kokoro_volunteer</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>Kokoro Volunteer Dashboard</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
    // ==========================================
    // 0. åˆå§‹åŒ–å˜é‡ä¸æ•°ç»„
    // ==========================================
    data.myTasks = [];
    data.list = [];
    data.user_id = gs.getUserID();
    data.user_name = gs.getUserDisplayName();
    
    // å®šä¹‰ isVolunteer å˜é‡
    var isVolunteer = gs.hasRole('x_1821654_kokoro_0.volunteer') || gs.hasRole('admin');
    data.isVolunteer = isVolunteer;

    // ==========================================
    // 1. æ‰©å±•é…ç½®ä¿¡æ¯ (Enterprise Tables)
    // ==========================================
    var CONFIG = {
        tables: {
            SILENT_WISH: 'x_1821654_kokoro_0_silent_wish',
            INVENTORY: 'x_1821654_kokoro_0_kokoro_inventory',
            INVENTORY_TX: 'x_1821654_kokoro_0_kokoro_inventory_transact',
            PROCESS_EVENT: 'x_1821654_kokoro_0_process_event',
            USER_PROFILE: 'x_1821654_kokoro_0_user_profile', 
            EMERGENCY_MESSAGE: 'x_1821654_kokoro_0_emergency_message', 
            HEARTBEAT: 'x_1821654_kokoro_0_heartbeat' 
        },
        wishStates: {
            SUBMITTED: '1',    // New
            IN_PROGRESS: '2',  // Work in Progress
            COMPLETED: '4',    // Closed Complete
            CANCELLED: '7'     // Cancelled
        },
        resourceKeys: ['food', 'water', 'medical', 'clothing', 'hygiene'],
        thresholds: {
            CRITICAL: 15, 
            WARNING: 35   
        }
    };

    // ==========================================
    // 2. æ ¸å¿ƒç›‘å¯Ÿå‡½æ•°: è·å–èµ„æºçŠ¶æ€
    // ==========================================
function getResourceStatus() {
        // 1. åˆå§‹åŒ–å›ºå®šé¡ºåºçš„ç©ºæ¨¡æ¿ï¼Œç¡®ä¿ç´¢å¼• 0-4 å¯¹åº” HTML çš„é¡ºåº
        // Order matches HTML: [0]Food, [1]Water, [2]Medical, [3]Clothing, [4]Hygiene
        var map = {
            'FOOD': 0,
            'WATR': 1,
            'MEDI': 2,
            'CLTH': 3,
            'HYGN': 4
        };
        
        var status = [
            { percent: 0, code: 'FOOD', label: 'é£Ÿæ–™ (No Data)', status_color: 'danger' },
            { percent: 0, code: 'WATR', label: 'é£²æ–™æ°´ (No Data)', status_color: 'danger' },
            { percent: 0, code: 'MEDI', label: 'åŒ»ç™‚å“ (No Data)', status_color: 'danger' },
            { percent: 0, code: 'CLTH', label: 'è¡£é¡ (No Data)', status_color: 'danger' },
            { percent: 0, code: 'HYGN', label: 'è¡›ç”Ÿç”¨å“ (No Data)', status_color: 'danger' }
        ];

        var grInv = new GlideRecord(CONFIG.tables.INVENTORY);
        grInv.addActiveQuery();
        grInv.query();

        while (grInv.next()) {
            var code = grInv.getValue('item_code');
            var idx = map[code]; // æ ¹æ® Code æ‰¾åˆ°å¯¹åº”ç´¢å¼•
            
            if (idx !== undefined) {
                var current = parseFloat(grInv.getValue('current_quantity')) || 0;
                var max = parseFloat(grInv.getValue('max_capacity')) || 100;
                var percentage = Math.round((current / max) * 100);

                status[idx] = {
                    label: grInv.getDisplayValue('item_name'),
                    code: code,
                    percent: percentage,
                    status_color: percentage < CONFIG.thresholds.CRITICAL ? 'danger' : 
                                 (percentage < CONFIG.thresholds.WARNING ? 'warning' : 'success')
                };
            }
        }
        return status;
    }
    data.resourceStatus = getResourceStatus();

    // ==========================================
    // 3. ä¼ä¸šçº§åº“å­˜æ‰£å‡é€»è¾‘ (äº‹åŠ¡æ€§å¤„ç†)
    // ==========================================
    function updateInventory(itemCode, quantity, wishId) {
        var grInv = new GlideRecord(CONFIG.tables.INVENTORY);
        grInv.addQuery('item_code', itemCode);
        grInv.query();

        if (grInv.next()) {
            var oldQty = parseFloat(grInv.getValue('current_quantity'));
            var newQty = oldQty - quantity;

            if (newQty < 0) return { success: false, message: 'åœ¨åº«ä¸è¶³' };

            // 1. æ›´æ–°ä¸»è¡¨
            grInv.setValue('current_quantity', newQty);
            grInv.update();

            // 2. æ’å…¥äº¤æ˜“è¡¨ (Audit Trail)
            var grTx = new GlideRecord(CONFIG.tables.INVENTORY_TX);
            grTx.initialize();
            grTx.setValue('inventory_item', grInv.getUniqueValue());
            grTx.setValue('type', 'disbursement');
            grTx.setValue('quantity', quantity);
            grTx.setValue('related_wish', wishId);
            grTx.insert();

            // 3. è®°å½•æµç¨‹äº‹ä»¶
            logProcessEvent(wishId, 'Inventory Decr: ' + itemCode + ' (' + quantity + ')', gs.getUserID());
            return { success: true };
        }
        return { success: false, message: 'ç‰©å“ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' };
    }

    // ==========================================
    // 4. è¾“å…¥å¤„ç†: å½“ Wish çŠ¶æ€å˜ä¸º "In Progress" æ—¶å°è¯•é”å®š/æ‰£å‡åº“å­˜
    // ==========================================
    if (input && input.action === 'change_status' && input.new_state === '2') {
        var wishGr = new GlideRecord(CONFIG.tables.SILENT_WISH);
        if (wishGr.get(input.sys_id)) {
            var category = wishGr.getValue('u_category'); 
            var qty = parseInt(wishGr.getValue('u_quantity')) || 1;
            
            if (category) {
                var invResult = updateInventory(category.toUpperCase(), qty, input.sys_id);
                if (!invResult.success) {
                    data.error = "åœ¨åº«ãƒã‚§ãƒƒã‚¯å¤±æ•—: " + invResult.message;
                    return;
                }
            }
        }
    }

    // === SLAç»Ÿè®¡ ===
    data.slaStats = {
        breached: 0,
        atRisk: 0,
        ok: 0
    };
    try {
        if (typeof x_1821654_kokoro_0.KokoroSLAEngine !== 'undefined') {
            var slaEngine = new x_1821654_kokoro_0.KokoroSLAEngine();
            
            var breachedWishes = slaEngine.getBreachedWishes();
            data.slaStats.breached = breachedWishes.length;
            
            var atRiskWishes = slaEngine.getAtRiskWishes(80);
            data.slaStats.atRisk = atRiskWishes.length;
        }
        
        var gaSLA = new GlideAggregate('x_1821654_kokoro_0_sla_task');
        gaSLA.addQuery('status', 'in_progress');
        gaSLA.addQuery('percentage', '<', 80);
        gaSLA.addAggregate('COUNT');
        gaSLA.query();
        if (gaSLA.next()) {
            data.slaStats.ok = parseInt(gaSLA.getAggregate('COUNT')) || 0;
        }
    } catch (e) {
        gs.debug('[Kokoro] SLA stats not available: ' + e.message);
    }

    // ==========================================
    // å·¥å…·å‡½æ•°
    // ==========================================
    function sanitizeInput(inputVal, maxLength) {
        if (!inputVal) return '';
        var cleaned = String(inputVal)
            .replace(/[<>\"'&]/g, '')
            .replace(/[\r\n]+/g, ' ')
            .trim();
        if (maxLength && cleaned.length > maxLength) {
            cleaned = cleaned.substring(0, maxLength);
        }
        return cleaned;
    }

    function validateSysId(sysId) {
        if (!sysId) return false;
        return /^[a-f0-9]{32}$/.test(String(sysId));
    }

    function logProcessEvent(caseId, activity, userId) {
        try {
            var pe = new GlideRecord(CONFIG.tables.PROCESS_EVENT);
            pe.initialize();
            pe.setValue('case_id', caseId || '');
            pe.setValue('activity', sanitizeInput(activity, 200));
            pe.setValue('timestamp', new GlideDateTime());
            pe.setValue('user', userId || gs.getUserID());
            pe.insert();
        } catch (e) {
            gs.error('[Kokoro] Process event log error: ' + e.message);
        }
    }

    // ==========================================
    // çŠ¶æ€éªŒè¯å™¨
    // ==========================================
    var StateValidator = {
        allowedTransitions: {
            '1':  ['10', '11', '5'],
            '10': ['1', '11', '5'],
            '11': ['10', '2', '5', '6'],
            '2':  ['4', '5', '6'],
            '4':  [],
            '5':  [],
            '6':  ['11', '2', '5']
        },
        
        validateTransition: function(fromState, toState) {
            fromState = String(fromState);
            toState = String(toState);
            
            if (!fromState || fromState === '' || fromState === 'undefined' || fromState === 'null') {
                return { valid: true };
            }
            
            if (!this.allowedTransitions.hasOwnProperty(fromState)) {
                return { valid: false, message: 'ç„¡åŠ¹ãªç¾åœ¨çŠ¶æ…‹: ' + fromState };
            }
            
            var allowed = this.allowedTransitions[fromState];
            if (allowed.indexOf(toState) === -1) {
                return { 
                    valid: false, 
                    message: fromState + ' ã‹ã‚‰ ' + toState + ' ã¸ã®é·ç§»ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“' 
                };
            }
            
            return { valid: true };
        }
    };

    // ==========================================
    // åŠ è½½ç”¨æˆ·èµ„æ–™
    // ==========================================
    function loadUserProfile() {
        try {
            var grProfile = new GlideRecord(CONFIG.tables.USER_PROFILE);
            grProfile.addQuery('user', data.user_id);
            grProfile.setLimit(1);
            grProfile.query();

            if (grProfile.next()) {
                data.emergency_email = grProfile.getValue('emergency_conact_email') || "";
                data.medical_info = grProfile.getValue('medical_conditions') || "";
                data.blood_type = grProfile.getValue('blood_type') || "";
            }
        } catch (e) {
            gs.error("[Kokoro] Profile load error: " + e.message);
        }
    }

    function loadDigitalWill() {
        try {
            var grWill = new GlideRecord(CONFIG.tables.EMERGENCY_MESSAGE);
            grWill.addQuery('user', data.user_id);
            grWill.addQuery('is_active', true);
            grWill.addQuery('message_type', 'Last_Will');
            grWill.orderByDesc('sys_created_on');
            grWill.setLimit(1);
            grWill.query();

            if (grWill.next()) {
                data.saved_will = grWill.getValue('message_encrypted') || "";
            }
        } catch (e) {
            gs.error("[Kokoro] Will load error: " + e.message);
        }
    }

    loadUserProfile();
    loadDigitalWill();

    // ==========================================
    // æ„å»ºä»»åŠ¡é¡¹ (Integrated SLA)
    // ==========================================
    function buildTaskItem(gr) {
        var taskItem = {
            sys_id: gr.getUniqueValue(),
            number: gr.getValue('number') || '',
            category: gr.getValue('u_category') || '',
            category_display: gr.getDisplayValue('u_category') || 'æœªåˆ†é¡',
            zone: gr.getDisplayValue('shelter_zone') || '',
            detail_loc: gr.getValue('detail_loc') || gr.getValue('wish_content') || '',
            desc: gr.getValue('u_remarks') || '',
            urgency: gr.getValue('u_urgency') || 'Medium',
            contact: gr.getValue('u_contact_info') || '',
            reporter_name: gr.getDisplayValue('sys_created_by') || 'ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼',
            assigned_to_name: gr.getDisplayValue('assigned_to') || '',
            assigned_to_id: gr.getValue('assigned_to') || '',
            state: parseInt(gr.getValue('state')) || 10,
            state_label: gr.getDisplayValue('state') || '',
            quantity: parseInt(gr.getValue('u_quantity')) || 1,
            remarks: gr.getValue('u_remarks') || '',
            affected_count: gr.getValue('u_affected_count') || 'ä¸æ˜',
            history: [],
            attachments: [],
            sla: null 
        };
			// æ—¶é—´è®¡ç®—
        var created = new GlideDateTime(gr.sys_created_on);
        var endTime = new GlideDateTime(); // é»˜è®¤ä¸ºå½“å‰æ—¶é—´
        var isCompleted = (taskItem.state == 4 || taskItem.state == 5); // 4:Completed, 5:Cancelled

        // å¦‚æœå·²å®Œæˆï¼Œä½¿ç”¨å®Œæˆæ—¶é—´ï¼›å¦‚æœæ²¡æœ‰å®Œæˆæ—¶é—´å­—æ®µï¼Œåˆ™å›é€€åˆ°æ›´æ–°æ—¶é—´
        if (isCompleted) {
            var completedAtStr = gr.getValue('u_completed_at');
            if (completedAtStr) {
                endTime = new GlideDateTime(completedAtStr);
            } else {
                endTime = new GlideDateTime(gr.sys_updated_on);
            }
        }

        var diffMs = GlideDateTime.subtract(created, endTime).getNumericValue(); 
        var minutes = Math.floor(diffMs / 1000 / 60);
        
        // æ˜¾ç¤ºç”¨çš„â€œxxå‰â€é€»è¾‘ä¿æŒæ ¹æ®å½“å‰æ—¶é—´è®¡ç®—
        var nowForDisplay = new GlideDateTime();
        var diffDisplay = GlideDateTime.subtract(created, nowForDisplay).getNumericValue();
        var minutesDisplay = Math.floor(diffDisplay / 1000 / 60);

        if (minutesDisplay < 60) {
            taskItem.time_ago = minutesDisplay + "åˆ†å‰";
        } else if (minutesDisplay < 1440) {
            taskItem.time_ago = Math.floor(minutesDisplay / 60) + "æ™‚é–“å‰";
        } else {
            taskItem.time_ago = Math.floor(minutesDisplay / 1440) + "æ—¥å‰";
        }

        taskItem.created_on = gr.getDisplayValue('sys_created_on');

        // ... (ä¿ç•™ try catch çš„ SLA Engine éƒ¨åˆ†ï¼Œå¦‚æœæœ‰çš„è¯) ...

        // é»˜è®¤ SLA è®¡ç®— (Fallback)
        if (!taskItem.sla) {
            var defaultTargets = {
                'Critical': 30, 'High': 60, 'Medium': 120, 'Low': 240
            };
            var target = defaultTargets[taskItem.urgency] || 120;
            
            // å¦‚æœå·²å®Œæˆï¼ŒçŠ¶æ€å¼ºåˆ¶ä¿®æ­£
            var slaStatus = 'ok';
            var isBreached = minutes > target;
            
            if (isCompleted) {
                // å·²å®Œæˆçš„ä»»åŠ¡ï¼Œå³ä½¿è¶…æ—¶ï¼ŒUIä¸Šä¹Ÿæ˜¾ç¤ºä¸ºç‰¹å®šçš„å®ŒæˆçŠ¶æ€ï¼Œæˆ–è€…ä¿ç•™è¶…æ—¶è®°å½•ä½†ä¸å†å˜è‰²
                slaStatus = isBreached ? 'critical' : 'success'; 
            } else {
                slaStatus = minutes > target ? 'critical' : (minutes > target * 0.8 ? 'warning' : 'ok');
            }

            taskItem.sla = {
                elapsed: minutes,
                target: target,
                remaining: Math.max(0, target - minutes),
                percentage: Math.min(100, Math.round((minutes / target) * 100)),
                status: slaStatus,
                is_breached: isBreached,
                is_stopped: isCompleted // æ ‡è®°ä¸ºåœæ­¢è®¡æ—¶
            };
        }


        // é™„ä»¶
        try {
            var att = new GlideRecord('sys_attachment');
            att.addQuery('table_sys_id', taskItem.sys_id);
            att.setLimit(1);
            att.orderByDesc('sys_created_on');
            att.query();
            if (att.next()) {
                taskItem.image_url = '/' + att.sys_id + '.iix';
            }
        } catch (e) {}

        // æ´»åŠ¨å†å²
        try {
            var journal = new GlideRecord('sys_journal_field');
            journal.addQuery('element_id', taskItem.sys_id);
            journal.addQuery('element', 'work_notes');
            journal.orderByDesc('sys_created_on');
            journal.setLimit(10);
            journal.query();
            while (journal.next()) {
                taskItem.history.push({
                    user: journal.getDisplayValue('sys_created_by') || 'System',
                    text: journal.getValue('value') || '',
                    date: journal.getDisplayValue('sys_created_on')
                });
            }
        } catch (e) {}

        return taskItem;
    }

    // ==========================================
    // åŠ è½½å¿—æ„¿è€…åˆ—è¡¨
    // ==========================================
    function loadVolunteerList() {
        var volunteerList = [];
        try {
            var roleGr = new GlideRecord('sys_user_has_role');
            roleGr.addQuery('role.name', 'x_1821654_kokoro_0.volunteer');
            roleGr.query();
            var volIds = [];
            while (roleGr.next()) {
                volIds.push(roleGr.getValue('user'));
            }
            
            if (volIds.length > 0) {
                var userGr = new GlideRecord('sys_user');
                userGr.addQuery('sys_id', 'IN', volIds.join(','));
                userGr.addQuery('active', true);
                userGr.query();
                while (userGr.next()) {
                    volunteerList.push({
                        sys_id: userGr.getUniqueValue(),
                        name: userGr.getDisplayValue('name') || userGr.getValue('user_name')
                    });
                }
            }
            
            // æ·»åŠ ç®¡ç†å‘˜
            var adminGr = new GlideRecord('sys_user');
            adminGr.addQuery('active', true);
            adminGr.addQuery('roles', 'CONTAINS', 'admin');
            adminGr.setLimit(10);
            adminGr.query();
            while (adminGr.next()) {
                var alreadyExists = volunteerList.some(function(v) { 
                    return v.sys_id === adminGr.getUniqueValue(); 
                });
                if (!alreadyExists) {
                    volunteerList.push({
                        sys_id: adminGr.getUniqueValue(),
                        name: adminGr.getDisplayValue('name') || adminGr.getValue('user_name')
                    });
                }
            }
        } catch (e) {
            gs.error("[Kokoro] Load volunteer list error: " + e.message);
        }
        return volunteerList;
    }

    // ==========================================
    // å¤„ç†è¾“å…¥
    // ==========================================
    if (input) {

        // === ä½ç½®æ›´æ–° ===
        if (input.action === 'update_location' && input.zone) {
            try {
                var assignEngine = new x_1821654_kokoro_0.KokoroAutoAssignment();
                assignEngine.updateVolunteerLocation(data.user_id, input.zone);
                data.success = true;
                data.message = 'ä½ç½®ã‚’æ›´æ–°ã—ã¾ã—ãŸ';
            } catch (e) {
                data.error = 'ä½ç½®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message;
            }
            return;
        }

        // === å¯ç”¨æ€§æ›´æ–° ===
        if (input.action === 'set_availability') {
            try {
                var assignEngine2 = new x_1821654_kokoro_0.KokoroAutoAssignment();
                assignEngine2.setVolunteerAvailability(data.user_id, input.available);
                data.success = true;
                data.message = input.available ? 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«ãªã‚Šã¾ã—ãŸ' : 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«ãªã‚Šã¾ã—ãŸ';
            } catch (e) {
                data.error = 'çŠ¶æ…‹æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message;
            }
            return;
        }

        // === æ‰‹åŠ¨è§¦å‘è‡ªåŠ¨åˆ†é… ===
        if (input.action === 'trigger_auto_assign' && input.sys_id) {
            if (!isVolunteer) {
                data.error = 'æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“';
                return;
            }
            
            try {
                var assignEngine3 = new x_1821654_kokoro_0.KokoroAutoAssignment();
                var result = assignEngine3.autoAssign(input.sys_id, { forceReassign: input.force_reassign });
                
                if (result.success) {
                    data.success = true;
                    data.assigned_to = result.volunteer_name;
                    data.score = result.score;
                } else {
                    data.error = result.reason;
                }
            } catch (e) {
                data.error = 'è‡ªå‹•åˆ†é…ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message;
            }
            return;
        }

        // === è·å–SLAè¯¦æƒ… ===
        if (input.action === 'get_sla_info' && input.sys_id) {
            try {
                var slaEngine2 = new x_1821654_kokoro_0.KokoroSLAEngine();
                data.sla_info = slaEngine2.getSLAInfo(input.sys_id);
                data.success = true;
            } catch (e) {
                data.error = 'SLAæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
            }
            return;
        }

        if (input.action === 'get_volunteers') {
            data.volunteers = loadVolunteerList();
            data.success = true;
            return;
        }

        if (input.action === 'save_settings') {
            try {
                var successProfile = false;
                var successWill = true;

                var grUp = new GlideRecord(CONFIG.tables.USER_PROFILE);
                grUp.addQuery('user', data.user_id);
                grUp.query();

                if (grUp.next()) {
                    grUp.setValue('emergency_conact_email', sanitizeInput(input.email, 100));
                    grUp.setValue('medical_conditions', sanitizeInput(input.medical_info, 1000));
                    grUp.setValue('blood_type', sanitizeInput(input.blood_type, 20));
                    successProfile = (grUp.update() != null);
                } else {
                    grUp.initialize();
                    grUp.setValue('user', data.user_id);
                    grUp.setValue('emergency_conact_email', sanitizeInput(input.email, 100));
                    grUp.setValue('medical_conditions', sanitizeInput(input.medical_info, 1000));
                    grUp.setValue('blood_type', sanitizeInput(input.blood_type, 20));
                    successProfile = (grUp.insert() != null);
                }

                if (input.will && String(input.will).trim() !== '') {
                    var oldMsg = new GlideRecord(CONFIG.tables.EMERGENCY_MESSAGE);
                    oldMsg.addQuery('user', data.user_id);
                    oldMsg.addQuery('is_active', true);
                    oldMsg.addQuery('message_type', 'Last_Will');
                    oldMsg.query();
                    while (oldMsg.next()) {
                        oldMsg.setValue('is_active', false);
                        oldMsg.update();
                    }

                    var emsg = new GlideRecord(CONFIG.tables.EMERGENCY_MESSAGE);
                    emsg.initialize();
                    emsg.setValue('user', data.user_id);
                    emsg.setValue('message_encrypted', sanitizeInput(input.will, 4000));
                    emsg.setValue('message_type', 'Last_Will');
                    emsg.setValue('is_active', true);
                    emsg.setValue('created_at', new GlideDateTime());
                    successWill = (emsg.insert() != null);
                }

                if (successProfile && successWill) {
                    data.success = true;
                    logProcessEvent(data.user_id, 'User settings updated', data.user_id);
                } else {
                    data.error = "ä¿å­˜å¤±æ•—";
                }

            } catch (e) {
                gs.error("[Kokoro] Save error: " + e.message);
                data.error = "ä¿å­˜ã‚¨ãƒ©ãƒ¼";
            }
            return;
        }

        if (input.action === 'submit_record' || input.action === 'update_record') {
            if (!input.location || !input.category || !input.urgency) {
                data.error = "å¿…é ˆé …ç›®ãŒä¸è¶³";
                return;
            }

            try {
                var gr = new GlideRecord(CONFIG.tables.SILENT_WISH);

                if (input.action === 'update_record' && input.sys_id) {
                    if (!validateSysId(input.sys_id)) {
                        data.error = "ç„¡åŠ¹ãªID";
                        return;
                    }
                    if (!gr.get(input.sys_id)) {
                        data.error = "ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
                        return;
                    }
                } else {
                    gr.initialize();
                    gr.setValue('state', CONFIG.wishStates.SUBMITTED);
                }

                gr.setValue('shelter_zone', sanitizeInput(input.location, 100));
                gr.setValue('u_category', sanitizeInput(input.category, 50));
                gr.setValue('u_quantity', parseInt(input.quantity) || 1);
                gr.setValue('u_urgency', sanitizeInput(input.urgency, 20));
                gr.setValue('u_affected_count', sanitizeInput(input.affected_count, 10));
                gr.setValue('u_remarks', sanitizeInput(input.remarks, 1000));
                gr.setValue('u_contact_info', sanitizeInput(input.contact, 200));
                gr.setValue('detail_loc', sanitizeInput(input.detail_loc, 200));

                var fullDescription =
                    "ã€è©³ç´°å ´æ‰€ã€‘: " + sanitizeInput(input.detail_loc, 200) + "\n" +
                    "ã€æ”¯æ´ç¨®åˆ¥ã€‘: " + input.category + " x " + (input.quantity || 1) + "\n" +
                    "ã€ç·Šæ€¥åº¦ã€‘: " + input.urgency + "\n" +
                    "ã€å¯¾è±¡äººæ•°ã€‘: " + (input.affected_count || '1') + "\n" +
                    "ã€å‚™è€ƒã€‘: " + (input.remarks || 'ãªã—');

                gr.setValue('wish_content', fullDescription);

                if (input.action === 'submit_record') {
                    var sysId = gr.insert();
                    if (sysId) {
                        data.ticketNumber = gr.getValue('number');
                        data.newRecordID = sysId;
                        data.success = true;
                        logProcessEvent(sysId, 'Wish submitted: ' + input.category, data.user_id);
                    } else {
                        data.error = "ä½œæˆå¤±æ•—";
                    }
                } else {
                    if (gr.update()) {
                        data.ticketNumber = gr.getValue('number');
                        data.success = true;
                        logProcessEvent(input.sys_id, 'Wish updated', data.user_id);
                    } else {
                        data.error = "æ›´æ–°å¤±æ•—";
                    }
                }
            } catch (e) {
                gs.error("[Kokoro] Submit error: " + e.message);
                data.error = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + e.message;
            }
            return;
        }

        if (input.action === 'upload_attachment' && input.sys_id) {
            try {
                if (!validateSysId(input.sys_id)) {
                    data.error = "ç„¡åŠ¹ãªID";
                    return;
                }
                var attachment = new GlideSysAttachment();
                if (input.file_data) {
                    var cleanBase64 = input.file_data.split(',')[1] || input.file_data;
                    attachment.writeBase64(
                        input.table || CONFIG.tables.SILENT_WISH,
                        input.sys_id,
                        sanitizeInput(input.file_name, 100),
                        input.content_type,
                        cleanBase64
                    );
                    data.success = true;
                }
            } catch (e) {
                gs.error("[Kokoro] Attachment error: " + e.message);
            }
            return;
        }

        if (input.action === 'register_heartbeat') {
            try {
                var hb = new GlideRecord(CONFIG.tables.HEARTBEAT);
                hb.initialize();
                hb.setValue('u_user', data.user_id);
                hb.setValue('u_timestamp', new GlideDateTime());
                hb.setValue('u_status', 'Safe');

                var hbId = hb.insert();
                data.heartbeat_id = hbId;
                data.success = true;
                logProcessEvent(hbId, 'Heartbeat registered', data.user_id);
            } catch (e) {
                gs.error("[Kokoro] Heartbeat error: " + e.message);
                data.error = "å¿ƒè·³æ³¨å†Œå¤±è´¥";
            }
            return;
        }

        if (input.action === 'update_will') {
            try {
                if (input.message) {
                    var oldQuick = new GlideRecord(CONFIG.tables.EMERGENCY_MESSAGE);
                    oldQuick.addQuery('user', data.user_id);
                    oldQuick.addQuery('is_active', true);
                    oldQuick.addQuery('message_type', 'Quick_Will');
                    oldQuick.query();
                    while (oldQuick.next()) {
                        oldQuick.setValue('is_active', false);
                        oldQuick.update();
                    }

                    var emsgQuick = new GlideRecord(CONFIG.tables.EMERGENCY_MESSAGE);
                    emsgQuick.initialize();
                    emsgQuick.setValue('user', data.user_id);
                    emsgQuick.setValue('message_encrypted', sanitizeInput(input.message, 4000));
                    emsgQuick.setValue('message_type', 'Quick_Will');
                    emsgQuick.setValue('is_active', true);
                    emsgQuick.setValue('created_at', new GlideDateTime());

                    if (emsgQuick.insert()) {
                        data.success = true;
                    }
                }
            } catch (e) {
                gs.error("[Kokoro] Quick will error: " + e.message);
            }
            return;
        }

        // å¿—æ„¿è€…æ“ä½œ
        if (input.sys_id) {
            if (!validateSysId(input.sys_id)) {
                data.error = "ç„¡åŠ¹ãªID";
                return;
            }

            var taskGr = new GlideRecord(CONFIG.tables.SILENT_WISH);
            if (!taskGr.get(input.sys_id)) {
                data.error = "ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
                return;
            }

            var currentState = String(taskGr.getValue('state') || '10');

            if (input.action === 'assign_to_me') {
                if (!isVolunteer) {
                    data.error = "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢æ¨©é™ãŒå¿…è¦ã§ã™";
                    return;
                }

                taskGr.setValue('assigned_to', data.user_id);
                
                if (currentState === '1' || currentState === '10') {
                    var validationAssign = StateValidator.validateTransition(currentState, '11');
                    if (validationAssign.valid) {
                        taskGr.setValue('state', '11');
                    }
                }
                
                if (taskGr.update()) {
                    data.success = true;
                    logProcessEvent(input.sys_id, 'Task assigned to ' + data.user_name, data.user_id);
                } else {
                    data.error = "æ›´æ–°å¤±æ•—";
                }
                return;
            }

            if (input.action === 'assign_to' && input.assignee_id) {
                if (!isVolunteer) {
                    data.error = "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢æ¨©é™ãŒå¿…è¦ã§ã™";
                    return;
                }

                taskGr.setValue('assigned_to', input.assignee_id);
                
                if (currentState === '1' || currentState === '10') {
                    var validationAssignTo = StateValidator.validateTransition(currentState, '11');
                    if (validationAssignTo.valid) {
                        taskGr.setValue('state', '11');
                    }
                }
                
                if (taskGr.update()) {
                    data.success = true;
                    logProcessEvent(input.sys_id, 'Task assigned to ' + input.assignee_id, data.user_id);
                } else {
                    data.error = "æ›´æ–°å¤±æ•—";
                }
                return;
            }

            if (input.action === 'change_status' && input.new_state) {
                var newState = String(input.new_state);
                var validationChange = StateValidator.validateTransition(currentState, newState);
                
                if (!validationChange.valid) {
                    data.error = validationChange.message;
                    return;
                }

                if ((newState === '2' || newState === '4') && taskGr.assigned_to.nil()) {
                    data.error = "å…ˆã«æ‹…å½“è€…ã‚’è¨­å®šã—ã¦ãã ã•ã„";
                    return;
                }

                taskGr.setValue('state', newState);
                
                if (newState === '4') {
                    taskGr.setValue('u_completed_at', new GlideDateTime());
                }
                
                if (taskGr.update()) {
                    data.success = true;
                    logProcessEvent(input.sys_id, 'Status changed to ' + newState, data.user_id);
                } else {
                    data.error = "æ›´æ–°å¤±æ•—";
                }
                return;
            }

            if (input.action === 'start') {
                var validationStart = StateValidator.validateTransition(currentState, '2');
                if (!validationStart.valid) {
                    data.error = validationStart.message;
                    return;
                }

                if (taskGr.getValue('assigned_to') != data.user_id && !gs.hasRole('admin')) {
                    data.error = "è‡ªåˆ†ã«æ‹…å½“ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®ã¿é–‹å§‹ã§ãã¾ã™";
                    return;
                }

                taskGr.setValue('state', '2');
                
                if (taskGr.update()) {
                    data.success = true;
                    logProcessEvent(input.sys_id, 'Task started', data.user_id);
                } else {
                    data.error = "æ›´æ–°å¤±æ•—";
                }
                return;
            }

            if (input.action === 'complete') {
                var validationComplete = StateValidator.validateTransition(currentState, '4');
                if (!validationComplete.valid) {
                    data.error = validationComplete.message;
                    return;
                }

                taskGr.setValue('state', '4');
                taskGr.setValue('u_completed_at', new GlideDateTime());
                
                if (taskGr.update()) {
                    data.success = true;
                    logProcessEvent(input.sys_id, 'Task completed', data.user_id);
                } else {
                    data.error = "æ›´æ–°å¤±æ•—";
                }
                return;
            }

            if (input.action === 'add_comment' && input.message) {
                try {
                    taskGr.work_notes = sanitizeInput(input.message, 1000);
                    taskGr.update();
                    data.success = true;
                    logProcessEvent(input.sys_id, 'Comment added', data.user_id);
                } catch (e) {
                    data.error = "ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ å¤±æ•—";
                }
                return;
            }
        }
    }

    // ==========================================
    // 5. åŠ è½½æ•°æ®åˆ—è¡¨ (ä¿®å¤ç‰ˆ: å¢åŠ  myRequests)
    // ==========================================
    
    // helper: æ„å»ºæŸ¥è¯¢
    function fetchWishes(queryType) {
        var results = [];
        var gr = new GlideRecord(CONFIG.tables.SILENT_WISH);
        
        if (queryType === 'mine_assigned') {
            gr.addQuery('assigned_to', data.user_id);
        } else if (queryType === 'mine_created') {
            gr.addQuery('sys_created_by', gs.getUserName());
        } else if (queryType === 'all') {
            // No filter
        }
        
        gr.orderByDesc('sys_created_on');
        gr.setLimit(queryType === 'all' ? 100 : 50);
        gr.query();
        
        while (gr.next()) {
            results.push(buildTaskItem(gr));
        }
        return results;
    }

    // æ— è®ºèº«ä»½å¦‚ä½•ï¼Œéƒ½åŠ è½½"æˆ‘æäº¤çš„"å·¥å•
    data.myRequests = fetchWishes('mine_created');

    if (isVolunteer) {
        // å¿—æ„¿è€…é¢å¤–åŠ è½½: åˆ†é…ç»™æˆ‘çš„ + æ‰€æœ‰å·¥å•
        data.myTasks = fetchWishes('mine_assigned');
        data.list = fetchWishes('all');
        
        // åŠ è½½ç»Ÿè®¡
        try {
            var gaOpen = new GlideAggregate(CONFIG.tables.SILENT_WISH);
            gaOpen.addNullQuery('assigned_to');
            gaOpen.addQuery('state', 'NOT IN', [CONFIG.wishStates.COMPLETED, CONFIG.wishStates.CANCELLED]);
            gaOpen.addAggregate('COUNT');
            gaOpen.query();
            if (gaOpen.next()) data.openCount = parseInt(gaOpen.getAggregate('COUNT')) || 0;

            var gaSOS = new GlideAggregate(CONFIG.tables.SILENT_WISH);
            gaSOS.addQuery('u_urgency', 'Critical');
            gaSOS.addQuery('state', 'NOT IN', [CONFIG.wishStates.COMPLETED, CONFIG.wishStates.CANCELLED]);
            gaSOS.addAggregate('COUNT');
            gaSOS.query();
            if (gaSOS.next()) data.sosCount = parseInt(gaSOS.getAggregate('COUNT')) || 0;
        } catch (e) {}
        
        data.volunteers = loadVolunteerList();
    } else {
        // æ™®é€šç”¨æˆ·: ä¸»åˆ—è¡¨å°±æ˜¯æˆ‘æäº¤çš„
        data.list = data.myRequests; 
    }

    // ==========================================
    // [DAY 5 INTEGRATION] Process Mining & Monitoring Data
    // æ’å…¥ä½ç½®: Server Script æœ€åéƒ¨åˆ†, })(); ä¹‹å‰
    // ==========================================

    // === 1. è·å–Process Miningç»Ÿè®¡ ===
    data.processMiningStats = {
        totalEvents: 0,
        todayEvents: 0,
        uniqueCases: 0,
        topActivities: []
    };

    try {
        // æ€»äº‹ä»¶æ•°
        var gaEvents = new GlideAggregate('x_1821654_kokoro_0_process_event');
        gaEvents.addAggregate('COUNT');
        gaEvents.query();
        if (gaEvents.next()) {
            data.processMiningStats.totalEvents = parseInt(gaEvents.getAggregate('COUNT')) || 0;
        }
        
        // ä»Šæ—¥äº‹ä»¶æ•° â€” ä½¿ç”¨ todayPM é¿å…ä¸å…¶ä»–å±€éƒ¨å˜é‡å†²çª
        var todayPM = new GlideDateTime();
        todayPM.setDisplayValue(todayPM.getDate().toString());
        
        var gaTodayEvents = new GlideAggregate('x_1821654_kokoro_0_process_event');
        gaTodayEvents.addQuery('timestamp', '>=', todayPM);
        gaTodayEvents.addAggregate('COUNT');
        gaTodayEvents.query();
        if (gaTodayEvents.next()) {
            data.processMiningStats.todayEvents = parseInt(gaTodayEvents.getAggregate('COUNT')) || 0;
        }
        
        // å”¯ä¸€æ¡ˆä¾‹æ•°
        var gaCases = new GlideAggregate('x_1821654_kokoro_0_process_event');
        gaCases.addAggregate('COUNT', 'DISTINCT', 'case_id');
        gaCases.query();
        if (gaCases.next()) {
            data.processMiningStats.uniqueCases = parseInt(gaCases.getAggregate('COUNT', 'DISTINCT', 'case_id')) || 0;
        }
        
        // æ´»åŠ¨åˆ†å¸ƒ (Top 5)
        var gaAct = new GlideAggregate('x_1821654_kokoro_0_process_event');
        gaAct.addAggregate('COUNT');
        gaAct.groupBy('activity');
        gaAct.orderByAggregate('COUNT', 'DESC');
        gaAct.setLimit(5);
        gaAct.query();
        
        while (gaAct.next()) {
            data.processMiningStats.topActivities.push({
                name: gaAct.getValue('activity') || 'Unknown',
                count: parseInt(gaAct.getAggregate('COUNT')) || 0
            });
        }
    } catch (e) {
        gs.debug('[Kokoro] Process Mining stats not available: ' + e.message);
    }

    // === 2. è·å–ç³»ç»Ÿç›‘æ§æŒ‡æ ‡ ===
    data.systemMetrics = {
        healthScore: 100,
        lastCollected: '',
        alerts: {
            critical: 0,
            warning: 0
        }
    };

    try {
        var grMetrics = new GlideRecord('x_1821654_kokoro_0_metrics');
        grMetrics.addQuery('metric_type', 'system_health');
        grMetrics.orderByDesc('timestamp');
        grMetrics.setLimit(1);
        grMetrics.query();
        
        if (grMetrics.next()) {
            data.systemMetrics.healthScore = parseInt(grMetrics.getValue('health_score')) || 100;
            data.systemMetrics.lastCollected = grMetrics.getDisplayValue('timestamp');
            
            var metricData = grMetrics.getValue('metric_data');
            if (metricData) {
                try {
                    var parsed = JSON.parse(metricData);
                    if (parsed.alerts) {
                        data.systemMetrics.alerts = parsed.alerts;
                    }
                } catch (parseErr) {}
            }
        }
        
        // è·å–ä»Šæ—¥Criticalå‘Šè­¦æ•°é‡ â€” å¤ç”¨ todayPMï¼ˆå·²åœ¨ä¸Šæ–¹å®šä¹‰ï¼‰
        var gaAlertsCrit = new GlideAggregate('x_1821654_kokoro_0_metrics');
        gaAlertsCrit.addQuery('metric_type', 'alert');
        gaAlertsCrit.addQuery('health_score', '<', 50);
        gaAlertsCrit.addQuery('timestamp', '>=', todayPM);
        gaAlertsCrit.addAggregate('COUNT');
        gaAlertsCrit.query();
        if (gaAlertsCrit.next()) {
            data.systemMetrics.alerts.critical = parseInt(gaAlertsCrit.getAggregate('COUNT')) || 0;
        }
        
    } catch (e) {
        gs.debug('[Kokoro] System metrics not available: ' + e.message);
    }

    // === 3. è·å–å®¡è®¡æ—¥å¿—ç»Ÿè®¡ ===
    data.auditStats = {
        todayLogs: 0,
        recentActions: []
    };

    try {
        var gaAudit = new GlideAggregate('x_1821654_kokoro_0_audit_log');
        gaAudit.addQuery('timestamp', '>=', todayPM);
        gaAudit.addAggregate('COUNT');
        gaAudit.query();
        if (gaAudit.next()) {
            data.auditStats.todayLogs = parseInt(gaAudit.getAggregate('COUNT')) || 0;
        }
        
        // æœ€è¿‘5ä¸ªæ“ä½œ
        var grAudit = new GlideRecord('x_1821654_kokoro_0_audit_log');
        grAudit.orderByDesc('timestamp');
        grAudit.setLimit(5);
        grAudit.query();
        
        while (grAudit.next()) {
            data.auditStats.recentActions.push({
                action: grAudit.getValue('action') || 'Unknown',
                user: grAudit.getDisplayValue('user') || 'System',
                time: grAudit.getDisplayValue('timestamp')
            });
        }
    } catch (e) {
        gs.debug('[Kokoro] Audit stats not available: ' + e.message);
    }

    // === 4. è®¡ç®—ç»¼åˆå¥åº·è¯„åˆ† ===
    data.overallHealth = {
        score: 100,
        status: 'nominal',
        components: []
    };

    try {
        var healthScores = [];
        
        // SLAå¥åº·åº¦
        var slaHealthScore = 100;
        if (data.slaStats && data.slaStats.breached > 0) {
            slaHealthScore = Math.max(0, 100 - (data.slaStats.breached * 10));
        }
        healthScores.push({ name: 'SLA', score: slaHealthScore });
        
        // ä»»åŠ¡å¤„ç†å¥åº·åº¦
        var taskHealthScore = 100;
        if (data.openCount > 10) {
            taskHealthScore = Math.max(50, 100 - (data.openCount * 2));
        }
        healthScores.push({ name: 'Tasks', score: taskHealthScore });
        
        // ç³»ç»Ÿå¥åº·åº¦
        healthScores.push({ name: 'System', score: data.systemMetrics.healthScore });
        
        // è®¡ç®—å¹³å‡åˆ†
        var totalHealthScore = 0;
        for (var hi = 0; hi < healthScores.length; hi++) {
            totalHealthScore += healthScores[hi].score;
        }
        data.overallHealth.score = Math.round(totalHealthScore / healthScores.length);
        data.overallHealth.components = healthScores;
        
        // ç¡®å®šçŠ¶æ€
        if (data.overallHealth.score >= 90) {
            data.overallHealth.status = 'nominal';
        } else if (data.overallHealth.score >= 70) {
            data.overallHealth.status = 'warning';
        } else {
            data.overallHealth.status = 'critical';
        }
        
    } catch (e) {
        gs.debug('[Kokoro] Health calculation error: ' + e.message);
    }

    // ==========================================
    // [END OF DAY 5 INTEGRATION]
    // ==========================================

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-26 11:41:20</sys_created_on>
        <sys_id>f95e8ba383227210f6b1fb96feaad375</sys_id>
        <sys_mod_count>195</sys_mod_count>
        <sys_name>Kokoro Volunteer Dashboard</sys_name>
        <sys_package display_value="Kokoro Shelter" source="x_1821654_kokoro_0">80ba4d9583863210f6b1fb96feaad3b2</sys_package>
        <sys_policy/>
        <sys_scope display_value="Kokoro Shelter">80ba4d9583863210f6b1fb96feaad3b2</sys_scope>
        <sys_update_name>sp_widget_f95e8ba383227210f6b1fb96feaad375</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-02-05 07:14:01</sys_updated_on>
        <template><![CDATA[<style>
/* ============================================================
   KOKORO DASHBOARD CSS v9.6 (ULTIMATE FUSED EDITION)
   é€‚é…ï¼šv4.0 Zenless Structure + v9.5 Visual Style
   ============================================================ */

  /* 1. åŸºç¡€éšè— (åŸæœ‰) */
nav, header, footer, .sp-page-header, .navbar, .polaris-header, 
.sn-polaris-nav, .sn-canvas-header, #sp-nav-bar, .sp-row-background,
.cms-header, .navpage-header {
  display: none !important;
}

/* 2. é’ˆå¯¹æ€§éšè— */
.sn-chat-overlay, .help-button-wrapper, .sp-ac-root, .sw-session-repro-button,
button.help-button, .sn-connect-floating-wrapper, #u_chat_button, .cm-help-button,
.sp-page-row-options, .theme-picker, .sp-debug-tool, div[ng-controller="spPageRowOptions"],
a[title="Toggle Layout"], .btn-floating, .sp-icon-edit,
.guided-tour-overlay, .code-editor-container, 
.icon-palette, .fa-cog, .sp-icon-color, .sp-preview-pill {
  display: none !important;
  visibility: hidden !important;
  width: 0 !important; height: 0 !important;
  pointer-events: none !important;
  opacity: 0 !important;
  z-index: -9999 !important;
}

/* æ— å·®åˆ«æ‰“å‡»å›ºå®šå®šä½å…ƒç´  */
body > div[style*="position: fixed"][style*="bottom"],
body > div[style*="position:fixed"][style*="bottom"],
body > button[style*="position: fixed"][style*="bottom"],
body > div[style*="position: fixed"][style*="left"], 
body > div[style*="position:fixed"][style*="left"] {
    display: none !important;
    opacity: 0 !important;
    pointer-events: none !important;
    z-index: -9999 !important;
}

/* 3. å®¹å™¨æ ·å¼ (ä¿®å¤ç‰ˆ: å¼ºåˆ¶å…¨å±è¦†ç›–ï¼Œè„±ç¦»SPå®¹å™¨é™åˆ¶) */
.kokoro-volunteer-container {
    display: flex;
    flex-direction: column;
    padding: 0 !important;
    margin: 0 !important;
    overflow: hidden;
    background: var(--bg-color);
    /* å…³é”®ä¿®æ”¹ï¼šä½¿ç”¨ fixed å®šä½å¼ºè¡Œå æ»¡å±å¹• */
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 1000; /* æå‡å±‚çº§ï¼Œè¦†ç›–é»˜è®¤Portalå…ƒç´  */
}
  
* {
  box-sizing: border-box;
}

/* 4. Modal æ ¸å¿ƒä¿®å¤ */
.modal { z-index: 20000 !important; }
.modal-backdrop { z-index: 19999 !important; background-color: rgba(0,0,0,0.9) !important; backdrop-filter: blur(2px); }
.modal-dialog { margin-top: 50px; z-index: 20001 !important; max-width: 900px; width: 90%; }
.modal-content {
  background: #fdfdfd !important;
  border: 2px solid var(--border-dark) !important;
  border-radius: 0 !important;
  box-shadow: 0 30px 60px rgba(0,0,0,0.8) !important;
  color: var(--text-primary) !important;
  font-family: var(--font-mono) !important;
  padding: 0 !important;
  overflow: visible !important;
}

/* 5. æ¨¡æ€æ¡†å†…éƒ¨æ ·å¼ */
.modal-header-clean { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  padding: 16px 24px; 
  background: #f0f0f0; 
  border-bottom: 2px solid var(--border-dark); 
}

.header-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-badge { 
  background: var(--border-dark); 
  color: #fff; 
  padding: 4px 10px; 
  font-weight: 700; 
  font-size: 0.8rem; 
}
.header-id { 
  font-family: var(--font-tech); 
  font-weight: 700; 
  font-size: 1.1rem; 
}
.header-close { 
  background: none; 
  border: 1px solid #ccc; 
  width: 32px; 
  height: 32px; 
  cursor: pointer; 
  transition: all 0.2s; 
  font-size: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.header-close:hover { 
  background: var(--color-critical); 
  color: #fff; 
  border-color: var(--color-critical); 
}

.modal-body-grid { 
  display: grid; 
  grid-template-columns: 1fr 300px; 
  min-height: 500px; 
  max-height: 70vh;
  overflow: hidden;
}

.body-main { 
  padding: 24px; 
  border-right: 1px solid var(--border-light); 
  overflow-y: auto;
  max-height: 70vh;
}

.body-sidebar {
  background: #fcfcfc;
  padding: 24px;
  overflow-y: auto;
  max-height: 70vh;
}

.ticket-title { 
  font-family: var(--font-header); 
  font-size: 1.5rem; 
  font-weight: 700; 
  margin: 0 0 20px 0; 
  border-bottom: 1px solid var(--border-light); 
  padding-bottom: 15px; 
}

.qty-badge-black { 
  background: #000; 
  color: #fff; 
  padding: 2px 8px; 
  font-size: 0.8rem; 
  vertical-align: middle; 
  margin-left: 10px; 
}

.action-bar { 
  display: flex; 
  gap: 12px; 
  margin-bottom: 24px; 
  flex-wrap: wrap; 
}

.btn-purple-outline, .btn-normal { 
  border: 1px solid #ccc; 
  background: #fff; 
  padding: 8px 16px; 
  font-weight: 700; 
  cursor: pointer; 
  text-transform: uppercase;
  font-family: var(--font-header);
  font-size: 12px;
  transition: all 0.2s;
}

.btn-purple-outline {
  border-color: var(--accent-primary);
  color: var(--accent-primary);
}

.btn-purple-outline:hover {
  background: var(--accent-primary);
  color: #fff;
}

.btn-normal:hover {
  background: #f0f0f0;
}

.action-btn { 
  background: var(--border-dark); 
  color: #fff; 
  border: none; 
  padding: 8px 16px; 
  font-weight: 700; 
  cursor: pointer; 
  text-transform: uppercase; 
  font-family: var(--font-header);
  font-size: 12px;
  transition: all 0.2s;
}

.action-btn:hover { 
  background: #333; 
}

.desc-box { 
  background: #fafafa; 
  border: 1px solid var(--border-light); 
  padding: 16px; 
  margin-bottom: 24px; 
}

.desc-section-title { 
  font-size: 0.8rem; 
  color: var(--text-tertiary); 
  margin-bottom: 12px; 
  font-weight: 700; 
  letter-spacing: 1px; 
}

.desc-grid { 
  display: grid; 
  gap: 12px; 
}

.desc-item { 
  display: flex; 
  gap: 10px; 
  align-items: flex-start; 
  font-size: 0.9rem; 
}

.desc-icon { 
  width: 24px; 
  text-align: center; 
  color: #666; 
  flex-shrink: 0;
}

.desc-label { 
  font-weight: 700; 
  color: var(--text-secondary); 
  margin-right: 6px; 
}

.activity-area { 
  margin-top: 20px; 
}

.note-input { 
  width: 100%; 
  border: 1px solid #ccc; 
  padding: 10px; 
  min-height: 60px; 
  margin-bottom: 10px; 
  font-family: var(--font-mono); 
  resize: vertical;
}

.submit-btn { 
  background: #ccc; 
  color: #fff; 
  border: none; 
  padding: 8px 16px; 
  font-weight: 700; 
  cursor: not-allowed; 
  float: right;
  transition: all 0.2s;
}

.submit-btn.ready { 
  background: var(--border-dark); 
  cursor: pointer; 
}

.submit-btn.ready:hover {
  background: #333;
}

.sidebar-block { 
  margin-bottom: 24px; 
  padding-bottom: 16px; 
  border-bottom: 1px solid var(--border-light); 
}

.sb-label { 
  font-size: 0.75rem; 
  color: var(--text-tertiary); 
  margin-bottom: 8px; 
  font-weight: 700; 
  letter-spacing: 1px; 
}

.user-row { 
  display: flex; 
  align-items: center; 
  gap: 10px; 
}

.avatar-box { 
  width: 32px; 
  height: 32px; 
  background: var(--border-dark); 
  color: #fff; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  border-radius: 4px; 
  font-weight: 700;
  flex-shrink: 0;
}

.avatar-box.orange { 
  background: var(--color-warning); 
}

.user-name-text {
  font-weight: 600;
  color: var(--text-primary);
}

.state-indicator { 
  padding: 4px 10px; 
  border-radius: 4px;
  color: #fff;
  font-weight: 700;
  font-size: 0.9rem;
  display: inline-block;
}

.priority-btn { 
  background: var(--border-mid);
  color: var(--text-secondary); 
  padding: 10px 18px; 
  font-family: var(--font-header); 
  font-weight: 700; 
  font-size: 14px; 
  display: flex; 
  align-items: center; 
  gap: 10px;
}

.ai-card { 
  background: #f3e5f5; 
  border: 1px solid #e1bee7; 
  padding: 12px; 
  margin-bottom: 24px;
  border-left: 4px solid #7b1fa2;
}

.ai-head { 
  color: #7b1fa2; 
  font-weight: 700; 
  font-size: 0.8rem; 
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.ai-text { 
  font-size: 0.85rem; 
  color: #4a148c; 
  line-height: 1.4;
}

.sla-progress { 
  height: 10px; 
  background: #eee; 
  overflow: hidden; 
  margin-bottom: 12px;
  border-radius: 4px;
}

.sla-fill { 
  height: 100%; 
  position: relative;
  border-radius: 4px;
}

.sla-text { 
  display: flex; 
  justify-content: space-between; 
  font-family: var(--font-mono); 
  font-size: 12px; 
  color: var(--text-tertiary); 
  margin-bottom: 12px;
}

.sla-badge { 
  background: var(--border-mid);
  color: var(--text-secondary); 
  padding: 8px 16px; 
  font-family: var(--font-mono); 
  font-size: 12px; 
  font-weight: 800; 
  letter-spacing: 1px; 
  display: inline-flex; 
  align-items: center; 
  gap: 8px;
  border-radius: 4px;
}

.sla-badge.sla-critical { 
  background: rgba(255, 59, 48, 0.2); 
  color: var(--color-critical);
}

.sla-badge.sla-ok { 
  background: rgba(52, 199, 89, 0.2); 
  color: var(--color-success);
}

.dropdown-wrapper { 
  position: relative; 
  display: inline-block; 
}

.status-menu { 
  position: absolute; 
  top: 100%; 
  left: 0; 
  background: #fff; 
  border: 1px solid #ccc; 
  box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
  z-index: 10; 
  min-width: 160px;
  margin-top: 2px;
}

.status-item { 
  padding: 10px 16px; 
  cursor: pointer; 
  font-size: 0.85rem; 
  border-bottom: 1px solid var(--border-light);
  transition: all 0.2s;
}

.status-item:hover { 
  background: #f5f5f5; 
}

.status-item.danger { 
  color: var(--color-critical); 
}

/* 6. Headers & Layout (v4.0 Support) */
.command-header {
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    padding: 15px 20px; 
    background: #fff; 
    border-bottom: 2px solid var(--border-dark);
    flex-shrink: 0;
    height: 70px;
}

.hamburger-btn {
  background: none;
  border: 1px solid var(--border-mid);
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  margin-right: 10px;
  transition: all 0.2s;
}

.hamburger-btn:hover {
  background: #f0f0f0;
  border-color: var(--border-dark);
}

.hamburger-btn i {
  font-size: 18px;
  color: var(--text-primary);
}

.command-logo { 
  display: flex; 
  align-items: center; 
  gap: 10px;
  flex: 1;
  min-width: 0;
}

.logo-icon { 
    background: #000; 
    color: #fff; 
    width: 36px; 
    height: 36px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-weight: 900; 
    font-family: var(--font-header); 
    font-size: 1.2rem;
    flex-shrink: 0;
}

.logo-text { 
  display: flex; 
  flex-direction: column; 
  line-height: 1.2;
  flex-shrink: 0;
}

.logo-title { 
  font-weight: 900; 
  font-size: 1.2rem; 
  letter-spacing: -1px;
  color: var(--text-primary);
}

.logo-subtitle { 
  font-size: 0.65rem; 
  color: #666; 
  letter-spacing: 1px;
}

.system-status { 
  display: flex; 
  align-items: center; 
  gap: 15px; 
  font-size: 0.8rem; 
  font-family: var(--font-mono);
  margin-left: auto;
  flex-shrink: 0;
}

.status-indicator { 
  display: flex; 
  align-items: center; 
  gap: 6px; 
  color: var(--color-success); 
  font-weight: bold; 
}

.status-dot { 
  width: 8px; 
  height: 8px; 
  background: var(--color-success); 
  border-radius: 50%; 
  box-shadow: 0 0 5px var(--color-success); 
  animation: blink 2s infinite;
}

.status-text {
  color: var(--text-primary);
  font-weight: 700;
}

.version-tag { 
  background: #eee; 
  padding: 2px 6px; 
  color: #666; 
  font-size: 0.7rem;
  border-radius: 2px;
}

.system-time {
  font-family: var(--font-mono);
  color: var(--text-secondary);
  font-weight: 600;
}

.scan-line-header {
    display: flex; 
    align-items: center; 
    gap: 10px; 
    padding: 10px 20px;
    font-size: 0.7rem; 
    color: #999; 
    letter-spacing: 2px;
    flex-shrink: 0;
    background: #fff;
    border-bottom: 1px solid var(--border-light);
}

.scan-line { 
  height: 1px; 
  background: #ddd; 
  flex-grow: 1; 
}

.nav-tabs-custom { 
  display: flex; 
  background: #fff; 
  border-bottom: 1px solid #ddd; 
  padding: 0 20px; 
  gap: 20px;
  flex-shrink: 0;
  overflow-x: auto;
  overflow-y: hidden;
}

.tab { 
  padding: 15px 0; 
  cursor: pointer; 
  border-bottom: 3px solid transparent; 
  font-weight: 700; 
  color: #999; 
  font-size: 0.9rem; 
  font-family: var(--font-header); 
  transition: all 0.2s;
  white-space: nowrap;
  flex-shrink: 0;
}

.tab:hover { 
  color: #333; 
}

.tab.active { 
  border-bottom-color: var(--accent-primary); 
  color: #000; 
}

.tab-number { 
  font-family: var(--font-mono); 
  font-size: 0.8rem; 
  color: #ccc;
  margin-right: 4px;
}

.board-container { 
  padding: 20px; 
  overflow-y: auto; 
  overflow-x: hidden;
  flex: 1;
  background: var(--bg-color);
  width: 100% !important;      /* æ–°å¢ */
  max-width: none !important;  /* æ–°å¢ */
  margin: 0 !important;        /* æ–°å¢ */
}

.two-column-layout { 
  display: grid; 
  grid-template-columns: 1fr 320px; 
  gap: 20px; 
  margin-top: 20px; 
}

/* 7. Volunteers & Stats */
.volunteer-status-panel {
  background: #fff; 
  border: 1px solid #ddd; 
  border-left: 4px solid #000;
  padding: 12px 20px; 
  margin-bottom: 20px;
  display: flex; 
  align-items: center; 
  gap: 30px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  flex-wrap: wrap;
}

.status-row { 
  display: flex; 
  align-items: center; 
  gap: 10px; 
  font-family: var(--font-header); 
  font-weight: 700; 
  color: #333;
}

.status-row i {
  color: var(--text-secondary);
}

.btn-online, .btn-offline { 
  border: none; 
  padding: 6px 16px; 
  border-radius: 20px; 
  font-weight: bold; 
  cursor: pointer; 
  transition: all 0.2s;
  font-family: var(--font-header);
}

.btn-online { 
  background: var(--color-success); 
  color: white; 
}

.btn-online:hover {
  opacity: 0.8;
}

.btn-offline { 
  background: #888; 
  color: #fff; 
}

.btn-offline:hover {
  opacity: 0.8;
}

.status-row select { 
  padding: 5px 10px; 
  border: 1px solid #ccc; 
  border-radius: 4px; 
  font-family: var(--font-mono);
  background: white;
  cursor: pointer;
}

.stats-section .section-header { 
  display: flex; 
  align-items: center; 
  margin-bottom: 15px; 
  border-bottom: 1px solid #eee; 
  padding-bottom: 10px; 
}

.section-tag { 
  background: #000; 
  color: #fff; 
  padding: 2px 8px; 
  font-weight: 700; 
  font-size: 0.8rem; 
  margin-right: 10px;
  border-radius: 2px;
}

.section-title { 
  font-weight: 700; 
  font-family: var(--font-header); 
  font-size: 1.1rem; 
  letter-spacing: 1px;
  color: var(--text-primary);
}

.section-time { 
  margin-left: auto; 
  font-family: var(--font-mono); 
  font-size: 0.8rem; 
  color: #999;
}

.stats-row { 
  display: flex; 
  gap: 15px; 
  flex-wrap: wrap; 
}

.stat-card { 
  background: #fff; 
  border: 1px solid #ddd; 
  padding: 15px; 
  flex: 1; 
  min-width: 140px; 
  position: relative; 
  transition: all 0.2s;
  cursor: default;
}

.stat-card.clickable {
  cursor: pointer;
}

.stat-card.clickable:hover { 
  border-color: var(--accent-primary); 
  transform: translateY(-2px); 
  box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
}

.stat-label { 
  font-size: 0.7rem; 
  color: #999; 
  margin-bottom: 5px; 
  font-weight: 700;
}

.stat-code {
  font-family: var(--font-tech);
  font-weight: 700;
}

.stat-suffix {
  font-size: 0.6rem;
  margin-left: 2px;
}

.stat-num { 
  font-size: 2.2rem; 
  font-weight: 700; 
  font-family: var(--font-tech); 
  line-height: 1; 
  margin-bottom: 5px; 
  color: #1a1a1a; 
}

.stat-name { 
  font-size: 0.8rem; 
  font-weight: 700; 
  color: #555; 
  margin-bottom: 10px; 
}

.stat-footer { 
  display: flex; 
  justify-content: space-between;
  align-items: center;
  font-size: 0.7rem; 
  font-weight: 700; 
  border-top: 1px solid #eee; 
  padding-top: 6px;
}

.stat-change { 
  display: inline-block;
}

.stat-change.positive { 
  color: var(--color-success); 
}

.stat-change.negative { 
  color: var(--color-critical); 
}

.stat-status { 
  display: inline-block;
  padding: 1px 4px;
  border-radius: 2px;
}

.stat-status.nominal { 
  color: var(--color-success); 
  background: #e8f5e9; 
}

.stat-status.critical { 
  color: white; 
  background: var(--color-critical); 
}

.stat-status.warning { 
  color: white; 
  background: var(--color-warning); 
}

/* 8. Metal Dividers */
.metal-divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, #ccc, transparent);
    margin: 15px 0;
}

.metal-divider-glow {
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
    margin: 20px 0;
    box-shadow: 0 0 5px rgba(98, 0, 234, 0.3);
}

/* 9. Cards (Tactical & Alert) */
.alert-section {
  background: #fff;
  border: 1px solid #ddd;
  padding: 0;
  box-shadow: 0 2px 5px rgba(0,0,0,0.03);
}

.alert-section .section-header {
  background: #f8f8f8;
  border-bottom: 1px solid #ddd;
  padding: 15px 20px;
  margin: 0;
}

.alert-list { 
  max-height: 500px;
  overflow-y: auto;
}

.alert-item { 
    background: #fff; 
    border-bottom: 1px solid #eee;
    padding: 12px 16px; 
    margin: 0;
    display: grid; 
    grid-template-columns: 80px 60px 100px 60px 1fr 20px; 
    align-items: center; 
    gap: 10px;
    transition: all 0.2s; 
    cursor: pointer; 
    font-size: 0.85rem;
}

.alert-item:hover { 
  border-left: 4px solid var(--accent-primary);
  background: #fafafa; 
}

.alert-item.priority-Critical { 
  border-left: 4px solid var(--color-critical);
}

.alert-item.priority-High { 
  border-left: 4px solid var(--color-warning);
}

.alert-priority { 
  font-weight: 700;
  text-align: center;
}

.alert-priority.p-critical { 
  color: var(--color-critical); 
  font-weight: 900; 
}

.alert-priority.p-high { 
  color: var(--color-warning); 
  font-weight: 700; 
}

.alert-id { 
  font-family: var(--font-mono); 
  color: #666;
  font-weight: 700;
}

.alert-zone {
  color: var(--text-secondary);
  font-weight: 600;
}

.alert-time { 
  font-family: var(--font-mono); 
  color: #999; 
  font-size: 0.75rem;
}

.alert-content {
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.alert-arrow {
  color: var(--text-tertiary);
  text-align: right;
}

.empty-board {
  padding: 60px 20px;
  text-align: center;
  color: var(--text-tertiary);
}

.empty-board i {
  font-size: 48px;
  color: var(--border-light);
  margin-bottom: 15px;
}

.empty-board h4 {
  font-size: 1.2rem;
  color: var(--text-secondary);
  margin: 10px 0;
}

.empty-board p {
  font-size: 0.9rem;
  color: var(--text-tertiary);
}

.card-grid, .task-grid { 
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
  gap: 20px; 
  margin-top: 20px; 
  width: 100% !important; /* å¼ºåˆ¶ Grid å®¹å™¨å æ»¡å…¨å®½ */
  justify-content: start; /* é˜²æ­¢ Grid é¡¹ç›®åœ¨æ•°é‡å°‘æ—¶å±…ä¸­å¯¼è‡´çš„è§†è§‰å˜çª„ */
}

.jira-card { 
  background: #fff; 
  border: 1px solid #ddd; 
  padding: 16px; 
  transition: all 0.2s; 
  position: relative; 
  cursor: pointer; 
}

.jira-card:hover { 
  transform: translateY(-3px); 
  box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
  border-color: #bbb; 
}

.jira-card.priority-Critical { 
  border-top: 3px solid var(--color-critical); 
}

.jira-card.priority-High { 
  border-top: 3px solid var(--color-warning); 
}

.card-top { 
  display: flex; 
  justify-content: space-between; 
  align-items: flex-start;
  margin-bottom: 10px; 
}

.card-id { 
  font-family: var(--font-mono); 
  font-size: 0.8rem; 
  color: #999;
  font-weight: 700;
}

.status-tag { 
  font-size: 0.7rem; 
  font-weight: 700; 
  padding: 2px 6px; 
  border-radius: 4px; 
  background: #eee; 
  color: #555;
}

.status-tag.status-4 {
  background: #e8f5e9;
  color: var(--color-success);
}

.status-tag.status-11 {
  background: #e3f2fd;
  color: var(--color-info);
}

.card-title { 
  font-weight: 700; 
  margin-bottom: 8px; 
  font-family: var(--font-header); 
  font-size: 1.1rem;
  color: var(--text-primary);
}

.qty-badge { 
  background: #000; 
  color: #fff; 
  font-size: 0.7rem; 
  padding: 1px 5px; 
  margin-left: 6px; 
  vertical-align: middle;
  border-radius: 2px;
}

.card-loc { 
  font-size: 0.85rem; 
  color: #555; 
  margin-bottom: 5px;
}

.card-loc i {
  color: var(--color-critical);
  margin-right: 4px;
}

.card-detail { 
  font-size: 0.8rem; 
  color: #999; 
  margin-bottom: 10px; 
  white-space: nowrap; 
  overflow: hidden; 
  text-overflow: ellipsis; 
}

.card-sla { 
  margin: 10px 0; 
  padding-top: 8px; 
  border-top: 1px dashed #eee; 
}

.sla-bar-container { 
  height: 4px; 
  background: #eee; 
  border-radius: 2px; 
  overflow: hidden; 
  margin-bottom: 4px; 
}

.sla-bar { 
  height: 100%; 
  transition: width 0.3s ease;
  border-radius: 2px;
}

.sla-info { 
  display: flex; 
  justify-content: space-between; 
  font-size: 10px; 
  font-family: var(--font-tech); 
  color: #666; 
  font-weight: 700; 
}

.sla-critical { 
  color: var(--color-critical) !important; 
}

.sla-warning { 
  color: var(--color-warning) !important; 
}

.sla-ok { 
  color: var(--color-success) !important; 
}

.sla-remaining {
  display: flex;
  align-items: center;
  gap: 4px;
}

.card-footer{
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid #eee;
}

.priority-badge {
  font-size: 0.8rem;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 2px;
  background: #eee;
  color: #666;
  display: inline-block;
}

.btn-jira {
  background: transparent;
  border: 1px solid #ddd;
  color: var(--text-secondary);
  padding: 6px 12px;
  font-weight: 700;
  font-size: 0.8rem;
  cursor: pointer;
  text-transform: uppercase;
  font-family: var(--font-header);
  border-radius: 2px;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  width: 100%;
  margin-top: 8px;
  justify-content: center;
}

.btn-jira:hover {
  border-color: var(--border-dark);
  background: #f8f8f8;
}

.btn-jira.progress {
  border-color: var(--color-info);
  color: var(--color-info);
}

.btn-jira.progress:hover {
  background: rgba(0, 122, 255, 0.05);
}

.btn-jira.success {
  border-color: var(--color-success);
  color: var(--color-success);
}

.btn-jira.success:hover {
  background: rgba(52, 199, 89, 0.05);
}

.completed-msg {
  text-align: center;
  padding: 12px;
  background: rgba(52, 199, 89, 0.1);
  border: 1px solid var(--color-success);
  color: var(--color-success);
  font-weight: 700;
  cursor: pointer;
  margin-top: 8px;
  border-radius: 2px;
  transition: all 0.2s;
}

.completed-msg:hover {
  background: rgba(52, 199, 89, 0.2);
}

/* 10. Side Panel Enhanced & Widgets */
.side-panel-wrapper {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.side-panel-enhanced { 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
  margin-bottom: 20px; 
}

.data-stream-widget { 
  background: #fff; 
  border: 1px solid #ddd; 
  padding: 16px; 
  box-shadow: 0 2px 5px rgba(0,0,0,0.03); 
}

.widget-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  border-bottom: 2px solid var(--border-dark); 
  padding-bottom: 10px; 
  margin-bottom: 15px; 
}

.widget-title { 
  font-family: var(--font-header); 
  font-weight: 700; 
  font-size: 1rem; 
  color: var(--border-dark); 
  display: flex; 
  align-items: center; 
  gap: 8px; 
}

.live-indicator { 
  width: 8px; 
  height: 8px; 
  background: var(--color-success); 
  border-radius: 50%; 
  box-shadow: 0 0 5px var(--color-success); 
  animation: blink 2s infinite; 
}

.live-metric-card { 
  background: #fafafa; 
  border-left: 4px solid #333; 
  padding: 12px; 
  margin-bottom: 10px; 
  transition: transform 0.2s; 
}

.live-metric-card:hover { 
  transform: translateX(2px); 
}

.metric-row { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 6px; 
}

.metric-label { 
  font-size: 0.8rem; 
  font-weight: 700; 
  color: #555; 
}

.metric-value { 
  font-family: var(--font-tech); 
  font-weight: 700; 
  color: var(--border-dark); 
}

.metric-mini-bar { 
  height: 3px; 
  background: #eee; 
  width: 100%; 
  overflow: hidden;
  border-radius: 2px;
}

.metric-mini-fill { 
  height: 100%; 
  background: #666;
  border-radius: 2px;
}

.ai-insight-card { 
  background: #fdfbff; 
  border: 1px solid #d1c4e9; 
  padding: 16px; 
  position: relative; 
  overflow: hidden; 
}

.ai-insight-card::before { 
  content: ''; 
  position: absolute; 
  top: 0; 
  left: 0; 
  width: 4px; 
  height: 100%; 
  background: linear-gradient(to bottom, #7b1fa2, #ba68c8); 
}

.ai-header { 
  color: #6a1b9a; 
  font-weight: 700; 
  font-size: 0.9rem; 
  margin-bottom: 10px; 
  display: flex; 
  align-items: center; 
  gap: 8px; 
}

.ai-content { 
  font-size: 0.85rem; 
  color: #4a148c; 
  line-height: 1.5; 
  margin-bottom: 12px; 
}

.ai-tags { 
  display: flex; 
  gap: 6px; 
  flex-wrap: wrap; 
}

.ai-tag { 
  background: rgba(123, 31, 162, 0.1); 
  color: #7b1fa2; 
  padding: 2px 8px; 
  border-radius: 10px; 
  font-size: 0.7rem; 
  font-weight: 700; 
}

.resource-section-enhanced {
  background: #fff;
  border: 1px solid #ddd;
  padding: 16px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.03);
}

.resource-section-enhanced .section-header { 
  margin-bottom: 15px;
  padding-bottom: 0;
  border-bottom: none;
}

.resource-item { 
  margin-bottom: 15px; 
}

.resource-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: flex-end; 
  margin-bottom: 6px; 
}

.resource-header .label { 
  font-size: 0.85rem; 
  font-weight: 700; 
  color: #333; 
}

.resource-header .code { 
  font-family: var(--font-mono); 
  color: #999; 
  font-size: 0.75rem; 
  margin-right: 5px; 
}

.resource-header .percent { 
  font-family: var(--font-tech); 
  font-weight: 700;
  color: var(--text-primary);
}

.resource-bar { 
  height: 6px; 
  background: #eee; 
  border-radius: 3px; 
  overflow: hidden; 
}

.resource-fill { 
  height: 100%; 
  transition: width 0.5s ease;
  border-radius: 3px;
}

.resource-fill.low { 
  background: var(--color-critical); 
}

.resource-fill.medium { 
  background: var(--color-warning); 
}

.resource-fill.high { 
  background: var(--color-success); 
}

/* Safety Banner */
.safety-banner {
    background: #ffcc00; 
    color: #000; 
    padding: 10px 20px; 
    font-weight: bold;
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    border-bottom: 2px solid #000; 
    animation: slideDown 0.5s ease;
    flex-shrink: 0;
}

.safety-banner button { 
  background: #000; 
  color: #fff; 
  border: none; 
  padding: 5px 15px; 
  font-family: var(--font-mono); 
  cursor: pointer;
  font-weight: 700;
  transition: all 0.2s;
}

.safety-banner button:hover {
  opacity: 0.8;
}


.zen-sidebar.active {
  transform: translateX(0);
}

.sidebar-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background: #f0f0f0;
  border-bottom: 2px solid var(--border-dark);
  flex-shrink: 0;
}

.sb-title {
  font-weight: 900;
  font-size: 1.1rem;
  letter-spacing: 2px;
  color: var(--text-primary);
}

.sb-close {
  background: none;
  border: none;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  color: var(--text-primary);
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.sb-close:hover {
  background: var(--text-primary);
  color: #fff;
}

.sb-profile {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 20px;
  border-bottom: 1px solid var(--border-light);
  background: #f8f8f8;
  flex-shrink: 0;
}

.sb-avatar {
  width: 40px;
  height: 40px;
  background: var(--text-primary);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  font-weight: 700;
  font-size: 1.1rem;
  flex-shrink: 0;
}

.sb-info {
  flex: 1;
  min-width: 0;
}

.sb-name {
  font-weight: 700;
  font-size: 0.95rem;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.sb-role {
  font-size: 0.75rem;
  color: var(--text-tertiary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.sb-nav-list {
  list-style: none;
  padding: 0;
  margin: 0;
  flex: 1;
  overflow-y: auto;
}

.sb-nav-list li {
  padding: 16px 20px;
  cursor: pointer;
  font-family: var(--font-header);
  font-weight: 700;
  font-size: 0.95rem;
  border-bottom: 1px solid var(--border-light);
  transition: all 0.2s;
  display: flex;
  align-items: center;
  color: var(--text-secondary);
}

.sb-nav-list li:hover {
  background: var(--text-primary);
  color: #fff;
}

.sb-nav-list li.divider {
  height: 1px;
  background: var(--border-light);
  cursor: default;
  padding: 0;
  border: none;
}

.nav-num {
  font-family: var(--font-mono);
  font-size: 0.8rem;
  color: var(--text-tertiary);
  margin-right: 10px;
  font-weight: 700;
}

.sb-footer {
  padding: 16px 20px;
  font-size: 0.75rem;
  color: var(--text-tertiary);
  text-align: center;
  border-top: 1px solid var(--border-light);
  background: #f8f8f8;
  flex-shrink: 0;
  line-height: 1.5;
  font-family: var(--font-mono);
  letter-spacing: 1px;
}

.zen-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(2px);
  z-index: 99998;
  display: none;
}

.zen-backdrop.active {
  display: block;
}

/* Animations */
@keyframes blink { 
  0% { opacity: 1; } 
  50% { opacity: 0.4; } 
  100% { opacity: 1; } 
}

@keyframes slideDown { 
  from { transform: translateY(-100%); } 
  to { transform: translateY(0); } 
}

/* å“åº”å¼ */
@media (max-width: 900px) { 
  .two-column-layout { 
    grid-template-columns: 1fr; 
  }
  
  .modal-body-grid { 
    grid-template-columns: 1fr; 
  } 
  
  .body-sidebar { 
    border-top: 1px solid #eee;
    border-right: none;
  } 
  
  .volunteer-status-panel { 
    flex-direction: column; 
    align-items: flex-start; 
    gap: 10px; 
  }

  .alert-item {
    grid-template-columns: 60px 50px 1fr 20px;
  }

  .alert-zone, .alert-time {
    display: none;
  }
}

@media (max-width: 600px) {
  .command-header {
    height: auto;
    flex-wrap: wrap;
    gap: 10px;
  }

  .logo-text {
    display: none;
  }

  .system-status {
    width: 100%;
    justify-content: flex-end;
  }

  .stats-row {
    grid-template-columns: 1fr 1fr;
  }

  .card-grid, .task-grid {
    grid-template-columns: 1fr;
  }

  .alert-item {
    grid-template-columns: 50px 1fr 20px;
  }

  .alert-priority, .alert-zone, .alert-time {
    display: none;
  }
}


</style>

<!-- ============================================================
     ä¸»å®¹å™¨ â€” å•ä¸€é¡¶å±‚åŒ…è£¹ (FIX 1: ç§»é™¤é‡å¤åµŒå¥—å®¹å™¨)
     ============================================================ -->
<div class="kokoro-volunteer-container">

    <!-- å®‰å…¨æ¨ªå¹… (FIX 2: åˆå¹¶ä¸ºä¸€ä¸ªï¼Œä½¿ç”¨ ng-if æ¡ä»¶ + é»˜è®¤æ¶ˆæ¯) -->
<div class="sys-alert-strip" ng-if="true"> <div class="alert-deco">/// SYSTEM_OVERRIDE ///</div>
    
    <div class="alert-body">
        <i class="fa fa-exclamation-triangle"></i> 
        <span class="alert-text">
            {{c.data.emergencyAlert || 'ç¾åœ¨ã€ä½™éœ‡è­¦å ±ç™ºä»¤ä¸­ã€‚å®‰å…¨ã‚’ç¢ºä¿ã—ã¦ãã ã•ã„ã€‚'}}
        </span>
    </div>

    <button class="sys-btn-ghost" ng-click="c.goToUserView()">
        [ USER_VIEW ]
    </button>
</div>

    <!-- å‘½ä»¤å¤´ -->
    <div class="command-header">
        <button class="hamburger-btn" ng-click="c.toggleSidebar()">
            <i class="fa fa-bars"></i>
        </button>
        <div class="command-logo">
            <div class="logo-icon">K</div>
            <div class="logo-text">
                <span class="logo-title">KOKORO</span>
                <span class="logo-subtitle">VOLUNTEER_INTERFACE</span>
            </div>
        </div>
        <div class="system-status">
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">SYS_ONLINE</span>
            </div>
            <span class="version-tag">v4.1.0-zenless</span>
            <span class="system-time">{{c.currentTime}}</span>
        </div>
    </div>

    <!-- å¯¼èˆªæ ‡ç­¾ -->
    <div class="nav-tabs-custom">
        <div class="tab" ng-class="{'active': c.view === 'dashboard'}" ng-click="c.view = 'dashboard'">
            <span class="tab-number">01</span> / OVERVIEW
        </div>
        <div class="tab" ng-class="{'active': c.view === 'tactical'}" ng-click="c.view = 'tactical'">
            <span class="tab-number">02</span> / TACTICAL
        </div>
        <div class="tab" ng-class="{'active': c.view === 'mine'}" ng-click="c.view = 'mine'">
            <span class="tab-number">03</span> / OPERATORS ({{c.data.myTasks.length || 0}})
        </div>
        <div class="tab" ng-class="{'active': c.view === 'requests'}" ng-click="c.view = 'requests'">
            <span class="tab-number">04</span> / MY REQUESTS ({{c.data.myRequests.length || 0}})
        </div>
    </div>

    <!-- æ‰«æçº¿å¤´ -->
    <div class="scan-line-header">
        <div class="scan-line"></div>
        <span class="scan-label">DISASTER_RESPONSE_SYSTEM</span>
        <div class="scan-line"></div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="board-container">

        <!-- ============================================================
             Dashboard / Tactical View
             ============================================================ -->
        <div class="view-dashboard" ng-if="c.view === 'dashboard' || c.view === 'tactical'">

            <!-- å¿—æ„¿è€…çŠ¶æ€é¢æ¿ -->
            <div class="volunteer-status-panel" ng-if="c.data.isVolunteer">
                <div class="status-row">
                    <i class="fa fa-power-off"></i>
                    <span>çŠ¶æ…‹:</span>
                    <button ng-click="c.toggleAvailability()" 
                            ng-class="{'btn-online': c.volunteerStatus.isOnline, 'btn-offline': !c.volunteerStatus.isOnline}">
                        {{c.volunteerStatus.isOnline ? 'ONLINE' : 'OFFLINE'}}
                    </button>
                </div>
                <div class="status-row">
                    <i class="fa fa-map-pin"></i>
                    <span>ç¾åœ¨åœ°:</span>
                    <select ng-model="c.volunteerStatus.currentZone" ng-change="c.updateMyLocation(c.volunteerStatus.currentZone)">
                        <option value="">-- SELECT ZONE --</option>
                        <option value="Family Area">FAMILY_AREA</option>
                        <option value="Single Area">SINGLE_AREA</option>
                        <option value="Medical Area">MEDICAL_AREA</option>
                        <option value="Staff Room">STAFF_ROOM</option>
                    </select>
                </div>
            </div>

            <div class="metal-divider"></div>

            <!-- ç»Ÿè®¡éƒ¨åˆ† -->
            <div class="stats-section">
                <div class="section-header">
                    <span class="section-tag">01</span>
                    <span class="section-title">METRICS_OVERVIEW</span>
                    <span class="section-time">{{c.currentTime}}</span>
                </div>

                <div class="stats-row">
                    <div class="stat-card clickable" ng-click="c.filterByUrgency('Critical')">
                        <div class="stat-label"><span class="stat-code">REQ</span><span class="stat-suffix">_01</span></div>
                        <div class="stat-num">{{c.data.sosCount || 0}}</div>
                        <div class="stat-name">CRITICAL_SOS</div>
                        <div class="stat-footer">
                            <span class="stat-change" ng-class="{'negative': c.data.sosCount > 0, 'positive': c.data.sosCount === 0}">
                                {{c.data.sosCount > 0 ? 'URGENT' : 'CLEAR'}}
                            </span>
                            <span class="stat-status" ng-class="{'critical': c.data.sosCount > 0, 'nominal': c.data.sosCount === 0}">
                                {{c.data.sosCount > 0 ? 'ALERT' : 'NOMINAL'}}
                            </span>
                        </div>
                    </div>

                    <div class="stat-card clickable" ng-click="c.filterByAssignment('unassigned')">
                        <div class="stat-label"><span class="stat-code">OPN</span><span class="stat-suffix">_02</span></div>
                        <div class="stat-num">{{c.data.openCount || 0}}</div>
                        <div class="stat-name">UNASSIGNED</div>
                        <div class="stat-footer">
                            <span class="stat-change" ng-class="{'negative': c.data.openCount > 5, 'positive': c.data.openCount <= 5}">
                                {{c.data.openCount > 5 ? 'HIGH' : 'NOMINAL'}}
                            </span>
                            <span class="stat-status" ng-class="{'warning': c.data.openCount > 5, 'nominal': c.data.openCount <= 5}">
                                {{c.data.openCount > 5 ? 'BACKLOG' : 'NOMINAL'}}
                            </span>
                        </div>
                    </div>

                    <div class="stat-card clickable" ng-click="c.clearFilters()">
                        <div class="stat-label"><span class="stat-code">TOT</span><span class="stat-suffix">_03</span></div>
                        <div class="stat-num">{{c.data.list.length || 0}}</div>
                        <div class="stat-name">TOTAL_ACTIVE</div>
                        <div class="stat-footer">
                            <span class="stat-change positive">TRACKED</span>
                            <span class="stat-status nominal">NOMINAL</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label"><span class="stat-code">OPR</span><span class="stat-suffix">_04</span></div>
                        <div class="stat-num">{{c.data.volunteers.length || '--'}}</div>
                        <div class="stat-name">OPERATORS</div>
                        <div class="stat-footer">
                            <span class="stat-change positive">ONLINE</span>
                            <span class="stat-status nominal">NOMINAL</span>
                        </div>
                    </div>

                    <div class="stat-card" ng-if="c.slaStats">
                        <div class="stat-label"><span class="stat-code">SLA</span><span class="stat-suffix">_05</span></div>
                        <div class="stat-num" ng-style="{'color': c.slaStats.breached > 0 ? '#ff4444' : '#34c759'}">
                            {{c.slaStats.breached || 0}}
                        </div>
                        <div class="stat-name">BREACHED</div>
                        <div class="stat-footer">
                            <span class="stat-change" ng-class="{'negative': c.slaStats.atRisk > 0, 'positive': !c.slaStats.atRisk}">
                                {{c.slaStats.atRisk || 0}} AT_RISK
                            </span>
                            <span class="stat-status" ng-class="{'critical': c.slaStats.breached > 0, 'warning': c.slaStats.atRisk > 0, 'nominal': !c.slaStats.breached && !c.slaStats.atRisk}">
                                {{c.slaStats.breached > 0 ? 'ALERT' : 'OK'}}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="metal-divider-glow"></div>

            <!-- ä¸¤åˆ—å¸ƒå±€ -->
            <div class="two-column-layout">

                <!-- å‘Šè­¦åˆ—è¡¨ -->
                <div class="alert-section">
                    <div class="section-header">
                        <span class="section-tag">02</span>
                        <span class="section-title">ALERT_FEED</span>
                        <span class="section-tag" style="margin-left:auto; background:var(--border-mid); box-shadow:none;">
                            {{(c.filteredList || c.data.list).length}}
                        </span>
                    </div>

                    <div class="alert-list">
                        <div class="alert-item" 
                             ng-class="'priority-' + item.urgency" 
                             ng-repeat="item in (c.filteredList || c.data.list) | limitTo:20" 
                             ng-click="c.openModal(item)">
                            <span class="alert-id">{{item.number | limitTo:12}}</span>
                            <span class="alert-priority" 
                                  ng-class="{'p-critical': item.urgency === 'Critical', 'p-high': item.urgency === 'High', 'p-medium': item.urgency === 'Medium', 'p-low': item.urgency === 'Low'}">
                                P{{item.urgency === 'Critical' ? '1' : item.urgency === 'High' ? '2' : item.urgency === 'Medium' ? '3' : '4'}}
                            </span>
                            <span class="alert-zone">{{item.zone | limitTo:8}}</span>
                            <span class="alert-time">{{item.time_24h || item.time_ago}}</span>
                            <span class="alert-content">{{c.dict[item.category] || item.category}} x{{item.quantity}} - {{item.detail_loc | limitTo:25}}</span>
                            <span class="alert-arrow">â†’</span>
                        </div>
                        <div class="empty-board" ng-if="!(c.filteredList || c.data.list) || (c.filteredList || c.data.list).length === 0">
                            <i class="fa fa-check-circle"></i>
                            <h4>ALL_CLEAR</h4>
                            <p>ç¾åœ¨ã€å¾…æ©Ÿä¸­ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
                        </div>
                    </div>
                </div>

                <!-- ä¾§é¢æ¿ -->
                <div class="side-panel-wrapper">
                    <div class="data-stream-widget">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fa fa-chart-line"></i> REALTIME_ANALYSIS
                            </div>
                            <div class="live-indicator"></div>
                        </div>
                        <div class="live-metric-card">
                            <div class="metric-row">
                                <span class="metric-label">å¿œç­”ç‡</span>
                                <span class="metric-value">94%</span>
                            </div>
                            <div class="metric-mini-bar">
                                <div class="metric-mini-fill" style="width: 94%"></div>
                            </div>
                        </div>
                        <div class="live-metric-card">
                            <div class="metric-row">
                                <span class="metric-label">å¾…æ©Ÿã‚¿ã‚¹ã‚¯</span>
                                <span class="metric-value">{{c.data.openCount || 0}}</span>
                            </div>
                            <div class="metric-mini-bar">
                                <div class="metric-mini-fill" style="width: 78%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="metal-divider"></div>

                    <div class="ai-insight-card">
                        <div class="ai-header">
                            <i class="fa fa-robot"></i> AI_INSIGHT
                        </div>
                        <div class="ai-content">
                            é…é€åŠ¹ç‡ã¯å…ˆé€±æ¯”ã§<strong>+12%</strong>å‘ä¸Šã€‚éœ€è¦ã®ãƒ”ãƒ¼ã‚¯ã¯<strong>18æ™‚ã€œ20æ™‚</strong>ã«é›†ä¸­ã—ã¦ã„ã¾ã™ã€‚
                        </div>
                        <div class="ai-tags">
                            <span class="ai-tag">EFFICIENCY</span>
                            <span class="ai-tag">FORECAST</span>
                            <span class="ai-tag">OPTIMIZED</span>
                        </div>
                    </div>

                    <div class="resource-section-enhanced">
                        <div class="section-header">
                            <span class="section-tag">03</span>
                            <span class="section-title">RESOURCE_STATUS</span>
                        </div>
                        <div class="resource-item">
                            <div class="resource-header">
                                <div class="label"><span class="code">[FOOD]</span> é£Ÿæ–™</div>
                                <span class="percent">{{c.data.resourceStatus[0].percent || 42}}%</span>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill" 
                                     ng-class="{'low': (c.data.resourceStatus[0].percent || 42) < 30, 'medium': (c.data.resourceStatus[0].percent || 42) >= 30 && (c.data.resourceStatus[0].percent || 42) < 60, 'high': (c.data.resourceStatus[0].percent || 42) >= 60}" 
                                     ng-style="{width: (c.data.resourceStatus[0].percent || 42) + '%'}"></div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-header">
                                <div class="label"><span class="code">[WATR]</span> é£²æ–™æ°´</div>
                                <span class="percent">{{c.data.resourceStatus[1].percent || 78}}%</span>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill" 
                                     ng-class="{'low': (c.data.resourceStatus[1].percent || 78) < 30, 'medium': (c.data.resourceStatus[1].percent || 78) >= 30 && (c.data.resourceStatus[1].percent || 78) < 60, 'high': (c.data.resourceStatus[1].percent || 78) >= 60}" 
                                     ng-style="{width: (c.data.resourceStatus[1].percent || 78) + '%'}"></div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-header">
                                <div class="label"><span class="code">[MEDI]</span> åŒ»ç™‚å“</div>
                                <span class="percent">{{c.data.resourceStatus[2].percent || 12}}%</span>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill" 
                                     ng-class="{'low': (c.data.resourceStatus[2].percent || 12) < 30, 'medium': (c.data.resourceStatus[2].percent || 12) >= 30 && (c.data.resourceStatus[2].percent || 12) < 60, 'high': (c.data.resourceStatus[2].percent || 12) >= 60}" 
                                     ng-style="{width: (c.data.resourceStatus[2].percent || 12) + '%'}"></div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-header">
                                <div class="label"><span class="code">[CLTH]</span> è¡£é¡</div>
                                <span class="percent">{{c.data.resourceStatus[3].percent || 89}}%</span>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill" 
                                     ng-class="{'low': (c.data.resourceStatus[3].percent || 89) < 30, 'medium': (c.data.resourceStatus[3].percent || 89) >= 30 && (c.data.resourceStatus[3].percent || 89) < 60, 'high': (c.data.resourceStatus[3].percent || 89) >= 60}" 
                                     ng-style="{width: (c.data.resourceStatus[3].percent || 89) + '%'}"></div>
                            </div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-header">
                                <div class="label"><span class="code">[HYGN]</span> è¡›ç”Ÿç”¨å“</div>
                                <span class="percent">{{c.data.resourceStatus[4].percent || 34}}%</span>
                            </div>
                            <div class="resource-bar">
                                <div class="resource-fill" 
                                     ng-class="{'low': (c.data.resourceStatus[4].percent || 34) < 30, 'medium': (c.data.resourceStatus[4].percent || 34) >= 30 && (c.data.resourceStatus[4].percent || 34) < 60, 'high': (c.data.resourceStatus[4].percent || 34) >= 60}" 
                                     ng-style="{width: (c.data.resourceStatus[4].percent || 34) + '%'}"></div>
                            </div>
                        </div>
                    </div>
                    <!-- END: resource-section-enhanced -->

                    <!-- ============================================================
                         [DAY 5] PROCESS MINING & MONITORING PANEL
                         æ’å…¥ä½ç½®: side-panel-wrapper å†…éƒ¨ï¼Œresource-section-enhanced ä¹‹å
                         ============================================================ -->
                    <div class="monitoring-panel" ng-if="c.data.processMiningStats">
                        <div class="section-header" style="padding: 0 0 15px 0; margin-bottom: 15px;">
                            <span class="section-tag">PM</span>
                            <span class="section-title">PROCESS_MINING</span>
                        </div>
                        
                        <!-- å¥åº·è¯„åˆ†ä»ªè¡¨ -->
                        <div class="health-gauge">
                            <div class="gauge-circle" ng-class="c.getHealthStatusDisplay().class">
                                <div class="gauge-value">{{c.data.overallHealth.score}}</div>
                                <div class="gauge-label">HEALTH</div>
                            </div>
                            <div class="gauge-info">
                                <div class="gauge-status" ng-style="{color: c.getHealthStatusDisplay().color}">
                                    {{c.getHealthStatusDisplay().text}}
                                </div>
                                <div class="gauge-components">
                                    <span ng-repeat="comp in c.data.overallHealth.components" 
                                          ng-style="{color: c.getComponentColor(comp.score)}">
                                        {{comp.name}}: {{comp.score}}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metal-divider"></div>
                        
                        <!-- Process Mining æŒ‡æ ‡ -->
                        <div class="pm-metrics">
                            <div class="pm-metric-item">
                                <div class="pm-metric-label">TOTAL_EVENTS</div>
                                <div class="pm-metric-value">{{c.data.processMiningStats.totalEvents}}</div>
                            </div>
                            <div class="pm-metric-item">
                                <div class="pm-metric-label">TODAY</div>
                                <div class="pm-metric-value">{{c.data.processMiningStats.todayEvents}}</div>
                            </div>
                            <div class="pm-metric-item">
                                <div class="pm-metric-label">CASES</div>
                                <div class="pm-metric-value">{{c.data.processMiningStats.uniqueCases}}</div>
                            </div>
                        </div>
                        
                        <!-- æ´»åŠ¨åˆ†å¸ƒ -->
                        <div class="activity-distribution" ng-if="c.data.processMiningStats.topActivities.length > 0">
                            <div class="dist-title">TOP_ACTIVITIES</div>
                            <div class="dist-item" ng-repeat="act in c.data.processMiningStats.topActivities">
                                <i class="fa" ng-class="c.getActivityIcon(act.name)"></i>
                                <span class="dist-name">{{c.formatActivityName(act.name)}}</span>
                                <span class="dist-count">{{act.count}}</span>
                            </div>
                        </div>
                        
                        <!-- æ— æ•°æ®æç¤º -->
                        <div class="no-data-hint" ng-if="c.data.processMiningStats.topActivities.length === 0">
                            <i class="fa fa-info-circle"></i>
                            <span>ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</span>
                        </div>
                        
                        <div class="metal-divider"></div>
                        
                        <!-- SLA & å‘Šè­¦çŠ¶æ€ -->
                        <div class="alert-summary">
                            <div class="alert-row" ng-class="{'critical': c.data.slaStats.breached > 0}">
                                <i class="fa fa-exclamation-triangle"></i>
                                <span>SLA_BREACHED</span>
                                <span class="alert-count">{{c.data.slaStats.breached || 0}}</span>
                            </div>
                            <div class="alert-row" ng-class="{'warning': c.data.slaStats.atRisk > 0}">
                                <i class="fa fa-clock-o"></i>
                                <span>AT_RISK</span>
                                <span class="alert-count">{{c.data.slaStats.atRisk || 0}}</span>
                            </div>
                            <div class="alert-row">
                                <i class="fa fa-file-text-o"></i>
                                <span>AUDIT_TODAY</span>
                                <span class="alert-count">{{c.data.auditStats.todayLogs || 0}}</span>
                            </div>
                        </div>
                        
                        <!-- æœ€è¿‘å®¡è®¡æ“ä½œ -->
                        <div class="recent-audit" ng-if="c.data.auditStats.recentActions.length > 0">
                            <div class="dist-title">RECENT_ACTIONS</div>
                            <div class="audit-item" ng-repeat="action in c.data.auditStats.recentActions | limitTo:3">
                                <span class="audit-action">{{action.action}}</span>
                                <span class="audit-user">{{action.user}}</span>
                            </div>
                        </div>
                        
                        <!-- åˆ·æ–°æŒ‰é’® -->
                        <button class="refresh-btn" ng-click="c.refreshMonitoringData()">
                            <i class="fa fa-refresh"></i> REFRESH_DATA
                        </button>
                    </div>
                    <!-- ============================================================
                         [END OF DAY 5 MONITORING PANEL]
                         ============================================================ -->

                </div>
                <!-- END: side-panel-wrapper -->
            </div>
            <!-- END: two-column-layout -->

            <!-- Tactical Card Grid (ä»…åœ¨ tactical æ ‡ç­¾æ¿€æ´»æ—¶æ˜¾ç¤º) -->
            <div class="card-section" ng-if="c.view === 'tactical'">
                <div class="metal-divider-glow"></div>
                <div class="section-header">
                    <span class="section-tag">04</span>
                    <span class="section-title">REQUEST_GRID</span>
                    <span class="section-tag" style="margin-left:auto; background:var(--border-mid); box-shadow:none;">
                        {{(c.filteredList || c.data.list).length}} ITEMS
                    </span>
                </div>
                <div class="card-grid">
                    <div class="jira-card" 
                         ng-class="'priority-' + item.urgency" 
                         ng-repeat="item in (c.filteredList || c.data.list)" 
                         ng-click="c.openModal(item)">
                        <div class="card-top">
                            <span class="card-id">{{item.number}}</span>
                            <span class="status-tag" ng-class="'status-' + item.state">
                                {{c.statusNames[item.state] || item.state_label || 'OPEN'}}
                            </span>
                        </div>
                        <div class="card-title">
                            {{c.dict[item.category] || item.category_display || item.category}}
                            <span class="qty-badge">x{{item.quantity}}</span>
                        </div>
                        <div class="card-loc">
                            <i class="fa fa-map-marker"></i> {{item.zone}} - {{item.detail_loc | limitTo:20}}
                        </div>
                        <div class="card-detail" ng-if="item.remarks">
                            {{item.remarks | limitTo:50}}...
                        </div>
                      <div class="card-sla" ng-if="item.sla">
                            ...
                        </div>

                        <div class="card-sla" ng-if="item.sla && item.state != 4 && item.state != 5">
                            <div class="sla-bar-container">
                                <div class="sla-bar" 
                                     ng-style="{width: item.sla.percentage + '%', background: c.getSLABarColor(item.sla)}"></div>
                            </div>
                            <div class="sla-info" ng-class="c.getSLAClass(item.sla)">
                                <span>{{item.sla.percentage}}%</span>
                                <span class="sla-remaining">
                                    <i class="fa" ng-class="{'fa-clock-o': !item.sla.is_breached, 'fa-exclamation-triangle': item.sla.is_breached}"></i> 
                                    {{c.formatSLARemaining(item.sla.remaining)}}
                                </span>
                            </div>
                        </div>

                        <div class="brawl-max-badge" ng-if="item.state == 4">
                            <span class="brawl-text"><i class="fa fa-trophy brawl-icon"></i> MISSION COMPLETE</span>
                        </div>
                        
                         <div class="brawl-max-badge" ng-if="item.state == 5" style="border-color: #666; background-image: none; background: #333;">
                            <span class="brawl-text" style="background: none; -webkit-text-fill-color: #999;">CANCELLED</span>
                        </div>
                     
                        <div class="metal-divider"></div>
                        <div class="card-footer">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span class="priority-badge" ng-class="'priority-' + item.urgency">
                                    {{c.dict[item.urgency] || item.urgency}}
                                </span>
                                <span style="color:var(--text-tertiary); font-family:var(--font-mono); font-size:12px;">
                                    {{item.time_24h || item.time_ago}}
                                </span>
                            </div>
                            <div style="margin-top:12px; color:var(--text-secondary); font-size:14px;">
                                <i class="fa fa-user"></i> {{item.assigned_to_name || 'UNASSIGNED'}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="empty-board" ng-if="!(c.filteredList || c.data.list) || (c.filteredList || c.data.list).length === 0">
                    <i class="fa fa-check-circle"></i>
                    <h4>ALL_CLEAR</h4>
                    <p>ç¾åœ¨ã€å¾…æ©Ÿä¸­ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>
        </div>
        <!-- END: view-dashboard -->

        <!-- ============================================================
             My Operations View (FIX 5: æ­£ç¡®æ”¾ç½®åœ¨ board-container å†…éƒ¨)
             ============================================================ -->
        <div class="view-mine" ng-if="c.view === 'mine'">
            <div class="card-section">
                <div class="section-header">
                    <span class="section-tag">03</span>
                    <span class="section-title">MY_OPERATIONS</span>
                    <span class="section-tag" style="margin-left:auto; background:var(--border-mid); box-shadow:none;">
                        {{c.data.myTasks.length}} ACTIVE
                    </span>
                </div>
                <div class="task-grid">
                    <div class="jira-card" 
                         ng-class="'priority-' + task.urgency" 
                         ng-repeat="task in c.data.myTasks" 
                         ng-click="c.openModal(task)">
                        <div class="card-top">
                            <span class="card-id">{{task.number}}</span>
                            <span class="status-tag" ng-class="'status-' + task.state">
                                {{c.statusNames[task.state] || task.state_label}}
                            </span>
                        </div>
                        <div class="card-title">
                            {{c.dict[task.category] || task.category}}
                            <span class="qty-badge">x{{task.quantity}}</span>
                        </div>
                        <div class="card-loc">
                            <i class="fa fa-map-marker"></i> {{task.zone || c.dict[task.location] || task.location}}
                        </div>
                        <div class="card-detail">
                            {{task.detail_loc || 'NO_DETAIL'}}
                        </div>
                        <div class="card-sla" ng-if="task.sla">
                            <div class="sla-bar-container">
                                <div class="sla-bar" 
                                     ng-style="{width: task.sla.percentage + '%', background: c.getSLABarColor(task.sla)}"></div>
                            </div>
                            <div class="sla-info" ng-class="c.getSLAClass(task.sla)">
                                <span>{{task.sla.percentage}}%</span>
                                <span class="sla-remaining">
                                    <i class="fa" ng-class="{'fa-clock-o': !task.sla.is_breached, 'fa-exclamation-triangle': task.sla.is_breached}"></i> 
                                    {{c.formatSLARemaining(task.sla.remaining)}}
                                </span>
                            </div>
                        </div>
                        <div class="metal-divider"></div>
                        <div class="card-footer">
                            <button class="btn-jira progress" 
                                    ng-if="task.state == 11" 
                                    ng-click="$event.stopPropagation(); c.updateStatus(task.sys_id, 'start')">
                                <i class="fa fa-play"></i> START_DELIVERY
                            </button>
                            <button class="btn-jira success" 
                                    ng-if="task.state == 2" 
                                    ng-click="$event.stopPropagation(); c.updateStatus(task.sys_id, 'complete')">
                                <i class="fa fa-check"></i> MARK_COMPLETE
                            </button>
                            <div class="completed-msg" ng-if="task.state == 4">
                                <i class="fa fa-check-circle"></i> COMPLETED - VIEW_DETAILS
                            </div>
                        </div>
                    </div>
                    <div class="empty-board" ng-if="!c.data.myTasks || c.data.myTasks.length === 0" style="grid-column: 1 / -1;">
                        <i class="fa fa-inbox"></i>
                        <h4>NO_ACTIVE_OPERATIONS</h4>
                        <p>OVERVIEWã‚¿ãƒ–ã‹ã‚‰ã‚¿ã‚¹ã‚¯ã‚’å–å¾—ã—ã¦ãã ã•ã„</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- END: view-mine -->

        <!-- ============================================================
             My Requests View (FIX 5: æ­£ç¡®æ”¾ç½®åœ¨ board-container å†…éƒ¨)
             ============================================================ -->
        <div class="view-requests" ng-if="c.view === 'requests'">
            <div class="card-section">
                <div class="section-header">
                    <span class="section-tag">04</span>
                    <span class="section-title">MY SUBMISSIONS</span>
                    <span class="section-tag" style="margin-left:auto; background:var(--border-mid); box-shadow:none;">
                        {{c.data.myRequests.length}} TRACKING
                    </span>
                </div>
                <div class="task-grid">
                    <div class="jira-card" 
                         ng-class="'priority-' + item.urgency" 
                         ng-repeat="item in c.data.myRequests" 
                         ng-click="c.openModal(item)">
                        <div class="card-top">
                            <span class="card-id">{{item.number}}</span>
                            <span class="status-tag" ng-class="'status-' + item.state">
                                {{c.statusNames[item.state] || item.state_label || 'OPEN'}}
                            </span>
                        </div>
                        <div class="card-title">
                            {{c.dict[item.category] || item.category_display || item.category}}
                            <span class="qty-badge">x{{item.quantity}}</span>
                        </div>
                        <div class="card-loc">
                            <i class="fa fa-map-marker"></i> {{item.zone}} - {{item.detail_loc | limitTo:20}}
                        </div>
                        <div class="card-detail" ng-if="item.remarks">
                            {{item.remarks | limitTo:50}}...
                        </div>
                        <div class="card-sla" ng-if="item.sla">
                            <div class="sla-bar-container">
                                <div class="sla-bar" 
                                     ng-style="{width: item.sla.percentage + '%', background: c.getSLABarColor(item.sla)}"></div>
                            </div>
                            <div class="sla-info" ng-class="c.getSLAClass(item.sla)">
                                <span>{{item.sla.percentage}}%</span>
                                <span class="sla-remaining">
                                    <i class="fa" ng-class="{'fa-clock-o': !item.sla.is_breached, 'fa-exclamation-triangle': item.sla.is_breached}"></i> 
                                    {{c.formatSLARemaining(item.sla.remaining)}}
                                </span>
                            </div>
                        </div>
                        <div class="metal-divider"></div>
                        <div class="card-footer">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span class="priority-badge" ng-class="'priority-' + item.urgency">
                                    {{c.dict[item.urgency] || item.urgency}}
                                </span>
                                <span style="color:var(--text-tertiary); font-family:var(--font-mono); font-size:12px;">
                                    {{item.time_24h || item.time_ago}}
                                </span>
                            </div>
                            <div style="margin-top:12px; color:var(--text-secondary); font-size:14px;">
                                <i class="fa fa-user"></i> {{item.assigned_to_name || 'UNASSIGNED'}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="empty-board" ng-if="!c.data.myRequests || c.data.myRequests.length === 0">
                    <i class="fa fa-paper-plane"></i>
                    <h4>NO REQUESTS</h4>
                    <p>ã‚ãªãŸãŒæå‡ºã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>
        </div>
        <!-- END: view-requests -->

    </div>
    <!-- END: board-container -->

</div>
<!-- END: kokoro-volunteer-container -->

<div class="zen-sidebar" ng-class="{'active': c.showSidebar}">
    <div class="sidebar-head">
        <span class="sb-title">SYSTEM_NAV</span>
        <button class="sb-close" ng-click="c.toggleSidebar()">Ã—</button>
    </div>

    <div class="sb-profile">
        <div class="sb-avatar">{{c.data.user_name.charAt(0)}}</div>
        <div class="sb-info">
            <div class="sb-name">{{c.data.user_name}}</div>
            <div class="sb-role">VOLUNTEER_ID: {{c.data.user_id.substring(0,8)}}</div>
        </div>
    </div>

    <ul class="sb-nav-list">
        <li ng-click="c.view = 'dashboard'; c.toggleSidebar()">
            <span class="nav-num">01</span> OVERVIEW
        </li>
        <li ng-click="c.view = 'tactical'; c.toggleSidebar()">
            <span class="nav-num">02</span> TACTICAL GRID
        </li>
        <li ng-click="c.view = 'mine'; c.toggleSidebar()">
            <span class="nav-num">03</span> MY OPERATIONS
        </li>
        <li ng-click="c.view = 'requests'; c.toggleSidebar()">
            <span class="nav-num">04</span> MY REQUESTS
        </li>
        <li class="divider"></li>
        <li><span class="nav-num">05</span> SYSTEM SETTINGS</li>
        <li><span class="nav-num">06</span> LOGOUT</li>
    </ul>

    <div class="sb-footer">
        KOKORO OS v4.1 <br> AUTHORIZED ACCESS ONLY
    </div>
</div>

<div class="zen-backdrop" ng-class="{'active': c.showSidebar}" ng-click="c.toggleSidebar()"></div>

<script type="text/ng-template" id="volunteerModalTemplate">
<div class="modal-content kokoro-modal-window">
  
  <div class="modal-header-clean">
    <div class="header-left">
      <span class="header-badge"><i class="fa fa-truck"></i> RESCUE_REQUEST</span>
      <span class="header-id">{{item.number}}</span>
    </div>
    <button class="header-close" ng-click="cancel()"><i class="fa fa-times"></i></button>
  </div>

  <div class="modal-body-grid">
    
    <div class="body-main">
      <h2 class="ticket-title">
          {{c.dict[item.category] || item.category}} - æ•‘æ´è¦è«‹
          <span class="qty-badge-black">x{{item.quantity}}</span>
      </h2>
      
      <div class="action-bar">
        <div class="dropdown-wrapper">
          <button class="btn-purple-outline" ng-click="toggleStatusMenu($event)">
             {{c.statusNames[item.state] || 'OPEN'}} <i class="fa fa-chevron-down"></i>
          </button>
          <div class="status-menu" ng-show="statusMenuOpen">
            <div class="status-item" ng-click="changeStatus(item, '11')" ng-if="item.state != 11 && item.state != 4"><i class="fa fa-user-plus"></i> ASSIGNED</div>
            <div class="status-item" ng-click="changeStatus(item, '2')" ng-if="item.state == 11"><i class="fa fa-bicycle"></i> IN_PROGRESS</div>
            <div class="status-item" ng-click="changeStatus(item, '4')" ng-if="item.state == 2"><i class="fa fa-check"></i> COMPLETED</div>
            <div class="status-item danger" ng-click="changeStatus(item, '5')"><i class="fa fa-ban"></i> CANCELLED</div>
          </div>
        </div>
        
        <button class="btn-normal" ng-click="assignToMe(item)" ng-if="item.state != 4">
            <i class="fa fa-user"></i> {{item.assigned_to_name ? 'REASSIGN' : 'ASSIGN_TO_ME'}}
        </button>
        
        <button class="action-btn" ng-click="triggerAutoAssign(item)" ng-if="!item.assigned_to_id">
            <i class="fa fa-magic"></i> AUTO_ASSIGN
        </button>
        <button class="action-btn" ng-click="triggerAutoAssign(item)" ng-if="item.assigned_to_id">
            <i class="fa fa-refresh"></i> REASSIGN
        </button>
      </div>

      <div class="desc-box">
        <div class="desc-section-title"><i class="fa fa-align-left"></i> DESCRIPTION</div>
        <div class="desc-grid">
          <div class="desc-item">
              <div class="desc-icon"><i class="fa fa-map-marker"></i></div>
              <div><span class="desc-label">LOCATION:</span> {{item.zone}} - {{item.detail_loc}}</div>
          </div>
          <div class="desc-item">
              <div class="desc-icon"><i class="fa fa-cube"></i></div>
              <div><span class="desc-label">TYPE:</span> {{c.dict[item.category] || item.category}} x {{item.quantity}}</div>
          </div>
          <div class="desc-item">
              <div class="desc-icon"><i class="fa fa-users"></i></div>
              <div><span class="desc-label">AFFECTED:</span> {{item.affected_count || 'ä¸æ˜'}}</div>
          </div>
          <div class="desc-item" ng-if="item.remarks">
              <div class="desc-icon"><i class="fa fa-info-circle"></i></div>
              <div><span class="desc-label">NOTES:</span> {{item.remarks}}</div>
          </div>
        </div>
      </div>

      <div class="metal-divider"></div>

      <div class="activity-area">
        <div class="desc-section-title"><i class="fa fa-comments-o"></i> ACTIVITY_LOG</div>
        
        <div class="input-wrapper">
            <textarea class="note-input" 
                      ng-model="newComment" 
                      placeholder="Type an internal note..."
                      ng-keydown="$event.ctrlKey && $event.keyCode === 13 && postComment(item)"></textarea>
            <div class="input-footer">
                <button class="submit-btn" 
                        ng-class="{'ready': newComment}" 
                        ng-click="postComment(item)">
                    <i class="fa fa-paper-plane"></i> SUBMIT_LOG
                </button>
            </div>
        </div>

        <div class="history-list">
            <div ng-repeat="h in item.history track by $index">
                <div class="log-item type-user" ng-if="!h.text.startsWith('[SLA')">
                    <div class="log-header">
                        <div class="log-user"><i class="fa fa-user-circle-o" style="color:var(--accent-primary);"></i> {{h.user}}</div>
                        <span class="log-time">{{h.date}}</span>
                    </div>
                    <div class="log-body">{{h.text}}</div>
                </div>
                <div class="log-item type-system" ng-if="h.text.startsWith('[SLA')">
                    <div class="sys-terminal-box" 
                         ng-class="{'sla-breach': h.text.indexOf('é•å') !== -1 || h.text.indexOf('breached') !== -1, 'sla-warning': h.text.indexOf('è­¦å‘Š') !== -1 || h.text.indexOf('risk') !== -1}">
                        <div class="sys-meta-row"><span><i class="fa fa-terminal"></i> SYSTEM_KERNEL</span><span>{{h.date}}</span></div>
                        <div class="sys-content">
                            <span ng-if="h.text.indexOf('é•å') !== -1 || h.text.indexOf('breached') !== -1"><strong>[CRITICAL_FAILURE]</strong> </span>
                            <span ng-if="h.text.indexOf('è­¦å‘Š') !== -1 || h.text.indexOf('risk') !== -1"><strong>[WARNING_ALERT]</strong> </span>
                            {{h.text}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>

    </div>

    <div class="body-sidebar">
      
      <div class="sidebar-block">
          <div class="sb-label">STATUS</div>
          <div class="state-indicator" style="background:#000; color:#fff;">{{c.getStateInfo(item.state).name}}</div>
      </div>

      <div class="sidebar-block">
          <div class="sb-label">ASSIGNEE</div>
          <div class="user-row" ng-if="item.assigned_to_name">
              <div class="avatar-box">{{item.assigned_to_name.charAt(0)}}</div>
              <div class="user-name-text">{{item.assigned_to_name}}</div>
          </div>
          <div class="user-row" ng-if="!item.assigned_to_name">
              <div class="avatar-box grey">?</div>
              <div class="user-name-text" style="color:#999;">UNASSIGNED</div>
          </div>
      </div>

      <div class="sidebar-block">
          <div class="sb-label">REPORTER</div>
          <div class="user-row">
              <div class="avatar-box orange">{{item.reporter_name.charAt(0) || '?'}}</div>
              <div class="user-name-text">{{item.reporter_name || 'System'}}</div>
          </div>
      </div>

      <div class="sidebar-block">
          <div class="sb-label">PRIORITY</div>
          <div class="priority-btn"><i class="fa fa-arrow-right"></i> {{c.dict[item.urgency] || item.urgency}}</div>
      </div>

      <div class="sidebar-block">
          <div class="sb-label">LOCATION</div>
          <div style="font-weight:800; color:var(--text-primary); font-size:16px;">
              <i class="fa fa-map-marker" style="color:var(--color-critical); margin-right:10px;"></i>{{item.zone}}
          </div>
          <div style="font-size:14px; color:var(--text-tertiary); margin-top:8px;">{{item.detail_loc}}</div>
      </div>

      <div class="ai-card">
         <div class="ai-head"><i class="fa fa-magic"></i> AI_ANALYSIS</div>
         <div class="ai-text">Standard response required. ETA: 30 mins.</div>
      </div>

      <div class="sidebar-block" ng-if="item.sla && item.state != 4 && item.state != 5">
        <div class="sb-label">SLA_TRACKING</div>
        <div class="sla-progress">
            <div class="sla-fill" ng-style="{width: item.sla.percentage + '%', background: c.getSLABarColor(item.sla)}"></div>
        </div>
        <div class="sla-text">
            <span>ELAPSED: {{c.formatHours(item.sla.elapsed)}}</span>
            <span>REMAIN: {{c.formatSLARemaining(item.sla.remaining)}}</span>
        </div>
        <div class="sla-badge" ng-class="{'sla-critical': item.sla.is_breached, 'sla-ok': !item.sla.is_breached}">
            <i class="fa" ng-class="{'fa-check': !item.sla.is_breached, 'fa-exclamation': item.sla.is_breached}"></i> 
            {{item.sla.is_breached ? 'BREACHED' : 'WITHIN SLA'}}
        </div>
      </div>

      <div class="sidebar-block" ng-if="item.state == 4">
        <div class="sb-label">FINAL_STATUS</div>
        <div style="background: rgba(52, 199, 89, 0.1); border: 2px solid #34c759; color: #34c759; padding: 12px; text-align: center; border-radius: 4px; font-weight: 800; display: flex; align-items: center; justify-content: center; gap: 8px;">
            <i class="fa fa-trophy"></i> MISSION COMPLETE
        </div>
        <div style="text-align: center; font-size: 10px; color: #999; margin-top: 6px; font-family: monospace;">
            SLA TIMER STOPPED
        </div>
      </div>

      <div class="sidebar-block" ng-if="item.state == 5">
        <div class="sb-label">FINAL_STATUS</div>
        <div style="background: #f5f5f5; border: 2px solid #ccc; color: #666; padding: 12px; text-align: center; border-radius: 4px; font-weight: 800; display: flex; align-items: center; justify-content: center; gap: 8px;">
            <i class="fa fa-ban"></i> OPERATION CANCELLED
        </div>
      </div>
      </div>
  </div>
</div>
</script>

<style>
/* --- 1. æ¨¡æ€æ¡† "ç¦»å®¶å‡ºèµ°" ä¿®å¤ (è§£å†³å˜é‡å¤±æ•ˆ/ç™½åº•/å¤´åƒä¸¢å¤±) --- */
.modal-content {
    /* å¼ºåˆ¶é‡æ–°å®šä¹‰å˜é‡ï¼Œé˜²æ­¢è¯»å–ä¸åˆ° */
    --accent-primary: #6200ea;
    --text-primary: #1a1a1a;
    --text-secondary: #555555;
    --border-light: #eeeeee;
    --border-mid: #dddddd;
    --color-critical: #ff3b30;
    --color-warning: #ff9500;
    
    background: #fff !important;
    border: none !important;
    border-radius: 4px !important;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
    font-family: "Rajdhani", "JetBrains Mono", sans-serif !important;
    overflow: visible !important;
}

/* ä¿®å¤å¤´éƒ¨ */
.modal-header-clean {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 20px 30px !important;
    background: #f8f9fa !important;
    border-bottom: 1px solid #e9ecef !important;
}
.header-badge {
    background: #000 !important;
    color: #fff !important;
    padding: 4px 12px;
    font-weight: 800;
    border-radius: 2px;
}
.header-close {
    background: #fff !important;
    border: 1px solid #ddd !important;
    width: 36px; height: 36px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
}
.header-close:hover {
    background: #ff3b30 !important;
    color: #fff !important;
    border-color: #ff3b30 !important;
}

/* ä¿®å¤å¤´åƒ (Avatar) - å¼ºåˆ¶ä¸Šè‰² */
.avatar-box {
    width: 36px; height: 36px;
    background-color: #6200ea !important; /* å…œåº•ç´«è‰² */
    color: #fff !important;
    display: flex !important;
    align-items: center; justify-content: center;
    border-radius: 4px;
    font-weight: 700;
    font-size: 16px;
}
.avatar-box.orange { background-color: #ff9500 !important; }
.avatar-box.grey { background-color: #e0e0e0 !important; color: #999 !important; }

/* ä¿®å¤ä¾§è¾¹æ  */
.body-sidebar {
    background: #fcfcfc !important;
    border-left: 1px solid #eee !important;
    padding: 25px !important;
}
.sidebar-block {
    border-bottom: 1px dashed #e0e0e0;
    padding-bottom: 15px;
    margin-bottom: 20px;
}
.sb-label {
    color: #999;
    font-weight: 700;
    font-size: 11px;
    margin-bottom: 8px;
    display: block;
}

/* --- 2. è¯„è®ºåŒºç¾åŒ– (Timeline Data Stream) --- */
.activity-area {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid #f0f0f0;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* è¾“å…¥æ¡†å®¹å™¨ï¼šå‚ç›´å¸ƒå±€ï¼Œæœç»é‡å  */
.input-wrapper {
    display: flex;
    flex-direction: column !important; /* å…³é”® */
    border: 1px solid #e0e0e0;
    background: #fff;
    border-radius: 4px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.02);
}
.input-wrapper:focus-within {
    border-color: #000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.note-input {
    width: 100%;
    min-height: 80px;
    padding: 15px;
    border: none !important;
    outline: none !important;
    font-family: "JetBrains Mono", sans-serif;
    font-size: 14px;
    color: #333;
    resize: vertical;
    background: transparent;
}

.input-footer {
    display: flex;
    justify-content: flex-end;
    padding: 10px 15px;
    background: #f9f9f9;
    border-top: 1px solid #eee;
}

.submit-btn {
    background: #e0e0e0;
    color: #999;
    padding: 8px 20px;
    font-family: "Rajdhani", sans-serif;
    font-weight: 700;
    font-size: 13px;
    border: none;
    cursor: not-allowed;
    border-radius: 2px;
    transition: all 0.2s;
}
.submit-btn.ready {
    background: #1a1a1a;
    color: #fff;
    cursor: pointer;
}
.submit-btn.ready:hover {
    background: #000;
    transform: translateY(-1px);
}

/* å†å²åˆ—è¡¨ */
.history-list {
    max-height: 400px;
    overflow-y: auto;
    padding-right: 8px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* ç”¨æˆ·ç•™è¨€æ°”æ³¡ */
.log-item.type-user {
    background: #fff;
    padding: 0 0 15px 0;
    border-bottom: 1px solid #f5f5f5;
}
.log-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 12px;
}
.log-user { font-weight: 800; color: #1a1a1a; }
.log-time { color: #999; font-family: monospace; }
.log-body { font-size: 14px; color: #444; line-height: 1.5; white-space: pre-wrap; }

/* ç³»ç»Ÿæ—¥å¿— (å†·æ·¡é£) */
.log-item.type-system {
    font-family: "JetBrains Mono", monospace;
    font-size: 12px;
}
.sys-terminal-box {
    background: #f8f9fa; /* æµ…ç°åº• */
    border-left: 3px solid #ccc;
    padding: 10px 14px;
    color: #555;
    border-radius: 0 4px 4px 0;
}
/* è­¦å‘Šçº§åˆ«çº¿æ¡é¢œè‰² */
.sys-terminal-box.sla-breach { border-left-color: #d93025; background: rgba(217, 48, 37, 0.03); }
.sys-terminal-box.sla-warning { border-left-color: #f9ab00; background: rgba(249, 171, 0, 0.03); }

.sys-meta-row {
    display: flex; justify-content: space-between;
    border-bottom: 1px dashed #e0e0e0;
    padding-bottom: 5px; margin-bottom: 5px;
    font-size: 10px; color: #999; text-transform: uppercase;
}
.tag-sla {
    display: inline-block; padding: 1px 6px; border-radius: 2px;
    font-weight: 700; font-size: 10px; margin-right: 6px;
}
.tag-sla.violation { background: #d93025; color: #fff; }
.tag-sla.warning { background: #f9ab00; color: #fff; }
</style>

<script type="text/ng-template" id="volunteerModalTemplate">
<div class="modal-content kokoro-modal-window">
  
  <div class="modal-header-clean">
    <div class="header-left">
      <span class="header-badge"><i class="fa fa-truck"></i> RESCUE_REQUEST</span>
      <span class="header-id">{{item.number}}</span>
    </div>
    <button class="header-close" ng-click="cancel()"><i class="fa fa-times"></i></button>
  </div>

  <div class="modal-body-grid">
    
    <div class="body-main">
      <h2 class="ticket-title">
          {{c.dict[item.category] || item.category}}
          <span class="qty-badge-black">x{{item.quantity}}</span>
      </h2>
      
      <div class="action-bar">
        <div class="dropdown-wrapper">
          <button class="btn-purple-outline" ng-click="toggleStatusMenu($event)">
             {{c.statusNames[item.state] || 'OPEN'}} <i class="fa fa-chevron-down"></i>
          </button>
          <div class="status-menu" ng-show="statusMenuOpen">
            <div class="status-item" ng-click="changeStatus(item, '11')" ng-if="item.state != 11 && item.state != 4">ASSIGNED</div>
            <div class="status-item" ng-click="changeStatus(item, '2')" ng-if="item.state == 11">IN PROGRESS</div>
            <div class="status-item" ng-click="changeStatus(item, '4')" ng-if="item.state == 2">COMPLETED</div>
            <div class="status-item danger" ng-click="changeStatus(item, '5')">CANCELLED</div>
          </div>
        </div>
        
        <button class="btn-normal" ng-click="assignToMe(item)" ng-if="item.state != 4">
            <i class="fa fa-user"></i> {{item.assigned_to_name ? 'REASSIGN' : 'ASSIGN TO ME'}}
        </button>
        
        <button class="action-btn" ng-click="triggerAutoAssign(item)" ng-if="!item.assigned_to_id">
            <i class="fa fa-magic"></i> AUTO_ASSIGN
        </button>
      </div>

      <div class="desc-box">
        <div class="desc-section-title">DESCRIPTION</div>
        <div class="desc-grid">
          <div class="desc-item">
              <div class="desc-icon"><i class="fa fa-map-marker"></i></div>
              <div><span class="desc-label">LOCATION:</span> {{item.zone}} - {{item.detail_loc}}</div>
          </div>
          <div class="desc-item">
              <div class="desc-icon"><i class="fa fa-cube"></i></div>
              <div><span class="desc-label">TYPE:</span> {{c.dict[item.category] || item.category}}</div>
          </div>
          <div class="desc-item" ng-if="item.remarks">
              <div class="desc-icon"><i class="fa fa-sticky-note-o"></i></div>
              <div><span class="desc-label">NOTES:</span> {{item.remarks}}</div>
          </div>
        </div>
      </div>

      <div class="activity-area">
        <div class="desc-section-title">
            <i class="fa fa-history"></i> ACTIVITY_LOG / å±¥æ­´
        </div>
        
        <div class="input-wrapper">
            <textarea class="note-input" 
                      ng-model="newComment" 
                      placeholder="å†…éƒ¨ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„... (Ctrl+Enter ã§é€ä¿¡)"
                      ng-keydown="$event.ctrlKey && $event.keyCode === 13 && postComment(item)"></textarea>
            <div class="input-footer">
                <button class="submit-btn" 
                        ng-class="{'ready': newComment && newComment.length > 0}" 
                        ng-disabled="!newComment || newComment.length === 0" 
                        ng-click="postComment(item)">
                    <i class="fa fa-paper-plane"></i> LOG_UPDATE
                </button>
            </div>
        </div>

        <div class="history-list">
            <div ng-repeat="h in item.history track by $index">
                
                <div class="log-item type-user" ng-if="!h.text.startsWith('[SLA')">
                    <div class="log-header">
                        <div class="log-user">
                            <i class="fa fa-user-circle" style="color:#333; margin-right:6px;"></i> 
                            {{h.user}}
                        </div>
                        <span class="log-time">{{h.date}}</span>
                    </div>
                    <div class="log-body">{{h.text}}</div>
                </div>

                <div class="log-item type-system" ng-if="h.text.startsWith('[SLA')">
                    <div class="sys-terminal-box" 
                         ng-class="{
                            'sla-breach': h.text.indexOf('é•å') !== -1 || h.text.indexOf('breached') !== -1, 
                            'sla-warning': h.text.indexOf('è­¦å‘Š') !== -1 || h.text.indexOf('risk') !== -1
                         }">
                        <div class="sys-meta-row">
                            <span><i class="fa fa-terminal"></i> ã‚·ã‚¹ãƒ†ãƒ ç›£æŸ» (SYSTEM_AUDIT)</span>
                            <span>{{h.date}}</span>
                        </div>
                        <div class="sys-content">
                            <span class="tag-sla violation" ng-if="h.text.indexOf('é•å') !== -1 || h.text.indexOf('breached') !== -1">SLAé•å</span>
                            <span class="tag-sla warning" ng-if="h.text.indexOf('è­¦å‘Š') !== -1 || h.text.indexOf('risk') !== -1">SLAè­¦å‘Š</span>
                            
                            {{h.text.replace('[SLAé•å]', '').replace('[SLAè­¦å‘Š]', '').replace('[SLAè¿å]', '').replace('[WARNING_ALERT]', '').replace('[CRITICAL_FAILURE]', '')}}
                        </div>
                    </div>
                </div>

            </div>
        </div>
      </div>
      </div>

    <div class="body-sidebar">
      
      <div class="sidebar-block">
          <div class="sb-label">STATUS</div>
          <div class="state-indicator" style="background:#000; color:#fff;">{{c.getStateInfo(item.state).name}}</div>
      </div>

      <div class="sidebar-block">
          <div class="sb-label">ASSIGNEE</div>
          <div class="user-row" ng-if="item.assigned_to_name">
              <div class="avatar-box">{{item.assigned_to_name.charAt(0)}}</div>
              <div class="user-name-text">{{item.assigned_to_name}}</div>
          </div>
          <div class="user-row" ng-if="!item.assigned_to_name">
              <div class="avatar-box grey">?</div>
              <div class="user-name-text" style="color:#999;">UNASSIGNED</div>
          </div>
      </div>

      <div class="sidebar-block">
          <div class="sb-label">REPORTER</div>
          <div class="user-row">
              <div class="avatar-box orange">{{item.reporter_name.charAt(0) || '?'}}</div>
              <div class="user-name-text">{{item.reporter_name || 'System'}}</div>
          </div>
      </div>

      <div class="sidebar-block">
          <div class="sb-label">PRIORITY</div>
          <div class="priority-btn">{{c.dict[item.urgency] || item.urgency}}</div>
      </div>

      <div class="sidebar-block">
          <div class="sb-label">LOCATION</div>
          <div style="font-weight:800; color:#1a1a1a; font-size:16px;">
              <i class="fa fa-map-marker" style="color:#ff3b30; margin-right:10px;"></i>{{item.zone}}
          </div>
          <div style="font-size:14px; color:#999; margin-top:8px;">{{item.detail_loc}}</div>
      </div>

      <div class="ai-card">
         <div class="ai-head"><i class="fa fa-magic"></i> AI_ANALYSIS</div>
         <div class="ai-text">Standard response required. ETA: 30 mins.</div>
      </div>

      <div class="sidebar-block" ng-if="item.sla">
        <div class="sb-label">SLA TRACKING</div>
        <div class="sla-progress">
            <div class="sla-fill" ng-style="{width: item.sla.percentage + '%', background: c.getSLABarColor(item.sla)}"></div>
        </div>
        <div class="sla-badge" ng-class="{'sla-critical': item.sla.is_breached, 'sla-ok': !item.sla.is_breached}">
            {{item.sla.is_breached ? 'BREACHED' : 'WITHIN SLA'}}
        </div>
      </div>

    </div>
  </div>
</div>
</script>
]]></template>
    </sp_widget>
</record_update>
